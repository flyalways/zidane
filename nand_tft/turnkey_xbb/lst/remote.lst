C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE REMOTE
OBJECT MODULE PLACED IN .\obj\remote.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE IR\remote.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\libsource\heade
                    -r) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\remote.lst) OBJECT(.\obj\remote.obj)

line level    source

   1          #include "..\Header\SPDA2K.h"
   2          #include "..\header\PROTOTYP.h"
   3          #include "..\header\dos\fs_struct.h"
   4          #include "..\IR\remote.h"
   5          #include "..\IR\FM.h"
   6          #include "..\header\Memalloc.h"
   7          #include "..\header\variables.h"
   8          #include "..\LCM\TFT_display.h"         // TFT
   9          
  10          extern xdata System_Struct gs_System_State;
  11          extern DSP_GLOBAL gs_DSP_GLOBAL_RAM;
  12          
  13          extern void Music_EQ_Cmd(U8 tc_Type);
  14          extern void Music_SetVolumeCmd(void);
  15          extern void LCM_ShowSongNumber_1(void);
  16          extern U8 DOS_Search_DIR(U8 tc_Mode);  //20090121 chiayen add
  17          extern U8 LCD_disp_HZK_string(U8 Page,U8 *DataBuf,U8 tc_ISNOrUnicode, U8 nByte,U8 ColumnOffset,bit reverse
             -); //20090121 chiayen add
  18          
  19          extern U8 LCD_Disp_FileName(U8 *tpc_DataBuf, U8 tc_ANSI, U8 tc_nByte, U8 tc_scroll_flag);
  20          extern UBYTE DOS_GetDIRName(UBYTE tc_FileHandle, UBYTE tb_UicodeToISN, UBYTE * tpc_LongName);
  21          
  22          extern void UI_DispGetDirName(U8 tc_DIRtableIndex);
  23          
  24          void ir_init(void);
  25          void ir_service(void);
  26          void ir_commandservice(void);
  27          void SaveNumber(U8 number);
  28          void ClearIRBuffer(void);
  29          void Frequency_Disp(void);
  30          void Channel_Set_Init(void);
  31          void Change_EQ(void);
  32          void VOL_UP(void);
  33          void VOL_DOWN(void);
  34          void CHG_DN(void);
  35          void CHG_UP(void);
  36          void PickSong_Process(void);
  37          void NextorPre_Song(bit tb_state);
  38          void MediaChange(void);  //20090107 chiayen add
  39          void LCD_Disp_DirName(void); //20090121 chiayen add
  40          void ChannelSet_Process(void);//20090409 chiayen add
  41          
  42          extern U8       DOS_Search_DIR_Prev_test(U8 tc_Mode);  //20090216 chiayen add
  43          extern U8       DOS_Search_DIR_Next_test(U8 tc_Mode);
  44          
  45          extern U8 GetCurrentDirInfo();
  46          
  47          extern  data    U8      gc_ShowIRNumMain;
  48          extern  data    bit     gb_TFT_refresh;
  49          
  50          xdata U8 gb_NumCHSet=0;
  51          xdata U8 gb_NumSet=0;
  52          
  53          void ir_init(void)
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 2   

  54          {
  55   1              // set time out
  56   1              IR_REG[0x00] = LO_BYTE(TIME_OUT_MIN);
  57   1              IR_REG[0x01] = HI_BYTE(TIME_OUT_MIN);
  58   1              // start 1 max
  59   1              IR_REG[0x02] = LO_BYTE(START1_MAX);
  60   1              IR_REG[0x03] = HI_BYTE(START1_MAX);
  61   1              // start 1 min
  62   1              IR_REG[0x04] = LO_BYTE(START1_MIN);
  63   1              IR_REG[0x05] = HI_BYTE(START1_MIN);
  64   1              // start 0 max
  65   1              IR_REG[0x06] = LO_BYTE(START0_MAX);
  66   1              IR_REG[0x07] = HI_BYTE(START0_MAX);
  67   1              // start 0 min
  68   1              IR_REG[0x08] = LO_BYTE(START0_MIN);
  69   1              IR_REG[0x09] = HI_BYTE(START0_MIN);
  70   1      #if (IR_MODULATION==IR_MOD_PPM) || (IR_MODULATION==IR_MOD_PWM)
  71   1              // logic 1 max
  72   1              IR_REG[0x0a] = LO_BYTE(LOGIC1_MAX);
  73   1              IR_REG[0x0b] = HI_BYTE(LOGIC1_MAX);
  74   1              // logic 1 min
  75   1              IR_REG[0x0c] = LO_BYTE(LOGIC1_MIN);
  76   1              IR_REG[0x0d] = HI_BYTE(LOGIC1_MIN);
  77   1      #else
                      // bit time
                      IR_REG[0x0a] = LO_BYTE(BIT_TIME);
                      IR_REG[0x0b] = HI_BYTE(BIT_TIME);
                      // sample point
                      IR_REG[0x0c] = LO_BYTE(SAMPLE_POINT);
                      IR_REG[0x0d] = HI_BYTE(SAMPLE_POINT);
              #endif
  85   1              // logic 0 max
  86   1              IR_REG[0x0e] = LO_BYTE(LOGIC0_MAX);
  87   1              IR_REG[0x0f] = HI_BYTE(LOGIC0_MAX);
  88   1              // logic 0 min
  89   1              IR_REG[0x10] = LO_BYTE(LOGIC0_MIN);
  90   1              IR_REG[0x11] = HI_BYTE(LOGIC0_MIN);
  91   1              // set sampling period = 1 usec
  92   1              IR_REG[0x12] = LO_BYTE(T_SAMPLE);
  93   1              IR_REG[0x13] = HI_BYTE(T_SAMPLE);               
  94   1              // set polarity
  95   1      #if IR_MODULATION == IR_MOD_PPM
  96   1              IR_REG[0x17] = 0x01;
  97   1      #elif IR_MODULATION == IR_MOD_PWM
                      IR_REG[0x17] = 0x03;
              #elif IR_MODULATION == IR_MOD_BIPHASE
                      IR_REG[0x17] = 0x07;
              #elif IR_MODULATION == IR_MOD_BINARY
                      IR_REG[0x17] = 0x05;
              #else
                      while(1);
              #endif
 106   1      
 107   1              IR_REG[0x19] = 0x07; // clear all events
 108   1              IR_REG[0x18] = 0x07; // enable all IR interrupts
 109   1              IR_REG[0x17] |= 0x80; // IR reveiver HW enabled
 110   1              IR_REG[0x19] = 0x07; // clear all events
 111   1              EX0 = 1; EA = 1;
 112   1      }
 113          
 114          
 115          void ir_service(void)
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 3   

 116          {
 117   1              U16 tw_temp;    
 118   1      
 119   1              if(gc_IRCmdStatus!=0)
 120   1              {
 121   2                      tw_temp=(IR_REG[0x1b]<<8)+IR_REG[0x1a];
 122   2      
 123   2                       switch(tw_temp)
 124   2              {
 125   3                 case IR_6_Key:
 126   3                      gc_irkey = 1;
 127   3                      break;
 128   3                 case IR_7_Key:
 129   3                      gc_irkey = 2;
 130   3                      break;
 131   3                 case IR_18_Key:
 132   3                      gc_irkey = 3;
 133   3                      break;
 134   3                 case IR_20_Key:
 135   3                      gc_irkey = 4;
 136   3                      break;
 137   3                 case IR_21_Key:
 138   3                      gc_irkey = 5;
 139   3                      break;
 140   3                 case IR_21_1_Key:
 141   3                      gc_irkey = 7;
 142   3                      break;
 143   3                 default:
 144   3                      gc_irkey = 0;
 145   3                      break;
 146   3              }
 147   2                      if(gc_irkey!=0)
 148   2                      {
 149   3                              if((IR_REG[0x1c]+IR_REG[0x1d])==0xFF)
 150   3                              {
 151   4                                      if(gc_IRCmdStatus==1)
 152   4                                      {
 153   5                                              ir_commandservice();
 154   5                                              gc_IRCmdStatus=0;
 155   5                                      }
 156   4                                      if(gc_IRCmdStatus==2)
 157   4                                      {                                       
 158   5                                                      ir_commandservice();
 159   5                                                      gc_IRCmdStatus=0;
 160   5                                      }
 161   4                              }                                       
 162   3                      }
 163   2                      else
 164   2                      {
 165   3                              gc_IRCmdStatus=0;
 166   3                      }
 167   2                      gc_IRCmdStatus=0;
 168   2              }
 169   1              gc_irkey=0;
 170   1      }
 171          
 172          
 173          void ir_commandservice(void)
 174          {
 175   1              U8      tc_SearchDirTimeout;
 176   1                                                                        
 177   1      
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 4   

 178   1      ///======================IR=======IR========IR===========================
 179   1      ///======================IR=======IR========IR===========================
 180   1      ///======================IR=======IR========IR===========================
 181   1      ///======================IR=======IR========IR===========================
 182   1              if(gc_irkey==5) // 21-1key
 183   1              {
 184   2      //              dbprintf("IR Key=%bx\n",IR_REG[0x1c]);
 185   2      
 186   2                  switch(IR_REG[0x1c])
 187   2                  {
 188   3                              case 0x00:      //ON/OFF 
 189   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 190   3                                      {
 191   4                                              if(gs_System_State.c_Phase!=TASK_PHASE_STOP)
 192   4                                              {
 193   5                                                      if(gc_Task_Current == C_Task_Play)
 194   5                                                      {
 195   6                                                              play_stop();
 196   6                                                      }
 197   5                                                      else if(gc_Task_Current == C_Task_Jpeg)
 198   5                                                      {
 199   6                                                              jpeg_stop();
 200   6                                                      }
 201   5                                                      else if(gc_Task_Current == C_Task_Mjpeg)
 202   5                                                      {
 203   6                                                              mjpeg_stop();
 204   6                                                      }
 205   5                                              }
 206   4                              gc_Task_Next=C_Task_PowerOff;
 207   4                                              gc_PhaseInx=0xff; 
 208   4                                      }
 209   3      
 210   3                                      break;
 211   3                              case 0x1e:                                                              //just for suo lang.
 212   3                              case 0x01:      //Mode  //Menu   
 213   3                                      if(gc_Task_Current == C_Task_Play)
 214   3                      { 
 215   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <3))
 216   4                                              {       
 217   5                                      play_stop();
 218   5                                              gc_Task_Next=C_Task_Menu;
 219   5                                              }
 220   4                                      }
 221   3                                      else if(gc_Task_Current == C_Task_Jpeg)
 222   3                                      {
 223   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <31))
 224   4                                              {
 225   5                                                      jpeg_stop();
 226   5                                              gc_Task_Next=C_Task_Menu;
 227   5                                              }                               
 228   4                                              
 229   4                                      }
 230   3                                      else if(gc_Task_Current == C_Task_Mjpeg)
 231   3                                      {
 232   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <21))
 233   4                                              {
 234   5                                                      mjpeg_stop();
 235   5                                              gc_Task_Next=C_Task_Menu;
 236   5                                              }
 237   4                                      }
 238   3      
 239   3                                      break;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 5   

 240   3      
 241   3                              case 0x04:      //RPT   
 242   3       #if 0
                                              if(gc_IRCmdStatus==1)  //20090216 chiayen add
                                              {                                       
                                                      if(gw_FileTotalNumber[0]!=0)
                                                      {       
                                                              U32 dw_File_StartCluster_Backup=0;
                                                              U32 dw_FDB_StartCluster_Backup=0;
               
                                                              gb_DirPlay_Flag=1;
                                              
                                                              play_stop();
                                                              gw_DirOverallNumber = gw_DirTotalNumber;
                                                              GetCurrentDirInfo();
                                                              for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
                                                              {
                                                                      DOS_Search_DIR_Prev_test(0x23);
                      
                                                                      gb_FindFlag = 0;
              
                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
              
                                                                      dw_File_StartCluster_Backup=gs_DIR_FCB[0].dw_File_StartCluster;
                                                                      dw_FDB_StartCluster_Backup=gs_DIR_FCB[0].dw_FDB_StartCluster;
              
                                                                      gc_test=0;
                                                                      DOS_Search_File(0x10,0,0x10);
              
                                                                      if(gw_FileTotalNumber[0])
                                                                      {
                                                                              DOS_Search_File(C_File_OneDir|C_By_FDB, C_MusicFileType, C_CmpExtName|C_Next);
                                                                              gw_FileIndex[0]=1;
                                                                              break;
                                                                      }
                                                                      gs_DIR_FCB[0].dw_File_StartCluster=dw_File_StartCluster_Backup;
                                                                      gs_DIR_FCB[0].dw_FDB_StartCluster=dw_FDB_StartCluster_Backup;
                                                              }
              
                                                              gc_Dirchange_Timer=5;
                                                              gw_LogData_Timer=2;
                                                              gb_TFT_refresh=1;
                                                              if(gb_LrcFileName_Exist==1)
                                                              {
                                                                      gc_DispWallpaper=0;
                                                              }
                                                              gc_PhaseInx = 3;
                                                              gb_DirPlay_Flag=1;
                                                              gc_FolderPlay_Flag=1;
                                                      }
                                              }
                                               gc_folder_disp=1; //sunzhk add
              //                              dbprintf("curind=%x,totle=%x\n",gw_FileIndex[0],gw_FileTotalNumber[0]);
                                              //      DOS_Search_File(C_File_OneDir|C_Cnt_FileNo, C_MusicFileType, C_CmpExtName|C_Next);
              #else
 295   3                                      if(gc_IRCmdStatus==1)
 296   3                                      {
 297   4                                              if(gc_Task_Current == C_Task_Play)
 298   4                                              {
 299   5                                      gc_ShowTimer=72;
 300   5                                                      if(gc_DispPlayMenuAct==0)
 301   5                                                      {
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 6   

 302   6                                                              gc_TuneVolFreqStatus=3;
 303   6                                                      }
 304   5                                              }else if(gc_Task_Current == C_Task_Jpeg)
 305   4                                              {
 306   5                                                      if(gc_DispPlayMenuAct==0)
 307   5                                                      {
 308   6                                                              gc_TuneVolFreqStatus=31;
 309   6                                                      }                               
 310   5                                              }else if(gc_Task_Current == C_Task_Mjpeg)
 311   4                                              {
 312   5                                                      if(gs_System_State.c_Phase==TASK_PHASE_PLAYACT)
 313   5                                                      {
 314   6                                                              mjpeg_playpause();
 315   6                                                      }
 316   5                      
 317   5                                              gc_ShowTimer=72;
 318   5                                                      if((gc_DispPlayMenuAct==0) || (gc_DispPlayMenuAct==0x11))
 319   5                                                      {
 320   6                                                              gc_TuneVolFreqStatus=21;
 321   6                                                      }                                       
 322   5                                              }
 323   4                                      }
 324   3      #endif
 325   3                              
 326   3                                      break;
 327   3      
 328   3                      case 0x02:      // paly/pause
 329   3                                      if(gc_IRCmdStatus==1)
 330   3                                      {
 331   4                                              if(gb_NumSet==0)
 332   4                                              {
 333   5                                              if(gc_Task_Current == C_Task_Play)
 334   5                                              {
 335   6                                      gc_PhaseInx=3;
 336   6                                                      gc_ShowTimer=1;
 337   6                                                      
 338   6                                              }else if(gc_Task_Current == C_Task_Jpeg)
 339   5                                              {
 340   6                                                      gc_PhaseInx=3;
 341   6                                              }
 342   5                                              else if(gc_Task_Current == C_Task_Mjpeg)
 343   5                                              {
 344   6                                                      gc_PhaseInx=3;
 345   6                                              }
 346   5                                              ClearIRBuffer();
 347   5                                      }
 348   4                                              else if(gb_NumSet==1)
 349   4                              {
 350   5                                      gb_PickSongSet=1;
 351   5                                                      gw_IR_Timer=1;
 352   5                                                      gb_Frequency_Song=1;
 353   5                                    
 354   5                                      gb_NumSet=0;
 355   5                              }
 356   4                                      }
 357   3                                      break;
 358   3                      case 0x08:
 359   3      #if 0   // DIR <<
                                              if(gc_IRCmdStatus==1)  //20090216 chiayen add
                                              {
                                                      if(gw_FileTotalNumber[0]!=0)
                                                      {
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 7   

                                                              play_stop();
                                                              for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
                                                              {
                                                                      gs_DIR_FCB[0].dw_FDB_StartCluster = gs_File_FCB[0].dw_FDB_StartCluster;                                                 
                                                                      DOS_Search_DIR(0x23);
              
                                                                      gb_FindFlag = 0;                                                                                                        
                                                                      if(gc_test==0)
                                                                      {
                                                                              gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
                                                                      }
                                                                      else
                                                                      {
                                                                              gs_File_FCB[0].dw_FDB_StartCluster = gdw_DOS_RootDirClus;
                                                                              gc_test=0;
                                                                      }
                                                                      DOS_Search_File(0x10,0,0x10);
                                                                      if(gw_FileTotalNumber[0])
                                                                      {
                                                                              DOS_Search_File(C_File_All|C_By_Time, C_MusicFileType, C_CmpExtName|C_Next);
                                                                              gw_FileIndex[0]=1;
                                                                              break;
                                                                      }                                                                                                               
                                                              }
              
                                                              gc_Dirchange_Timer=5;
                                                              gb_TFT_refresh=1;
                                                              if(gb_LrcFileName_Exist==1)
                                                              {
                                                                      gc_DispWallpaper=0;
                                                              }
              
                                                              gb_FindFlag = 1;
                                                              gc_PhaseInx = 3;
                                                              gb_DirPlay_Flag=1;
                                                              gc_FolderPlay_Flag=1;  //20090216 chiayen add                           
                                                      }                               
                                              }
                                              gc_folder_disp=1; //sunzhk add
              #else
 404   3                                      if(gc_Task_Current == C_Task_Play)
 405   3                                      {
 406   4                                              if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 407   4                                              {
 408   5                                                      if((gc_IRCmdStatus==1)&&(gw_FileTotalNumber[0]!=0))
 409   5                                                      {
 410   6                                                              Change_EQ();
 411   6                                                      }
 412   5                                              }
 413   4                                      }
 414   3      
 415   3      #endif
 416   3              // EQ
 417   3                                      break;
 418   3                      case 0x09:      // volume --
 419   3                                      if((gc_Task_Current == C_Task_Play)||(gc_Task_Current == C_Task_Mjpeg))
 420   3                                      {
 421   4                                              VOL_DOWN();
 422   4                                      }
 423   3                                      break;
 424   3                      case 0x0a:      // volume ++
 425   3                                      if((gc_Task_Current == C_Task_Play)||(gc_Task_Current == C_Task_Mjpeg))
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 8   

 426   3                                      {
 427   4                                              VOL_UP();
 428   4                                      }
 429   3                                      break;
 430   3                      case 0x0d:      // prev 
 431   3                                      if(gc_TuneVolFreqStatus < 3)
 432   3                                      {
 433   4                                              if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 434   4                                              {
 435   5                                                      NextorPre_Song(1);
 436   5                                              }
 437   4                                      }
 438   3      
 439   3                                      break;
 440   3                      case 0x0e:      // next 
 441   3                                                      
 442   3                                      if(gc_TuneVolFreqStatus < 3)
 443   3                                      {
 444   4                                                      if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 445   4                                                      {
 446   5                                                              NextorPre_Song(0);
 447   5                                                      }
 448   4                                      }
 449   3                                      break;
 450   3                                      case 0x06:      // CH+
 451   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 452   3                                      {
 453   4                                              if(gb_NumSet==0)
 454   4                                              {
 455   5                                                      ClearIRBuffer();
 456   5                                                      CHG_UP();
 457   5                                              }
 458   4                                              else if(gb_NumSet==1)
 459   4                                              {
 460   5                                                      ChannelSet_Process();
 461   5                                                      gc_ShowIRNumMain=0;
 462   5                                                      gb_ChannelSet=1;
 463   5                                                      gb_NumSet=0;
 464   5                                                      ClearIRBuffer();
 465   5                                              }
 466   4                                      }
 467   3      
 468   3                                      break;
 469   3                              case 0x05:      // CH-
 470   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 471   3                                      {
 472   4                                              if(gb_NumSet==0)
 473   4                                              {
 474   5                                                      ClearIRBuffer();
 475   5                                                      CHG_DN();
 476   5                                              }
 477   4                                              else if(gb_NumSet==1)
 478   4                                              {
 479   5                                                      ChannelSet_Process();
 480   5                                                      gc_ShowIRNumMain=0;
 481   5                                                      gb_ChannelSet=1;
 482   5                                                      gb_NumSet=0;
 483   5                                                      ClearIRBuffer();
 484   5                                              }
 485   4                                      }
 486   3                                      
 487   3                                      break;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 9   

 488   3                              case 0x1d:       //mute
 489   3                                      if(gc_IRCmdStatus==1) 
 490   3                                      {
 491   4                                              if(gc_VolumeMute==0)
 492   4                                              {
 493   5                                                      gc_Volumebackup=gs_DSP_GLOBAL_RAM.sw_Volume;
 494   5                                                      gs_DSP_GLOBAL_RAM.sw_Volume=0;
 495   5                                                      Music_SetVolumeCmd();
 496   5                                                      gc_VolumeMute=1;
 497   5                                                      gs_DSP_GLOBAL_RAM.sw_Volume=gc_Volumebackup;
 498   5                                              }
 499   4                                              else
 500   4                                              {
 501   5                                                      Music_SetVolumeCmd();
 502   5                                                      gc_VolumeMute=0;
 503   5                                              }
 504   4                                      }
 505   3                                      break;
 506   3                      /*      case 0x1e:        //u/sd
 507   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 508   3                                      {
 509   3                                              MediaChange();  //20090107 chiayen add
 510   3                                      }                               
 511   3                                      break;
 512   3                              case 0x0a:                              //CH_set
 513   3                                      if(gb_NumSet==1)
 514   3                                      {
 515   3                                              ChannelSet_Process();
 516   3                                              gb_ShowIRNumMain=0;
 517   3                                              gb_ChannelSet=1;
 518   3                                              gb_NumSet=0;
 519   3                                      }       
 520   3                                      else
 521   3                                      {
 522   3                                              ClearIRBuffer();
 523   3                                      }
 524   3                                      break;
 525   3      
 526   3                              case 0x08:                              //PkSong
 527   3                                      if(gb_NumSet==1)
 528   3                      {
 529   3                              gb_PickSongSet=1;
 530   3                                              gw_IR_Timer=1;
 531   3                                              gb_Frequency_Song=1;
 532   3                            
 533   3                              gb_NumSet=0;
 534   3                      }
 535   3                                      else
 536   3                                      {
 537   3                                              ClearIRBuffer();
 538   3                                      }
 539   3                                      
 540   3                                      break;*/
 541   3                              case 0x0c:      // 0
 542   3                                      SaveNumber(0);
 543   3                                      break;
 544   3                              case 0x10:      // 1
 545   3                                      SaveNumber(1);
 546   3                                      break;
 547   3                              case 0x11:      // 2
 548   3                                      SaveNumber(2);
 549   3                                      break;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 10  

 550   3                              case 0x12:      // 3
 551   3                                      SaveNumber(3);
 552   3                                      break;
 553   3                              case 0x14:      // 4
 554   3                                      SaveNumber(4);
 555   3                                      break;
 556   3                              case 0x15:      // 5
 557   3                                      SaveNumber(5);
 558   3                                      break;
 559   3                              case 0x16:      // 6
 560   3                                      SaveNumber(6);
 561   3                                      break;
 562   3                              case 0x18:      // 7
 563   3                                      SaveNumber(7);
 564   3                                      break;
 565   3                              case 0x19:      // 8
 566   3                                      SaveNumber(8);
 567   3                                      break;
 568   3                              case 0x1A:      // 9
 569   3                                      SaveNumber(9);
 570   3                                      break;
 571   3                  }
 572   2              }
 573   1              if(gc_irkey==7) // 21-1key
 574   1              {
 575   2      //              dbprintf("IR Key=%bx\n",IR_REG[0x1c]);
 576   2      
 577   2                  switch(IR_REG[0x1c])
 578   2                  {
 579   3      
 580   3                              case 0x43:      // paly/pause
 581   3                                      if(gc_IRCmdStatus==1)
 582   3                                      {
 583   4                                              if(gb_NumSet==0)
 584   4                                              {
 585   5                                              if(gc_Task_Current == C_Task_Play)
 586   5                                              {
 587   6                                      gc_PhaseInx=3;
 588   6                                                      gc_ShowTimer=1;
 589   6                                                      
 590   6                                              }else if(gc_Task_Current == C_Task_Jpeg)
 591   5                                              {
 592   6                                                      gc_PhaseInx=3;
 593   6                                              }
 594   5                                              else if(gc_Task_Current == C_Task_Mjpeg)
 595   5                                              {
 596   6                                                      gc_PhaseInx=3;
 597   6                                              }
 598   5                                              ClearIRBuffer();
 599   5                                      }
 600   4                                              else if(gb_NumSet==1)
 601   4                              {
 602   5                                      gb_PickSongSet=1;
 603   5                                                      gw_IR_Timer=1;
 604   5                                                      gb_Frequency_Song=1;
 605   5                                    
 606   5                                      gb_NumSet=0;
 607   5                              }
 608   4                                      }
 609   3                                      break;
 610   3                                                                                              //just for suo lang.
 611   3                              case 0x46:      //Mode  //Menu   
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 11  

 612   3                                      if(gc_Task_Current == C_Task_Play)
 613   3                      { 
 614   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <3))
 615   4                                              {       
 616   5                                      play_stop();
 617   5                                              gc_Task_Next=C_Task_Menu;
 618   5                                              }
 619   4                                      }
 620   3                                      else if(gc_Task_Current == C_Task_Jpeg)
 621   3                                      {
 622   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <31))
 623   4                                              {
 624   5                                                      jpeg_stop();
 625   5                                              gc_Task_Next=C_Task_Menu;
 626   5                                              }                               
 627   4                                              
 628   4                                      }
 629   3                                      else if(gc_Task_Current == C_Task_Mjpeg)
 630   3                                      {
 631   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <21))
 632   4                                              {
 633   5                                                      mjpeg_stop();
 634   5                                              gc_Task_Next=C_Task_Menu;
 635   5                                              }
 636   4                                      }
 637   3      
 638   3                                      break;
 639   3      
 640   3                              case 0x19:      //100+
 641   3      #if 1
 642   3                                      if(gc_IRCmdStatus==1)  //20090216 chiayen add
 643   3                                      {                                       
 644   4                                              if(gw_FileTotalNumber[0]!=0)
 645   4                                              {       
 646   5                                                      U32 dw_File_StartCluster_Backup=0;
 647   5                                                      U32 dw_FDB_StartCluster_Backup=0;
 648   5       
 649   5                                                      gb_DirPlay_Flag=1;
 650   5                                      
 651   5                                                      play_stop();
 652   5                                                      gw_DirOverallNumber = gw_DirTotalNumber;
 653   5                                                      GetCurrentDirInfo();
 654   5                                                      for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
 655   5                                                      {
 656   6                                                              DOS_Search_DIR_Prev_test(0x23);
 657   6              
 658   6                                                              gb_FindFlag = 0;
 659   6      
 660   6                                                              gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
 661   6      
 662   6                                                              dw_File_StartCluster_Backup=gs_DIR_FCB[0].dw_File_StartCluster;
 663   6                                                              dw_FDB_StartCluster_Backup=gs_DIR_FCB[0].dw_FDB_StartCluster;
 664   6      
 665   6                                                              gc_test=0;
 666   6                                                              DOS_Search_File(0x10,0,0x10);
 667   6      
 668   6                                                              if(gw_FileTotalNumber[0])
 669   6                                                              {
 670   7                                                                      DOS_Search_File(C_File_OneDir|C_By_FDB, C_MusicFileType, C_CmpExtName|C_Next);
 671   7                                                                      gw_FileIndex[0]=1;
 672   7                                                                      break;
 673   7                                                              }
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 12  

 674   6                                                              gs_DIR_FCB[0].dw_File_StartCluster=dw_File_StartCluster_Backup;
 675   6                                                              gs_DIR_FCB[0].dw_FDB_StartCluster=dw_FDB_StartCluster_Backup;
 676   6                                                      }
 677   5      
 678   5                                                      gc_Dirchange_Timer=5;
 679   5                                                      gw_LogData_Timer=2;
 680   5                                                      gb_TFT_refresh=1;
 681   5                                                      if(gb_LrcFileName_Exist==1)
 682   5                                                      {
 683   6                                                              gc_DispWallpaper=0;
 684   6                                                      }
 685   5                                                      gc_PhaseInx = 3;
 686   5                                                      gb_DirPlay_Flag=1;
 687   5                                                      gc_FolderPlay_Flag=1;
 688   5                                              }
 689   4                                      }
 690   3                                       gc_folder_disp=1; //sunzhk add
 691   3      //                              dbprintf("curind=%x,totle=%x\n",gw_FileIndex[0],gw_FileTotalNumber[0]);
 692   3                                      //      DOS_Search_File(C_File_OneDir|C_Cnt_FileNo, C_MusicFileType, C_CmpExtName|C_Next);
 693   3      #else
                                              if(gc_IRCmdStatus==1)
                                              {
                                                      if(gc_Task_Current == C_Task_Play)
                                                      {
                                              gc_ShowTimer=72;
                                                              if(gc_DispPlayMenuAct==0)
                                                              {
                                                                      gc_TuneVolFreqStatus=3;
                                                              }
                                                      }else if(gc_Task_Current == C_Task_Jpeg)
                                                      {
                                                              if(gc_DispPlayMenuAct==0)
                                                              {
                                                                      gc_TuneVolFreqStatus=31;
                                                              }                               
                                                      }else if(gc_Task_Current == C_Task_Mjpeg)
                                                      {
                                                              if(gs_System_State.c_Phase==TASK_PHASE_PLAYACT)
                                                              {
                                                                      mjpeg_playpause();
                                                              }
                              
                                                      gc_ShowTimer=72;
                                                              if((gc_DispPlayMenuAct==0) || (gc_DispPlayMenuAct==0x11))
                                                              {
                                                                      gc_TuneVolFreqStatus=21;
                                                              }                                       
                                                      }
                                              }
              #endif
 724   3      
 725   3                                      break;
 726   3      
 727   3                      case 0x0d:                                      //0x200
 728   3                                      if(gc_IRCmdStatus==1)  //20090216 chiayen add
 729   3                                      {
 730   4                                              if(gw_FileTotalNumber[0]!=0)
 731   4                                              {
 732   5                                                      play_stop();
 733   5                                                      for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
 734   5                                                      {
 735   6                                                              gs_DIR_FCB[0].dw_FDB_StartCluster = gs_File_FCB[0].dw_FDB_StartCluster;                                                 
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 13  

 736   6                                                              DOS_Search_DIR(0x23);
 737   6      
 738   6                                                              gb_FindFlag = 0;                                                                                                        
 739   6                                                              if(gc_test==0)
 740   6                                                              {
 741   7                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
 742   7                                                              }
 743   6                                                              else
 744   6                                                              {
 745   7                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gdw_DOS_RootDirClus;
 746   7                                                                      gc_test=0;
 747   7                                                              }
 748   6                                                              DOS_Search_File(0x10,0,0x10);
 749   6                                                              if(gw_FileTotalNumber[0])
 750   6                                                              {
 751   7                                                                      DOS_Search_File(C_File_All|C_By_Time, C_MusicFileType, C_CmpExtName|C_Next);
 752   7                                                                      gw_FileIndex[0]=1;
 753   7                                                                      break;
 754   7                                                              }                                                                                                               
 755   6                                                      }
 756   5      
 757   5                                                      gc_Dirchange_Timer=5;
 758   5                                                      gb_TFT_refresh=1;
 759   5                                                      if(gb_LrcFileName_Exist==1)
 760   5                                                      {
 761   6                                                              gc_DispWallpaper=0;
 762   6                                                      }
 763   5      
 764   5                                                      gb_FindFlag = 1;
 765   5                                                      gc_PhaseInx = 3;
 766   5                                                      gb_DirPlay_Flag=1;
 767   5                                                      gc_FolderPlay_Flag=1;  //20090216 chiayen add                           
 768   5                                              }                               
 769   4                                      
 770   4                                      
 771   4                              }
 772   3                                              gc_folder_disp=1; //sunzhk add
 773   3                              break;
 774   3                      case 0x09:                              //eq
 775   3                                      if(gc_Task_Current == C_Task_Play)
 776   3                                      {
 777   4                                              if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 778   4                                              {
 779   5                                                      if((gc_IRCmdStatus==1)&&(gw_FileTotalNumber[0]!=0))
 780   5                                                      {
 781   6                                                              Change_EQ();
 782   6                                                      }
 783   5                                              }
 784   4                                      }
 785   3                                      break;
 786   3                      case 0x07:      // volume --
 787   3                                      if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 788   3                                      {
 789   4                                              VOL_DOWN();
 790   4                                      }
 791   3                                      break;
 792   3                      case 0x15:      // volume ++
 793   3                                      if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 794   3                                      {
 795   4                                              VOL_UP();
 796   4                                      }
 797   3                                      break;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 14  

 798   3                      case 0x44:      // prev 
 799   3                                      if(gc_TuneVolFreqStatus < 3)
 800   3                                      {
 801   4                                              if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 802   4                                              {
 803   5                                                      NextorPre_Song(1);
 804   5                                              }
 805   4                                      }
 806   3      
 807   3                                      break;
 808   3                      case 0x40:      // next 
 809   3                                                      
 810   3                                      if(gc_TuneVolFreqStatus < 3)
 811   3                                      {
 812   4                                                      if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 813   4                                                      {
 814   5                                                              NextorPre_Song(0);
 815   5                                                      }
 816   4                                      }
 817   3                                      break;
 818   3                                      case 0x47:      // CH+
 819   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 820   3                                      {
 821   4                                              if(gb_NumSet==0)
 822   4                                              {
 823   5                                                      ClearIRBuffer();
 824   5                                                      CHG_UP();
 825   5                                              }
 826   4                                              else if(gb_NumSet==1)
 827   4                                              {
 828   5                                                      ChannelSet_Process();
 829   5                                                      gc_ShowIRNumMain=0;
 830   5                                                      gb_ChannelSet=1;
 831   5                                                      gb_NumSet=0;
 832   5                                                      ClearIRBuffer();
 833   5                                              }
 834   4                                      }
 835   3      
 836   3                                      break;
 837   3                              case 0x45:      // CH-
 838   3                                              if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 839   3                                      {
 840   4                                              if(gb_NumSet==0)
 841   4                                              {
 842   5                                                      ClearIRBuffer();
 843   5                                                      CHG_DN();
 844   5                                              }
 845   4                                              else if(gb_NumSet==1)
 846   4                                              {
 847   5                                                      ChannelSet_Process();
 848   5                                                      gc_ShowIRNumMain=0;
 849   5                                                      gb_ChannelSet=1;
 850   5                                                      gb_NumSet=0;
 851   5                                                      ClearIRBuffer();
 852   5                                              }
 853   4                                      }
 854   3                                      
 855   3                                      break;
 856   3                      /*      case 0x1d:       //mute
 857   3                                      if(gc_IRCmdStatus==1) 
 858   3                                      {
 859   3                                              if(gc_VolumeMute==0)
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 15  

 860   3                                              {
 861   3                                                      gc_Volumebackup=gs_DSP_GLOBAL_RAM.sw_Volume;
 862   3                                                      gs_DSP_GLOBAL_RAM.sw_Volume=0;
 863   3                                                      Music_SetVolumeCmd();
 864   3                                                      gc_VolumeMute=1;
 865   3                                                      gs_DSP_GLOBAL_RAM.sw_Volume=gc_Volumebackup;
 866   3                                              }
 867   3                                              else
 868   3                                              {
 869   3                                                      Music_SetVolumeCmd();
 870   3                                                      gc_VolumeMute=0;
 871   3                                              }
 872   3                                      }
 873   3                                      break;*/
 874   3                      /*      case 0x1e:        //u/sd
 875   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 876   3                                      {
 877   3                                              MediaChange();  //20090107 chiayen add
 878   3                                      }                               
 879   3                                      break;
 880   3                              case 0x0a:                              //CH_set
 881   3                                      if(gb_NumSet==1)
 882   3                                      {
 883   3                                              ChannelSet_Process();
 884   3                                              gc_ShowIRNumMain=0;
 885   3                                              gb_ChannelSet=1;
 886   3                                              gb_NumSet=0;
 887   3                                      }       
 888   3                                      else
 889   3                                      {
 890   3                                              ClearIRBuffer();
 891   3                                      }
 892   3                                      break;
 893   3      
 894   3                              case 0x08:                              //PkSong
 895   3                                      if(gb_NumSet==1)
 896   3                      {
 897   3                              gb_PickSongSet=1;
 898   3                                              gw_IR_Timer=1;
 899   3                                              gb_Frequency_Song=1;
 900   3                            
 901   3                              gb_NumSet=0;
 902   3                      }
 903   3                                      else
 904   3                                      {
 905   3                                              ClearIRBuffer();
 906   3                                      }
 907   3                                      
 908   3                                      break;*/
 909   3                              case 0x16:      // 0
 910   3                                      SaveNumber(0);
 911   3                                      break;
 912   3                              case 0x0c:      // 1
 913   3                                      SaveNumber(1);
 914   3                                      break;
 915   3                              case 0x18:      // 2
 916   3                                      SaveNumber(2);
 917   3                                      break;
 918   3                              case 0x5e:      // 3
 919   3                                      SaveNumber(3);
 920   3                                      break;
 921   3                              case 0x08:      // 4
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 16  

 922   3                                      SaveNumber(4);
 923   3                                      break;
 924   3                              case 0x1c:      // 5
 925   3                                      SaveNumber(5);
 926   3                                      break;
 927   3                              case 0x5a:      // 6
 928   3                                      SaveNumber(6);
 929   3                                      break;
 930   3                              case 0x42:      // 7
 931   3                                      SaveNumber(7);
 932   3                                      break;
 933   3                              case 0x52:      // 8
 934   3                                      SaveNumber(8);
 935   3                                      break;
 936   3                              case 0x4a:      // 9
 937   3                                      SaveNumber(9);
 938   3                                      break;
 939   3                  }
 940   2              }
 941   1      }
 942          
 943          void SaveNumber(U8 number)
 944          {
 945   1              if(gc_Task_Current != C_Task_Play)
 946   1              {return;}
 947   1          if(gc_IRCmdStatus==1)
 948   1          {
 949   2              gw_IR_Timer=120;
 950   2      
 951   2                                      
 952   2                      gc_NUMBER[3]=gc_NUMBER[2];
 953   2                      gc_NUMBER[2]=gc_NUMBER[1];
 954   2                      gc_NUMBER[1]=gc_NUMBER[0];
 955   2                      gc_NUMBER[0]=number;
 956   2                      gb_ShowIRNum=1;
 957   2                      gc_ShowIRNumMain=0;     
 958   2                              if(gb_ShowIRNum==1)                                             //
 959   2                              {
 960   3                                      gc_ShowTimer=0;
 961   3                                      gc_TuneVolFreqStatus=0;
 962   3                              
 963   3                                      if(gc_ShowIRNumMain==0)
 964   3                                      {
 965   4                                              gc_ShowIRNumMain=1;
 966   4                                              gb_TFT_refresh=1;
 967   4                                              gc_DispWallpaper=0;
 968   4                                              TFT_IRNumMain();
 969   4                                      }
 970   3                              
 971   3                                      TFT_IRNum();
 972   3                              }
 973   2              gb_NumSet=1;
 974   2              gc_PhaseInx=1;
 975   2              
 976   2          }
 977   1      }
 978          void ClearIRBuffer(void)
 979          {
 980   1              gb_ChannelSet=0;
 981   1              gb_PickSong=0;
 982   1              gc_NUMBER[0]=0xFF;
 983   1              gc_NUMBER[1]=0xFF;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 17  

 984   1              gc_NUMBER[2]=0xFF;
 985   1              gc_NUMBER[3]=0xFF;
 986   1              gw_IRNum=0;
 987   1      }
 988          
 989          
 990          void Change_EQ(void)
 991          {
 992   1      //      gb_Err=0;
 993   1              ClearIRBuffer();
 994   1              gw_LogData_Timer=60; //chiayen0812
 995   1              gw_IR_Setting_Timer=120;
 996   1              gb_IR_Setting=1;
 997   1              gs_DSP_GLOBAL_RAM.sc_EQ_Type++;
 998   1              if(gs_DSP_GLOBAL_RAM.sc_EQ_Type>5)
 999   1              {
1000   2                      gs_DSP_GLOBAL_RAM.sc_EQ_Type=0; 
1001   2              }
1002   1              Music_EQ_Cmd(gs_DSP_GLOBAL_RAM.sc_EQ_Type);
1003   1              gc_ShowTimer=/*120*/72;
1004   1              gb_Frequency_Song=1;    // 0=Show Frequency    1=Show Song Number/EQ
1005   1              gb_SelectEQ=1;                  // 0=Show Song Number  1=Show EQ
1006   1      }
1007          
1008          
1009          void VOL_UP(void)
1010          {
1011   1              if(gw_irkey_count!=0)
1012   1              {               
1013   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1014   2              }
1015   1      //      gb_Err=0;       
1016   1              ClearIRBuffer();
1017   1              gw_IR_Setting_Timer=120;
1018   1              gb_IR_Setting=1;
1019   1              gc_TuneVolFreqStatus=1;
1020   1              if(gc_Task_Current == C_Task_Play)
1021   1              {  
1022   2                      gc_PhaseInx=C_PlayVolUp;
1023   2              }else if(gc_Task_Current == C_Task_Mjpeg)
1024   1              {
1025   2                      gc_PhaseInx=C_MjpegVolUp;
1026   2              }
1027   1      }
1028          void VOL_DOWN(void)
1029          {
1030   1              if(gw_irkey_count!=0)
1031   1              {
1032   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1033   2              }
1034   1      //      gb_Err=0;                       
1035   1              ClearIRBuffer();
1036   1              gw_IR_Setting_Timer=120;
1037   1              gb_IR_Setting=1;
1038   1              gc_TuneVolFreqStatus=1;
1039   1              if(gc_Task_Current == C_Task_Play)
1040   1              {
1041   2                      gc_PhaseInx=C_PlayVolDn;//home
1042   2              }
1043   1              else if(gc_Task_Current == C_Task_Mjpeg)
1044   1              {
1045   2                      gc_PhaseInx=C_MjpegVolDn;//home
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 18  

1046   2              }
1047   1      }
1048          void CHG_UP(void)
1049          {
1050   1              if(gw_irkey_count!=0)
1051   1              {               
1052   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1053   2              }
1054   1      //      gb_Err=0;       
1055   1              ClearIRBuffer();
1056   1              gw_IR_Setting_Timer=120;
1057   1              gb_IR_Setting=1;
1058   1              if(gc_Task_Current == C_Task_Play)
1059   1              {
1060   2                      gc_PhaseInx=C_PlayChgUp;
1061   2              }
1062   1              else if(gc_Task_Current == C_Task_Mjpeg)
1063   1              {
1064   2                      gc_PhaseInx=C_MjpegChgUp;
1065   2              }
1066   1      }
1067          
1068          void CHG_DN(void)
1069          {
1070   1              if(gw_irkey_count!=0)
1071   1              {               
1072   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1073   2              }
1074   1      //      gb_Err=0;       
1075   1              ClearIRBuffer();
1076   1              gw_IR_Setting_Timer=120;
1077   1              gb_IR_Setting=1;
1078   1              if(gc_Task_Current == C_Task_Play)
1079   1              {
1080   2                      gc_PhaseInx=C_PlayChgDn;
1081   2              }
1082   1              else if(gc_Task_Current == C_Task_Mjpeg)
1083   1              {
1084   2                      gc_PhaseInx=C_MjpegChgDn;
1085   2              }
1086   1      }
1087          
1088          
1089          
1090          
1091          void NextorPre_Song(bit tb_state)
1092          {
1093   1              gc_TuneVolFreqStatus=0;
1094   1              if(gb_LrcFileName_Exist==1)
1095   1              {
1096   2                      gb_TFT_refresh=1;
1097   2                      gc_DispWallpaper=0;
1098   2              }
1099   1      
1100   1              if((gc_RepPlayMode==C_RandomPlay && (gc_IRdetMask==1)) || (gb_FlashNoFileflag))
1101   1              {
1102   2                      return;
1103   2              }
1104   1      
1105   1              if(gc_RepPlayMode==C_RandomPlay)
1106   1              {
1107   2                      gc_IRdetMask=1;
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 19  

1108   2                      ClearIRBuffer();
1109   2                      play_next();
1110   2                      gc_IRdetMask=0;
1111   2              }
1112   1              else
1113   1              {
1114   2                      if(tb_state==0)
1115   2                      {
1116   3                              if(gc_Task_Current == C_Task_Play)
1117   3                              {
1118   4                                      play_next();            
1119   4                              }else if(gc_Task_Current == C_Task_Jpeg)
1120   3                              {
1121   4                                      jpeg_next();
1122   4                              }else if(gc_Task_Current == C_Task_Mjpeg)
1123   3                              {
1124   4                                      mjpeg_next();
1125   4                              }
1126   3                      }
1127   2                      else
1128   2                      {               
1129   3                              if(gc_Task_Current == C_Task_Play)
1130   3                              {
1131   4                                      play_prev();    
1132   4                              }else if(gc_Task_Current == C_Task_Jpeg)
1133   3                              {
1134   4                                      jpeg_prev();
1135   4                              }else if(gc_Task_Current == C_Task_Mjpeg)
1136   3                              {
1137   4                                      mjpeg_prev();
1138   4                              }
1139   3                      }
1140   2                      ClearIRBuffer();
1141   2              }
1142   1      }
1143          
1144          
1145          void PickSong_Process(void)
1146          {
1147   1              data    U16     tw_SongNumber=0;
1148   1      
1149   1              gb_PickSongSet=0;
1150   1              gw_DispSongNum=0xFFFF;
1151   1      
1152   1              if(gc_NUMBER[0]!=0xFF)
1153   1              {
1154   2                      tw_SongNumber=gc_NUMBER[0];
1155   2                      if(gc_NUMBER[1]!=0xFF)
1156   2                      {
1157   3                              tw_SongNumber+=gc_NUMBER[1]*10;
1158   3                              if(gc_NUMBER[2]!=0xFF)
1159   3                              {
1160   4                                      tw_SongNumber+=gc_NUMBER[2]*100;
1161   4                                      if(gc_NUMBER[3]!=0xFF)
1162   4                                      {
1163   5                                              tw_SongNumber+=gc_NUMBER[3]*1000;
1164   5                                      }
1165   4                              }
1166   3                      }
1167   2              }
1168   1      
1169   1              ClearIRBuffer();
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 20  

1170   1              gb_NumSet=0;
1171   1              gc_ShowTimer=72;        
1172   1              gw_IR_Timer=0;
1173   1      
1174   1      
1175   1              if((tw_SongNumber<=gw_FileTotalNumber[0])&&(tw_SongNumber!=0))
1176   1              {
1177   2                      if(tw_SongNumber==gw_FileIndex[0])
1178   2                      {
1179   3                              gw_FileSkipNumber=1;
1180   3                      }
1181   2                      else if(tw_SongNumber>gw_FileIndex[0])
1182   2                      {
1183   3                              gw_FileSkipNumber=tw_SongNumber-gw_FileIndex[0];
1184   3                              play_next();
1185   3                      }
1186   2                      else
1187   2                      {
1188   3                              gw_FileSkipNumber=(gw_FileTotalNumber[0]-gw_FileIndex[0])+tw_SongNumber;
1189   3                              play_next();
1190   3                      }
1191   2                      gb_Frequency_Song=1;
1192   2              }
1193   1              else
1194   1              {
1195   2                      if(tw_SongNumber==0)
1196   2                      {
1197   3                              gb_Frequency_Song=1;
1198   3                      }
1199   2                      else
1200   2                      {
1201   3                              TFT_ShowError();
1202   3                              gb_Frequency_Song=0;
1203   3                              gc_ShowIRNumMain=0;
1204   3                              gc_ShowTimer=72;
1205   3                              return;
1206   3                      }
1207   2              }
1208   1      
1209   1              if ((gw_SongNumber!=gw_FileIndex[0])&&(gc_CurrentCard==5)&&(gw_FileTotalNumber[0]!=0))
1210   1              {
1211   2                      gw_SongNumber=gw_FileIndex[0];
1212   2              }
1213   1      
1214   1              if ((gw_SongNumberSD!=gw_FileIndex[0])&&((gc_CurrentCard==3)||(gc_CurrentCard==2))&&(gw_FileTotalNumber[0
             -]!=0))
1215   1              {
1216   2                      gw_SongNumberSD=gw_FileIndex[0];
1217   2              }
1218   1      }
1219          
1220          void ChannelSet_Process(void)
1221          {
1222   1              U16     tw_frequency;
1223   1      
1224   1              
1225   1              tw_frequency=gc_NUMBER[2]*100+gc_NUMBER[1]*10+gc_NUMBER[0];
1226   1              if(gc_NUMBER[3]!=0xff)
1227   1              {                                               
1228   2                      tw_frequency=tw_frequency+gc_NUMBER[3]*1000;
1229   2              }
1230   1      
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 21  

1231   1              if((tw_frequency>=875)&&(tw_frequency<=1080))
1232   1              {
1233   2                      gw_FM_frequency=tw_frequency;
1234   2                      FM_drive();
1235   2                      gc_ShowTimer=5;
1236   2                      gw_DisplayFreq=0xFFFF;
1237   2      
1238   2                      gw_IR_Timer=0;
1239   2                      gb_NumSet=0;
1240   2                      gc_NUMBER[0]=0xFF;
1241   2                      gc_NUMBER[1]=0xFF;
1242   2                      gc_NUMBER[2]=0xFF;
1243   2                      gc_NUMBER[3]=0xFF;
1244   2              }
1245   1              else
1246   1              {
1247   2                      TFT_ShowError();
1248   2                      gc_ShowTimer=72;
1249   2      
1250   2                      gw_IR_Timer=0;
1251   2                      gb_NumSet=0;
1252   2                      gc_NUMBER[0]=0xFF;
1253   2                      gc_NUMBER[1]=0xFF;
1254   2                      gc_NUMBER[2]=0xFF;
1255   2                      gc_NUMBER[3]=0xFF;
1256   2                      return;
1257   2              }
1258   1      //      TFT_Main_VOL_FM_ADJ();
1259   1      //      TFT_ShowFMFreqAdj();
1260   1              gw_LogData_Timer=10;
1261   1      }
1262          #if 1
1263          void MediaChange(void)  //20090107 chiayen add
1264          {
1265   1              if((gb_SD_Exist==1) && (gb_Host_Exist==1))
1266   1              {
1267   2                      if(gc_CurrentCard==0)
1268   2                      {
1269   3                              gc_CurrentCard=2;       
1270   3                      }
1271   2                      else if(gc_CurrentCard==2)
1272   2                      {
1273   3                              gc_CurrentCard=5;
1274   3                      }
1275   2                      else
1276   2                      {
1277   3                              gc_CurrentCard=0;
1278   3                      }       
1279   2              }
1280   1              else if((gb_SD_Exist==1) && (gb_Host_Exist==0))
1281   1              {
1282   2                      if(gc_CurrentCard==0)
1283   2                      {
1284   3                              gc_CurrentCard=2;       
1285   3                      }
1286   2                      else if(gc_CurrentCard==2)
1287   2                      {
1288   3                              gc_CurrentCard=0;
1289   3                      }
1290   2              }
1291   1              else if((gb_SD_Exist==0) && (gb_Host_Exist==1))
1292   1              {
C51 COMPILER V9.00   REMOTE                                                                07/10/2012 15:51:55 PAGE 22  

1293   2                      if(gc_CurrentCard==0)
1294   2                      {
1295   3                              gc_CurrentCard=5;       
1296   3                      }
1297   2                      else if(gc_CurrentCard==5)
1298   2                      {
1299   3                              gc_CurrentCard=0;
1300   3                      }
1301   2              }
1302   1      }
1303          #endif
1304          
1305          
1306          
1307          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2804    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
