C51 COMPILER V9.00   ISR                                                                   07/10/2012 15:51:50 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ISR
OBJECT MODULE PLACED IN .\obj\ISR.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MAIN\ISR.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\libsource\header
                    -) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\ISR.lst) OBJECT(.\obj\ISR.obj)

line level    source

   1          #include "SPDA2K.h"
   2          #include "..\header\variables.h"
   3            
   4          extern  data    bit     gb_HostConnect;  
   5          //extern        data    U8      gc_PKSongCHSetMode;
   6          extern  xdata   U8      gc_ShowMenuTimer;
   7          extern  xdata   U8      gc_ShowPingpuTimer;
   8          extern  xdata   U8  gb_ShowPingpu;
   9          
  10          extern xdata U8 gb_NumCHSet;
  11          
  12          extern void System_HostDetect();
  13          
  14          //=======================================================================
  15          /*****************************************************************************
  16          * NAME:         void _HostISR(void)
  17          * DESCRIPTION:
  18          *
  19          *****************************************************************************/
  20          void HostISR(void) interrupt 0 using 1 
  21          {
  22   1              U8      tc_USB_flag;
  23   1              EX0 = 0;
  24   1              
  25   1              if(IR_REG[0x19]!=0)  //for IR
  26   1              {
  27   2                      if(IR_REG[0x19]==1)
  28   2                      {
  29   3                              gc_IRCmdStatus=1;
  30   3                              gc_ircount=0;
  31   3                      }
  32   2                      if(IR_REG[0x19]==2)
  33   2                      {
  34   3                              gc_ircount++;
  35   3                              if(gc_ircount>20)
  36   3                              {
  37   4                                      gc_IRCmdStatus=2;
  38   4                                      gc_ircount=0;
  39   4                              }
  40   3                      }
  41   2                      IR_REG[0x19] = 7;
  42   2              }
  43   1              else if(gbt_USB_Detected)  
  44   1              {
  45   2                      USB_REG[0xD0] = 0x00;
  46   2                      USB_REG[0xA0] = 0x00;
  47   2                      if(USB_REG[0xC3]==0x10){        
  48   3                      gc_USB_ADDR = USB_REG[0xF2];
  49   3                  } 
  50   2                  if ((USB_REG[0xC2] & 0x02)) { // End Point 2 in (Bulk Out)
  51   3                      
  52   3                      USB_REG[0xC2]   &= 0xFD;   
  53   3              
  54   3                              gbt_USB_CMD_IN     = 1;
C51 COMPILER V9.00   ISR                                                                   07/10/2012 15:51:50 PAGE 2   

  55   3                      }
  56   2                      else
  57   2                      {
  58   3                              tc_USB_flag=USB_REG[0xC0];
  59   3                              if(tc_USB_flag&0x08)    // RESET
  60   3                              {
  61   4                                  gbt_USBRST_int_flag = 1;                
  62   4                              }   
  63   3                              else if(tc_USB_flag&0x01)       // SETUP
  64   3                              {
  65   4                                      gb_USB_ISR_Detected=1;
  66   4                                  gbt_EP0SETUP_int_flag   = 1;                    
  67   4                              }
  68   3                              else if(tc_USB_flag&0x02)       // OUT
  69   3                              { 
  70   4                                  gbt_EP0TX_int_flag      = 1;
  71   4                              }
  72   3                              else if(tc_USB_flag&0x04)       // IN
  73   3                              {
  74   4                                 gbt_EP0RX_int_flag      = 1;
  75   4                              }
  76   3                              else if(tc_USB_flag&0x10)       // SUSPEND
  77   3                              { 
  78   4                                 gbt_SUSPEND_int_flag = 1;
  79   4                              }
  80   3                              else if(tc_USB_flag&0x20)
  81   3                              { 
  82   4                                 gbt_USB_CONFIG_Chg_int_flag = 1;
  83   4                              }
  84   3                              else if(tc_USB_flag&0x40)       // WAKEUP
  85   3                              { 
  86   4                                 
  87   4                              }
  88   3                              else if(tc_USB_flag&0x80)       // RESUME
  89   3                              { 
  90   4                                 gbt_RESUME_int_flag = 1;
  91   4                              }
  92   3                              else
  93   3                              {
  94   4                                
  95   4                              }
  96   3                              
  97   3                              Control_Transfer_Process();
  98   3                      USB_REG[0xC0] = 0x00;
  99   3              
 100   3                      if(gc_CX_Status_flag&CX_STL     )
 101   3                              {
 102   4                              USB_REG[0xE8] =0x03;
 103   4                              gc_CX_Status_flag =0;
 104   4                      }
 105   3                      else
 106   3                              {
 107   4                              USB_REG[0xE8] =0x00;
 108   4                      }
 109   3                      
 110   3                      USB_REG[0xA0] = 0x03;
 111   3                      }
 112   2                      USB_REG[0xD0] |= 0xFF;  //20081211 chiayen modify
 113   2                      USB_REG[0xc3]  = 0x00;  
 114   2                      USB_REG[0xD3]  = 0x10;
 115   2              }
 116   1              EX0 = 1;                // enable INT 0
C51 COMPILER V9.00   ISR                                                                   07/10/2012 15:51:50 PAGE 3   

 117   1      }
 118          
 119          /*****************************************************************************
 120          * NAME:         void Timer0(void)
 121          * DESCRIPTION:
 122          *
 123          *****************************************************************************/
 124          void Timer0() interrupt 1 using 2
 125          {
 126   1          TR0 = 0;
 127   1              TH0 = gc_T0IntervalMSB;
 128   1              TL0 = gc_T0IntervalLSB;
 129   1          TR0 = 1;
 130   1      
 131   1              gw_Random_Timer++;
 132   1      
 133   1              if(gbt_USB_Detected)
 134   1              {
 135   2      //              return;
 136   2              }
 137   1      
 138   1              gc_XTimeBase = (gc_XTimeBase >= 3)? 0:(gc_XTimeBase+1);//(JC)Timebase x 4;Timebase=~7.5ms
 139   1              switch(gc_XTimeBase)
 140   1              {
 141   2                      case 0:
 142   2      
 143   2                      break;
 144   2                      case 1:
 145   2                              if(gbLKeyTimer_Timeout==0)
 146   2                              {
 147   3                                      gbLKeyTimer_Timeout=1;  
 148   3                              }                       
 149   2                      break;
 150   2                      
 151   2                      case 2:
 152   2                              if(gbGetKey_Timeout==0)
 153   2                              {
 154   3                                      gbGetKey_Timeout=1;     
 155   3                              }               
 156   2      
 157   2                              if(gw_LogData_Timer!=0)
 158   2                              {
 159   3                                      gw_LogData_Timer--;
 160   3                                      if(gw_LogData_Timer==0)
 161   3                                      {
 162   4                                              gc_LogDataFlag=1;
 163   4                                      }
 164   3                              }
 165   2      
 166   2                              if(gc_ShowTimer!=0)
 167   2                              {
 168   3                                      gc_ShowTimer--;
 169   3                                      if(gc_ShowTimer==0)
 170   3                                      {
 171   4                                              gc_TuneVolFreqStatus=0;
 172   4                                              gb_Frequency_Song=0;
 173   4                                              gb_SelectEQ=0;
 174   4      //                                      gb_Err=0;
 175   4                                      }
 176   3                              }
 177   2                                      if(gc_ShowPingpuTimer!=0)
 178   2                                      {
C51 COMPILER V9.00   ISR                                                                   07/10/2012 15:51:50 PAGE 4   

 179   3                                              gc_ShowPingpuTimer--;
 180   3                                              gb_ShowPingpu = 0;
 181   3                                              if(gc_ShowPingpuTimer==0)       
 182   3                                              {
 183   4                                                      gb_ShowPingpu=1;
 184   4                                              }
 185   3                                      }
 186   2                                      
 187   2      
 188   2                              if(gc_ShowMenuTimer!=0)
 189   2                              {
 190   3                                      gc_ShowMenuTimer--;
 191   3                              }
 192   2      
 193   2                              if(gw_DisplayBitrateTime!=0)
 194   2                              {
 195   3                                      gw_DisplayBitrateTime--;
 196   3                              }
 197   2      
 198   2                              if(gw_IR_Setting_Timer!=0)
 199   2                              {
 200   3                                      gw_IR_Setting_Timer--;
 201   3                                      if(gw_IR_Setting_Timer==0)
 202   3                                      {
 203   4                                              gb_IR_Setting=0;
 204   4                                      }
 205   3                              }
 206   2                      
 207   2                              if(gw_AutoJpeg_Timer!=0)  //20090331
 208   2                              {
 209   3                                      gw_AutoJpeg_Timer--;
 210   3                              }
 211   2                      
 212   2                              if(gw_ChangeFrequencyTimer!=0)
 213   2                              {
 214   3                                      gw_ChangeFrequencyTimer--;
 215   3                              }
 216   2                      
 217   2                              if(gw_LCMScrollTimer!=0)
 218   2                              {
 219   3                                      gw_LCMScrollTimer--;
 220   3                              }
 221   2      
 222   2                              if(gc_Vrefinit_Timer!=0)
 223   2                              {
 224   3                                      gc_Vrefinit_Timer--;
 225   3                              }
 226   2      
 227   2                              if(gc_PlayMenu_Timeout!=0)  //20090107 chiayen add
 228   2                              {
 229   3                                      gc_PlayMenu_Timeout--;
 230   3                              }
 231   2      
 232   2                              if(gc_Dirchange_Timer!=0)  //20090107 chiayen add
 233   2                              {
 234   3                                      gc_Dirchange_Timer--;
 235   3                              }
 236   2      
 237   2                              if(gw_IR_Timer!=0)
 238   2                              {
 239   3                                      gw_IR_Timer--;
 240   3                                      if(gw_IR_Timer==0)
C51 COMPILER V9.00   ISR                                                                   07/10/2012 15:51:50 PAGE 5   

 241   3                                      {               
 242   4                                              gb_PickSongSet=1;
 243   4                                              gc_ShowTimer=72;
 244   4                                      }               
 245   3                              }
 246   2                      break;
 247   2      
 248   2                      case 3:
 249   2      
 250   2                      break;
 251   2      
 252   2                      default:
 253   2              break;
 254   2              }//switch
 255   1              //System_HostDetect();
 256   1              {
 257   2                      U8 i;
 258   2                      if(gb_HostConnect == 1)
 259   2                      {       
 260   3                              for(i=0;i<10;i++)
 261   3                              {
 262   4                                      if(XBYTE[0xB615]!=0x00)
 263   4                                      {
 264   5                                              return;
 265   5                                      }
 266   4                              }
 267   3                              gb_HostConnect = 0;
 268   3                      }
 269   2                      return;
 270   2              }
 271   1      }
 272          
 273          
 274          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    520    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
