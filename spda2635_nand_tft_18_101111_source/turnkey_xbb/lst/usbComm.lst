C51 COMPILER V9.00   USBCOMM                                                               07/10/2012 15:51:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE USBCOMM
OBJECT MODULE PLACED IN .\obj\usbComm.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\libsource\USB\usbComm.C LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\
                    -libsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\usbComm.lst) OBJECT(.\obj\usbComm.obj)

line level    source

   1          #include "SPDA2K.h"
   2          
   3          void PowerOn_Init_USB(void) 
   4          {
   5   1              /*------------- Power On USB Init --------------*/
   6   1              GLOBAL_REG[0x19] = 0x00;                        // USB Device mode
   7   1              GLOBAL_REG[0x11]|= 0x10;                        // Enable USB CLK 
   8   1              //   Enale  each clocks and Reset USB Phy       //
   9   1              //   FM + DMA + DM                              //
  10   1              //----------------------------------------------//
  11   1              GLOBAL_REG[0x16]  = 0x04;                       // power on default is 0x04
  12   1              GLOBAL_REG[0xE9] &= 0xFE;                       // Enable usb pll clk 
  13   1              USER_DelayDTms(5);                              // 使用Delay 方式不用polling方式
  14   1              GLOBAL_REG[0x1D] = 0x00;                        // 090510 Jay USB SRAM USE USB Phy clk
  15   1              GLOBAL_REG[0x02] |= 0x04;                       // bit 3   turn on USB_SW_RESET
  16   1              GLOBAL_REG[0x02] &= 0xFB;                       // bit 3   turn off USB_SW_RESET
  17   1      }
  18          
  19          
  20          void USBInitialize(void) 
  21          {
  22   1              GLOBAL_REG[0x17]  = 0x00;   //USB_READY_DISABLE;
  23   1              USB_REG[0xA0]     = 0x00;               
  24   1              USB_REG[0xA1]     = 0x00;               
  25   1              USB_REG[0xA2]     = 0x00;
  26   1              USB_REG[0x30]     = 0x0F;       
  27   1              //Enable all module clk.
  28   1              GLOBAL_REG[0xF0] = 0xFF;
  29   1              GLOBAL_REG[0xF1] = 0xFF;
  30   1              GLOBAL_REG[0xF2] = 0x00;
  31   1              
  32   1              USB_REG[0xD3] = 0xFF;           //Enable SetFeature INT.
  33   1              USB_REG[0xD2] = 0x02;           //Enable Bulk Out       
  34   1              USB_REG[0xC0] = 0x00;
  35   1              USB_REG[0xD0] = 0xFF;  
  36   1              USB_REG[0xD3] = 0x10;
  37   1              //081023 Jay add for DMA register reset
  38   1              DMA_REG[0x40] = 0x00;           // re-store default 
  39   1              DMA_REG[0x41] = 0x00;
  40   1              DMA_REG[0x90] = 0x00;
  41   1              gbt_XferNormalResponseData_or_ModeSense = NormalResponseData;
  42   1              gbt_Have_set_configuration = 0;
  43   1              gc_CX_Status_flag       = 0;
  44   1              gbt_EP0SETUP_int_flag   = 0;
  45   1              gbt_EP0RX_int_flag      = 0;
  46   1              gbt_EP0TX_int_flag      = 0;
  47   1              gbt_USBRST_int_flag     = 0;
  48   1              gbt_SUSPEND_int_flag    = 0;
  49   1              gbt_RESUME_int_flag     = 0;
  50   1              gbt_USB_CMD_IN      = 0;
  51   1              gc_USB_ADDR             = 1;
  52   1              gbt_USB_Connect_Flag    = 0;
  53   1              gbt_USER_Remove_Flag    = 0;
  54   1              
C51 COMPILER V9.00   USBCOMM                                                               07/10/2012 15:51:45 PAGE 2   

  55   1              gbt_USB_CONFIG_Chg_int_flag = 0;
  56   1              gbt_StorageMedia_has_changed =0;
  57   1              gc_Start_Stop_Flag      = 0; 
  58   1              gc_USBStage = CBWStage;
  59   1      }
  60          
  61          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    164    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
