C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE JPEG_PROCESS
OBJECT MODULE PLACED IN .\obj\Jpeg_process.obj
COMPILER INVOKED BY: F:\Keil C 7.10\chengxu\C51\BIN\C51.EXE Jpeg\Jpeg_process.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS IN
                    -CDIR(..\libsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\Jpeg_process.lst) OBJECT(.\obj\Jpeg_proce
                    -ss.obj)

line level    source

   1          #include <string.h>
   2          #include "SPDA2K.h"
   3          #include "dos\fs_struct.h"
   4          #include "dos\dosfile.h"
   5          #include "memalloc.h"
   6          #include "..\LCM\model_define.h"
   7          #include "..\DSP\DSPPHYSIC.H"
   8          #include "..\DSP\dspuser.h"
   9          #include "..\LCM\LCM.h"
  10          #include "..\LCM\UI_icon.h"
  11          #include "..\LCM\TFT_display.h"
  12          #include "..\LCM\TFT_config.h"
  13          #include "..\header\variables.h"
  14          #include "..\header\host_init.h"
  15          
  16          extern data U8 gc_PhaseInx;
  17          extern  data U8 gc_KeyDet_Mask;  //20090107 chiayen modify
  18          extern xdata System_Struct gs_System_State;
  19          extern U8  xdata EXT_NameC[];
  20          extern xdata U8  gc_Play_FileType;
  21          extern  xdata   U8      gc_LCMDispIndexBak;
  22          extern  xdata   U16     gc_DispFilePageBak;
  23          
  24          extern  void    LCM_set_view(U8 view_type, U16 x_start, U16 y_start, U16 x_size, U16 y_size);
  25          extern  void    IR_Service_Process_Menu_2();
  26          extern  void    IR_Service_Process();
  27          extern  void    ir_service_menu(void);
  28          
  29          U8 jpeg_marker_parser(U32 *tpdw_File_Ptr, U8 tw_marker_Hbyte, U8 tw_marker_Lbyte);     //Jimi 090305
  30          
  31          xdata   U8      gc_JPGSetting;
  32          xdata   U8      gc_JpegVelocityBak;
  33          extern  xdata   U8      gc_MenuItemCount;
  34          extern  data    bit     gb_TFT_refresh;
  35          
  36          /* =============== Image function =============== */
  37          void Image_WakeUp(U8 tc_Type)
  38          {       
  39   1              DSP_WakeUp(tc_Type);
  40   1      }
  41          
  42          U8 Image_Download(void)
  43          {
  44   1              U8 tc_Cnt = 0;
  45   1      
  46   1              if (DSP_Download(0x08, 0x10) != DSP_SUCCESS)
  47   1                      return DSP_PLAY_COMMAND_ERROR;
  48   1      
  49   1              for (tc_Cnt=0; tc_Cnt<10; ++tc_Cnt) {
  50   2                      if (DSP_PlayInit() == DSP_SUCCESS)
  51   2                              break;
  52   2      //              dbprintf("Retry to start DSP\n");
  53   2                      if (tc_Cnt < 5) 
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 2   

  54   2                      {
  55   3                              //GLOBAL_REG[0x02] |= 0x01;             // DSP reset, ycc mark
  56   3                              GLOBAL_REG[0x02] &= 0xFE;               // Enable DSP Run Normal Mode
  57   3                      }
  58   2                      else
  59   2                      {
  60   3      //                      dbprintf("Hardware Reset DSP!!!!!\n");
  61   3                              GLOBAL_REG[0x02] |= 0x01;               // DSP reset
  62   3                              GLOBAL_REG[0x02] &= 0xFE;               // Enable DSP Run Normal Mode
  63   3                      }
  64   2              }
  65   1              if (tc_Cnt == 10)
  66   1                      return DSP_PLAY_COMMAND_ERROR;
  67   1      
  68   1              return DSP_SUCCESS;
  69   1      }
  70          
  71          U8 Image_PlayCmd(void)
  72          {
  73   1              // sent "PLAY" command to DSP
  74   1              if (L2_DSP_SendCommandSet(DCMD_Play) != DCMD_Play)
  75   1              {
  76   2                      return DSP_PLAY_COMMAND_ERROR;
  77   2              }
  78   1      //      dbprintf("Play Cmd Ok~\n");
  79   1      
  80   1              gs_DSP_GLOBAL_RAM.sc_DM_Index = 0;              // reset bitstream buffer index
  81   1              gs_DSP_GLOBAL_RAM.sc_Pixel_Index = 0;   // reset output pixel buffer index
  82   1              gs_DSP_GLOBAL_RAM.sc_End_Of_File = 0;   // reset file end flag
  83   1      
  84   1              // JPEG file open
  85   1              if (DOS_Open_File_r(C_OtherFHandle, C_Open_FoundFile, C_NullFileName))
  86   1                      return DSP_PLAY_COMMAND_ERROR;
  87   1      
  88   1              return DSP_SUCCESS;
  89   1      }
  90          
  91          
  92          U8 Image_DataIn(void)
  93          {
  94   1              if (!gs_DSP_GLOBAL_RAM.sc_End_Of_File)
  95   1              {
  96   2               // Jimi 090305 
  97   2                      if(gc_Play_FileType != 1)
  98   2                      {
  99   3                              while(L2_DSP_Read_DMem16(DSP_EmptyBuffer) > ONE_SECTOR)
 100   3                              {
 101   4                                      if (DOS_Read_File(C_OtherFHandle) != DOS_END_OF_FILE)
 102   4                                      {
 103   5                          L2_DSP_MCU_DM_DMA(gs_DSP_GLOBAL_RAM.sc_DM_Index++, 0x2E, (U16)gc_PlayRecordDataBuf, DM
             -A_24BIT_MODE);
 104   5      
 105   5                                              if (L2_DSP_SendCommandSet(DCMD_DatIn) != DCMD_DatIn)
 106   5                                              {
 107   6      //                                              dbprintf("DSP_DATAIN_COMMAND_ERROR\n");
 108   6                                                      return DSP_DATAIN_COMMAND_ERROR;
 109   6                                              }
 110   5                      
 111   5                                              if (gs_DSP_GLOBAL_RAM.sc_DM_Index >= 3) // JPEG bitstream buffer 0x3400~0x3600, sz = 1536 bytes
 112   5                                                      gs_DSP_GLOBAL_RAM.sc_DM_Index = 0;
 113   5                                      }
 114   4                                      else
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 3   

 115   4                                      {
 116   5      //                                      dbprintf("file-end\n");
 117   5                                              L2_DSP_Write_DMem16(0x3F44, 0x00FF);    // JPEG file end flag
 118   5                                              gs_DSP_GLOBAL_RAM.sc_End_Of_File = 1;
 119   5                                              break;
 120   5                                      }
 121   4                              }
 122   3                      }
 123   2                      
 124   2                      else
 125   2                      {
 126   3                              U8 i;
 127   3                              for(i=0; i<5; i++)
 128   3                              {
 129   4                                      if(L2_DSP_Read_DMem16(DSP_EmptyBuffer) > ONE_SECTOR)
 130   4                                      {
 131   5                                              if (DOS_Read_File(C_OtherFHandle) != DOS_END_OF_FILE)
 132   5                                              {
 133   6                              L2_DSP_MCU_DM_DMA(gs_DSP_GLOBAL_RAM.sc_DM_Index++, 0x2E, (U16)gc_PlayRecordDataBuf
             -, DMA_24BIT_MODE);
 134   6                                                      if (L2_DSP_SendCommandSet(DCMD_DatIn) != DCMD_DatIn)
 135   6                                                      {
 136   7      //                                                      dbprintf("DSP_DATAIN_COMMAND_ERROR\n");
 137   7                                                              return DSP_DATAIN_COMMAND_ERROR;
 138   7                                                      }
 139   6                              
 140   6                                                      if (gs_DSP_GLOBAL_RAM.sc_DM_Index >= 3) // JPEG bitstream buffer 0x3400~0x3600, sz = 1536 bytes
 141   6                                                              gs_DSP_GLOBAL_RAM.sc_DM_Index = 0;
 142   6                                              }
 143   5                                              else
 144   5                                              {
 145   6      //                                              dbprintf("file-end\n");
 146   6                                                      L2_DSP_Write_DMem16(0x3F44, 0x00FF);    // JPEG file end flag
 147   6                                                      gs_DSP_GLOBAL_RAM.sc_End_Of_File = 1;
 148   6                                                      return  DSP_DECODE_END; // 20100412 - BMP error
 149   6                                              }
 150   5                                      }
 151   4                              }
 152   3                      }
 153   2              }
 154   1              return  DSP_SUCCESS;
 155   1      }
 156          
 157          
 158          void Image_MCU_LCM_DMA(U16 movesize, U16 tw_Src)
 159          {
 160   1              XBYTE[0xB304] = 0x09; //reset DMA machine
 161   1              XBYTE[0xB304] = 0x08; 
 162   1      
 163   1              XBYTE[0xB423] = 3;              // set NAND /CS(bit 0), /WP(bit 1), ALE(bit 2), CLE(bit 3)
 164   1      
 165   1              FLASH_REG[0x00] = 0x00;
 166   1              DMA_REG[0x01] = 0x20;           //Sram to Flash
 167   1      
 168   1              // source
 169   1              CPU_REG[0x12] = (U8)(tw_Src);
 170   1              CPU_REG[0x13] = (U8)(tw_Src >> 8);
 171   1      
 172   1              // size
 173   1              DMA_REG[0x02] = (U8)(movesize-1);
 174   1              DMA_REG[0x03] = (U8)((movesize-1) >> 8);
 175   1      
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 4   

 176   1              DMA_REG[0xC0] = 0x00;           //clear DMA completed flag
 177   1              LCM_A0_HI;
 178   1              LCM_CS_LO;
 179   1              DMA_REG[0xB0] = 0x01;           //trigger DMA
 180   1              while(DMA_REG[0xC0] == 0);
 181   1              DMA_REG[0xC0] = 0;
 182   1              LCM_CS_HI;
 183   1              LCM_A0_LO;
 184   1      
 185   1              FLASH_REG[0x00] = 0x01;
 186   1      }
 187          
 188          
 189          U8 Image_DataOut(void)
 190          {
 191   1              U16 RemData = L2_DSP_Read_DMem16(DSP_SOutBufRemData);
 192   1      
 193   1              if (RemData >= ONE_SECTOR)
 194   1              {
 195   2                      do
 196   2                      {
 197   3                              L2_DSP_DM_MCU_DMA(gs_DSP_GLOBAL_RAM.sc_Pixel_Index++, 9, (U16)gc_PlayRecordDataBuf, DMA_16BIT_MODE);
 198   3                              if (L2_DSP_SendCommandSet(DCMD_DatOut) != DCMD_DatOut)
 199   3                              {
 200   4      //                              dbprintf("DSP_DATAOUT_COMMAND_ERROR\n");
 201   4                                      return DSP_DATAOUT_COMMAND_ERROR;
 202   4                              }
 203   3      
 204   3                  if (gs_DSP_GLOBAL_RAM.sc_Pixel_Index >= 10) // JPEG output pixel buffer 0x3000~0x3A00, sz = 25
             -60*2 bytes
 205   3                                      gs_DSP_GLOBAL_RAM.sc_Pixel_Index = 0;
 206   3                      
 207   3                              /* ==== Display on LCM: DMA Sram to LCM ==== */
 208   3                              Image_MCU_LCM_DMA(ONE_SECTOR, (U16)gc_PlayRecordDataBuf);
 209   3                      } while (L2_DSP_Read_DMem16(DSP_SOutBufRemData) >= ONE_SECTOR);
 210   2              }
 211   1              else if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x00C0)
 212   1              {
 213   2                      if (RemData > 0)
 214   2                      {
 215   3                              L2_DSP_DM_MCU_DMA(gs_DSP_GLOBAL_RAM.sc_Pixel_Index, 9, (U16)gc_PlayRecordDataBuf, DMA_16BIT_MODE);
 216   3                              if (L2_DSP_SendCommandSet(DCMD_DatOut) != DCMD_DatOut)
 217   3                              {
 218   4      //                              dbprintf("DSP_DATAOUT_COMMAND_ERROR\n");
 219   4                                      return DSP_DATAOUT_COMMAND_ERROR;
 220   4                              }
 221   3      
 222   3                              /* ==== Display on LCM: DMA Sram to LCM ==== */
 223   3                              Image_MCU_LCM_DMA(RemData, (U16)gc_PlayRecordDataBuf);
 224   3                      }
 225   2      //              dbprintf("JPEG DSP decode end!!\n");
 226   2                      return DSP_DECODE_END;
 227   2              }
 228   1              else if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x0020)
 229   1              {
 230   2      //              dbprintf("JPEG error format!!\n");
 231   2                      return DSP_USER_FILE_TYPE_ERROR;
 232   2              }
 233   1      
 234   1              return DSP_SUCCESS;
 235   1      }
 236          
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 5   

 237          U8 Image_StopCmd(U8 tc_FileHandle)
 238          {
 239   1              U8 tc_Ret, tc_state;
 240   1              U16 TimeOUT;
 241   1              
 242   1              tc_Ret = DSP_StopCmd();
 243   1              TimeOUT = 0xffff;
 244   1              while (1)
 245   1              {
 246   2                      TimeOUT--;
 247   2                      if (TimeOUT == 0)
 248   2                      {
 249   3      //                      dbprintf("JPEG stop command time out\n");
 250   3                              tc_Ret = DSP_DECODE_STATUS_TIMEOUT_ERROR;
 251   3                              break;
 252   3                      }
 253   2      
 254   2                      tc_state = Image_DataIn();
 255   2                      if (tc_state == DSP_DATAIN_COMMAND_ERROR)
 256   2                      {
 257   3                              tc_Ret = tc_state;
 258   3                              break;
 259   3                      }
 260   2      
 261   2                      tc_state = Image_DataOut();
 262   2      
 263   2                      if (tc_state == DSP_DATAOUT_COMMAND_ERROR)
 264   2                      {
 265   3                              tc_Ret = tc_state;
 266   3                              break;
 267   3                      }
 268   2                      else if (tc_state == DSP_USER_FILE_TYPE_ERROR)
 269   2                      {
 270   3                              tc_Ret = tc_state;
 271   3                              L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFFDF));
 272   3                              break;
 273   3                      }
 274   2                      else if (tc_state == DSP_DECODE_END)
 275   2                      {
 276   3                              L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFF3F)); 
 277   3                              break;
 278   3                      }
 279   2              }
 280   1      
 281   1              // Close current file
 282   1      //      dbprintf("JPEG DOS close file\n");
 283   1              gw_AutoJpeg_Timer=(U16)(gc_JpegVelocity+1)*36;
 284   1              DOS_Close_File_r(tc_FileHandle);
 285   1      
 286   1              return tc_Ret;
 287   1      }
 288          
 289          /* =============== GIF function =============== */
 290          U8 GIF_DataIn(void)
 291          {
 292   1              if (L2_DSP_Read_DMem16(DSP_EmptyBuffer) >= ONE_SECTOR)
 293   1              {
 294   2                      if (DOS_Read_File(C_OtherFHandle) != DOS_END_OF_FILE)
 295   2                      {
 296   3                  L2_DSP_MCU_DM_DMA(gs_DSP_GLOBAL_RAM.sc_DM_Index++, 0x2E, (U16)gc_PlayRecordDataBuf, DMA_24BIT_
             -MODE);
 297   3                              if (L2_DSP_SendCommandSet(DCMD_DatIn) != DCMD_DatIn)
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 6   

 298   3                              {
 299   4      //                              dbprintf("DSP_DATAIN_COMMAND_ERROR\n");
 300   4                                      return DSP_DATAIN_COMMAND_ERROR;
 301   4                              }
 302   3              
 303   3                              if (gs_DSP_GLOBAL_RAM.sc_DM_Index >= 3) // JPEG bitstream buffer 0x3400~0x3600, sz = 1536 bytes
 304   3                                      gs_DSP_GLOBAL_RAM.sc_DM_Index = 0;
 305   3                      }
 306   2                      else
 307   2                      {
 308   3      //                      dbprintf("Re-start GIF file\n");
 309   3                              gs_File_FCB[gs_System_State.c_FileHandle].dw_File_CurrentCluster = gs_File_FCB[gs_System_State.c_FileHa
             -ndle].dw_File_StartCluster;
 310   3                              gs_File_FCB[gs_System_State.c_FileHandle].dw_File_CurrentCluster = DOS_Seek_File(gs_System_State.c_File
             -Handle, 0);
 311   3                      }
 312   2      
 313   2              }
 314   1              return  DSP_SUCCESS;
 315   1      }
 316          
 317          
 318          void GIF_DM_MCU_DMA(U16 BufferIndex,U8 tc_PowerOf2, U16 tw_Src)
 319          {
 320   1              U8  tc_DSPAddr_High;
 321   1              U16 tw_MoveSize;
 322   1      
 323   1              // ----- DMA Reset -----
 324   1              DMA_REG[0x04] = 0x09;
 325   1              DMA_REG[0x04] = 0x08;
 326   1              DMA_REG[0xC0] = 0x00;           // clear DMA complete
 327   1              DMA_REG[0x30] = 0x01;           // clear checksum               
 328   1                      
 329   1              // ----- DMA initial settings for DM transfer -----             
 330   1              DSP_REG[0x16] = 0x00;           // Remain DSP mode.  When you do MCU -> DM, MCU will stop DSP automaticlly
 331   1              DMA_REG[0x01] = 0x05;           // DM -> SRAM
 332   1      
 333   1              // Define data size in DMA              
 334   1              tw_MoveSize = (1 << tc_PowerOf2) - 1;
 335   1              DMA_REG[0x02] = ((U8 *)(&tw_MoveSize))[1];
 336   1              DMA_REG[0x03] = ((U8 *)(&tw_MoveSize))[0];
 337   1      
 338   1              // Source
 339   1              DMA_REG[0x40] = 0x01;           // 16-bit DMA
 340   1              DSP_REG[0x1D] = 0x01;
 341   1              tc_DSPAddr_High = (U8)(((BufferIndex << tc_PowerOf2) >> 1) >> 8);
 342   1          DSP_REG[0x18] = tc_DSPAddr_High + 0x2D;     // GIF output pixel start address : 0x3700
 343   1              DSP_REG[0x17] = (U8)((BufferIndex << tc_PowerOf2) >> 1);
 344   1      
 345   1              // Destination
 346   1              CPU_REG[0x14] = (U8)(tw_Src);
 347   1              CPU_REG[0x15] = (U8)(tw_Src >> 8);
 348   1      
 349   1              // ------------------------------------------------
 350   1              DMA_REG[0xB0] = 0x01;           // DMA1 start
 351   1              // wait until DMA cycle is completed (0xB3C0)           
 352   1              while (!(DMA_REG[0xC0]&0x01));
 353   1              DMA_REG[0xC0] = 0x00;
 354   1      }
 355          
 356          
 357          U8 GIF_DataOut(void)
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 7   

 358          {
 359   1              U16 RemData = L2_DSP_Read_DMem16(DSP_SOutBufRemData);
 360   1              if (RemData >= 256)
 361   1              {
 362   2                      GIF_DM_MCU_DMA(gs_DSP_GLOBAL_RAM.sc_Pixel_Index++, 8, (U16)gc_PlayRecordDataBuf);
 363   2                      if (L2_DSP_SendCommandSet(DCMD_DatOut) != DCMD_DatOut)
 364   2                      {
 365   3      //                      dbprintf("DSP_DATAOUT_COMMAND_ERROR\n");
 366   3                              return DSP_DATAOUT_COMMAND_ERROR;
 367   3                      }
 368   2      
 369   2                      if (gs_DSP_GLOBAL_RAM.sc_Pixel_Index >= 2) // GIF output pixel buffer 0x3700~0x37FF, sz = 256*2 bytes
 370   2                              gs_DSP_GLOBAL_RAM.sc_Pixel_Index = 0;
 371   2      
 372   2                      /* ==== Display on LCM: DMA Sram to LCM ==== */
 373   2                      Image_MCU_LCM_DMA(256, (U16)gc_PlayRecordDataBuf);
 374   2              }
 375   1              else if (L2_DSP_Read_DMem16(0x3F8A) == 49)
 376   1              {
 377   2                      if (RemData > 0)
 378   2                      {
 379   3                              GIF_DM_MCU_DMA(gs_DSP_GLOBAL_RAM.sc_Pixel_Index++, 8, (U16)gc_PlayRecordDataBuf);
 380   3                              if (L2_DSP_SendCommandSet(DCMD_DatOut) != DCMD_DatOut)
 381   3                              {
 382   4      //                              dbprintf("DSP_DATAOUT_COMMAND_ERROR\n");
 383   4                                      return DSP_DATAOUT_COMMAND_ERROR;
 384   4                              }
 385   3                              /* ==== Display on LCM: DMA Sram to LCM ==== */
 386   3                              Image_MCU_LCM_DMA(RemData, (U16)gc_PlayRecordDataBuf);
 387   3                      }
 388   2                      gs_DSP_GLOBAL_RAM.sc_Pixel_Index = 0;
 389   2                      L2_DSP_Write_DMem16(0x3F8A, 0);
 390   2              }
 391   1              else if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x0020)
 392   1              {
 393   2      //              dbprintf("GIF error format!!\n");
 394   2                      //L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFFDF));
 395   2                      return DSP_USER_FILE_TYPE_ERROR;
 396   2              }
 397   1      
 398   1              return DSP_SUCCESS;
 399   1      }
 400          
 401          
 402          U8 GIF_StopCmd(U8 tc_FileHandle)
 403          {
 404   1              U8 tc_Ret, tc_state;
 405   1              U16 TimeOUT;
 406   1              
 407   1              tc_Ret = DSP_StopCmd();
 408   1      
 409   1              if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x0020)        // reset DSP_DecodeStatus
 410   1                      L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFFDF));
 411   1      
 412   1              TimeOUT = 0xffff;
 413   1              while (1)
 414   1              {
 415   2                      TimeOUT--;
 416   2                      if (TimeOUT == 0)
 417   2                      {
 418   3      //                      dbprintf("GIF stop command time out\n");
 419   3                              tc_Ret = DSP_DECODE_STATUS_TIMEOUT_ERROR;
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 8   

 420   3                              break;
 421   3                      }
 422   2      
 423   2                      tc_state = GIF_DataIn();
 424   2                      if (tc_state == DSP_DATAIN_COMMAND_ERROR)
 425   2                      {
 426   3                              tc_Ret = tc_state;
 427   3                              break;
 428   3                      }
 429   2      
 430   2                      tc_state = GIF_DataOut();
 431   2                      if (tc_state == DSP_DATAOUT_COMMAND_ERROR)
 432   2                      {
 433   3                              tc_Ret = tc_state;
 434   3                              break;
 435   3                      }
 436   2                      else if (tc_state == DSP_USER_FILE_TYPE_ERROR)
 437   2                      {
 438   3                              tc_Ret = tc_state;
 439   3                              L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFFDF));
 440   3                              break;
 441   3                      }
 442   2      
 443   2                      if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x00C0)        //wait file end
 444   2                      {
 445   3      //                      dbprintf("GIF DSP decode end!!\n");
 446   3                              L2_DSP_Write_DMem16(DSP_DecodeStatus, (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0xFF3F)); 
 447   3                              break;
 448   3                      }
 449   2              }               
 450   1      
 451   1              // Close current file
 452   1      //      dbprintf("GIF DOS close file\n");
 453   1              gw_AutoJpeg_Timer=(U16)(gc_JpegVelocity+1)*36;
 454   1              DOS_Close_File_r(tc_FileHandle);
 455   1      
 456   1              return tc_Ret;
 457   1      }
 458          
 459          //=================(JC)Jpeg ctrl flow====================
 460          void jpeg_idle()
 461          {
 462   1      
 463   1      }
 464          
 465          void jpeg_init()
 466          {       
 467   1              if(gw_init_needed & SET_BIT4)
 468   1              {
 469   2      //              dbprintf("=jpeg init=\n");
 470   2                      gc_DispFilePageBak=0xFFFF;
 471   2                      gw_init_needed&=CLR_BIT4;
 472   2                      
 473   2                      gs_System_State.c_Phase = TASK_PHASE_STOP;
 474   2                      gs_DSP_GLOBAL_RAM.sw_Volume = 42;//(JC)init value
 475   2      
 476   2      
 477   2                      gs_System_State.c_FileHandle = 2;
 478   2                      gs_File_FCB[gs_System_State.c_FileHandle].dw_FDB_StartCluster = gdw_DOS_RootDirClus;
 479   2      
 480   2                      EXT_NameC[0] = 3;
 481   2                      EXT_NameC[1] = 'J';
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 9   

 482   2                      EXT_NameC[2] = 'P';
 483   2                      EXT_NameC[3] = 'G';
 484   2                      EXT_NameC[4] = 'B';
 485   2                      EXT_NameC[5] = 'M';
 486   2                      EXT_NameC[6] = 'P';
 487   2                      EXT_NameC[7] = 'G';
 488   2                      EXT_NameC[8] = 'I';
 489   2                      EXT_NameC[9] = 'F';
 490   2                      DOS_Search_File(C_File_All|C_Cnt_FileNo,C_OtherFileType,C_CmpExtName|C_Next);
 491   2      
 492   2                      if(DOS_Search_File(C_File_All|C_By_FDB, C_OtherFHandle, C_CmpExtName|C_Next))
 493   2                      //if(gw_FileTotalNumber[2]==0)
 494   2                      {
 495   3      //                      dbprintf("!No picture files!\n");
 496   3                              gw_init_needed |= SET_BIT8;
 497   3                              gc_Task_Next=C_Task_Menu;
 498   3                              gc_PhaseInx = 0;
 499   3                              return;
 500   3                      }
 501   2                      gc_Play_FileType=gs_File_FCB[gs_System_State.c_FileHandle].c_FileType;
 502   2      //              set_clock_mode(CLOCK_MODE_JPEG);        // removed by maxliao 
 503   2              }
 504   1              gc_PhaseInx = C_JpegPause; //Ching 090316
 505   1      }
 506          
 507          void jpeg_proc()
 508          {
 509   1              gc_KeyDet_Mask = 0;
 510   1      
 511   1              if (gc_Play_FileType == 2)      // test
 512   1              {
 513   2                      if (GIF_DataIn() == DSP_DATAIN_COMMAND_ERROR)
 514   2                      {
 515   3      //                      dbprintf("GIF data in end\n");
 516   3                              gc_PhaseInx = 4;
 517   3                      }
 518   2                      
 519   2                      if (GIF_DataOut() != DSP_SUCCESS )
 520   2                      {       // "error format" -> set stop command
 521   3      //                      dbprintf("GIF data out end\n");
 522   3                              gc_PhaseInx = 4;
 523   3                      }
 524   2              }
 525   1              else
 526   1              {
 527   2              if (Image_DataIn() != DSP_SUCCESS)      // 20100412 - BMP error
 528   2                      {
 529   3      //                      dbprintf("JPEG data in end\n");
 530   3                              gc_PhaseInx = 4;
 531   3                      }
 532   2                      
 533   2                      if (Image_DataOut() != DSP_SUCCESS )
 534   2                      {       // "file end" or "error format" -> set stop command
 535   3      //                      dbprintf("JPEG data out end\n");
 536   3                              gc_PhaseInx = 4;
 537   3                      }
 538   2              }
 539   1      }
 540          
 541          void jpeg_playpause()
 542          {
 543   1              U16     i;      
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 10  

 544   1      
 545   1              if (gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 546   1              {
 547   2      //              dbprintf("Keep decoding...\n");
 548   2              }
 549   1              else
 550   1              {
 551   2      //              dbprintf("=play jpeg=\n");
 552   2                      
 553   2                      //jpeg init
 554   2                      //clock setting
 555   2      //              set_clock_mode(CLOCK_MODE_JPEG);
 556   2      
 557   2                      //Draw a black frame
 558   2                      for (i=0; i<512; i++)
 559   2                      {
 560   3                              ((U32 *)gc_MotionJpegOutBuf)[i] = 0;
 561   3                      }
 562   2      
 563   2                      LCM_set_view(TFT_BMPDispDir, 0, 0, TFT_H_Size, TFT_V_Size); // vertical view, Jimi 090305
 564   2      
 565   2                      for (i=0; i<20; i++)            //Jimi 090305 for 128x160 LCM
 566   2                      {
 567   3                              Image_MCU_LCM_DMA(2048, (U16)gc_MotionJpegOutBuf);
 568   3                      }
 569   2      
 570   2                      Image_WakeUp(DSP_CLK_CTRL | SRAM2T_CTRL);
 571   2      
 572   2                      if (Image_Download())   // Load IM, PM
 573   2                      {
 574   3      //                      dbprintf("load IMPM err!\n");
 575   3                      }
 576   2      
 577   2      //              dbprintf("gc_Play_FileType = %bx\n",gc_Play_FileType);     //Jimi 090305
 578   2                      //Set file type, 0: SCV, 1: JPEG, 2: BMP, 3: GIF, 4: AMV
 579   2                      if (gc_Play_FileType == 0)
 580   2                      {
 581   3                              L2_DSP_Write_DMem16(0x3F2F, 0x0001);    // JPEG file
 582   3                              /* Jimi 090305 , JPEG parser to get image height & length */
 583   3                              {
 584   4                                      U32 tdw_File_Ptr;
 585   4                                      U16 tw_Buf_idx;
 586   4                                      U16 tw_img_height=0;
 587   4                                      U16 tw_img_width=0;
 588   4                                      U16 tw_rem_data;
 589   4                                      U8 tc_ret;
 590   4                                      U8 tc_SOF_Buf[7];
 591   4                                      //Open File
 592   4                                      if(DOS_Open_File_r(C_OtherFHandle, C_Open_FoundFile, C_NullFileName) || (gs_File_FCB[0].dw_File_TotalS
             -ize==0)) 
 593   4                                      {
 594   5                                              //gs_System_State.w_BitRate=0;
 595   5      //                                      dbprintf("open file err\n");    
 596   5                                      }
 597   4                              //Read File
 598   4                                      gb_ReadWriteDataArea = 0;               //select gc_PlayRecordDataBuf[]
 599   4                                      DOS_Read_File(C_OtherFHandle);
 600   4      
 601   4                                      tdw_File_Ptr = 0;
 602   4                                      //find SOI marker
 603   4                                      tc_ret = jpeg_marker_parser(&tdw_File_Ptr, 0xFF, 0xD8);
 604   4                                      if(!tc_ret)
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 11  

 605   4                                      {
 606   5      //                                      dbprintf("SOI File Pointer = %lx\n", tdw_File_Ptr);
 607   5      
 608   5                                              //find SOF marker
 609   5                                              tc_ret = jpeg_marker_parser(&tdw_File_Ptr, 0xFF, 0xC0);                 
 610   5                                              if(!tc_ret)
 611   5                                              {
 612   6      //                                              dbprintf("SOF File Pointer = %lx\n", tdw_File_Ptr);
 613   6                                              
 614   6                                                      tw_Buf_idx = tdw_File_Ptr & 0x1FF;
 615   6                                                      if(tw_Buf_idx ==0)
 616   6                                                      {
 617   7                                                              DOS_Read_File(C_OtherFHandle);
 618   7                                                      }
 619   6      
 620   6                                                      tw_rem_data = 512 - tw_Buf_idx;
 621   6                                                      if(tw_rem_data >= 7)
 622   6                                                      {
 623   7                                                              memcpy(tc_SOF_Buf, &gc_PlayRecordDataBuf[tw_Buf_idx], 7);
 624   7                                                      }
 625   6                                                      else
 626   6                                                      {
 627   7                                                              memcpy(tc_SOF_Buf, &gc_PlayRecordDataBuf[tw_Buf_idx], tw_rem_data);
 628   7                                                              tw_Buf_idx = 0;
 629   7                                                              DOS_Read_File(C_OtherFHandle);
 630   7                                                              memcpy(&tc_SOF_Buf[tw_rem_data], &gc_PlayRecordDataBuf[0], (7-tw_rem_data));
 631   7                                                      }       
 632   6      
 633   6                                                      ((U8 *)(&tw_img_height))[0] = tc_SOF_Buf[3];
 634   6                                                      ((U8 *)(&tw_img_height))[1] = tc_SOF_Buf[4];
 635   6      //                                              dbprintf("tw_img_height = %x\n", tw_img_height);
 636   6                                                      ((U8 *)(&tw_img_width))[0] = tc_SOF_Buf[5];
 637   6                                                      ((U8 *)(&tw_img_width))[1] = tc_SOF_Buf[6];
 638   6      //                                              dbprintf("tw_img_width = %x\n", tw_img_width);
 639   6                                              }
 640   5      
 641   5                                              {
 642   6                                                      // horizontal view
 643   6                                                      LCM_set_view(/*TFT_JPGDispDir*/1, 0, 0, TFT_H_Size, TFT_V_Size); // horizontal view
 644   6                                                      L2_DSP_Write_DMem16(0x3F40, TFT_H_Size);                  // Set width
 645   6                                                      L2_DSP_Write_DMem16(0x3F41, TFT_V_Size);                          // Set height
 646   6                                              }
 647   5      
 648   5                                              L2_DSP_Write_DMem16(0x3F48, 0x0000);                            // Set background color
 649   5                                      }
 650   4                              }
 651   3                      }
 652   2                      else if (gc_Play_FileType == 1)
 653   2                      {
 654   3                              L2_DSP_Write_DMem16(0x3F2F, 0x0002);    // BMP file
 655   3                              LCM_set_view(TFT_BMPDispDir, 0, 0, TFT_H_Size, TFT_V_Size); // horizontal view in BMP order
 656   3                      }
 657   2                      else
 658   2                      {
 659   3                              L2_DSP_Write_DMem16(0x3F2F, 0x0003);    // GIF file
 660   3                      }
 661   2      
 662   2              //DSP_Write_MMR16(0x3FD4, DSP_Read_MMR16(0x3FD4)|0x18);  //20090324 jimi add (set DSP Jpeg hardwar
             -e clock) 
 663   2                      if (Image_PlayCmd() == DSP_PLAY_COMMAND_ERROR)
 664   2                      {
 665   3      //                      dbprintf("SYS play init fail\n");
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 12  

 666   3                      }
 667   2                      
 668   2                      if (gc_Play_FileType == 2)
 669   2                      {       // Set GIF display range
 670   3                              U16 tw_width, tw_height, tw_x_start, tw_y_start;
 671   3      
 672   3                              if (GIF_DataIn() == DSP_DATAIN_COMMAND_ERROR)
 673   3                              {
 674   4      //                              dbprintf("Data in command error\n");
 675   4                                      gs_System_State.c_Phase = TASK_PHASE_PLAYACT;
 676   4                                      gc_PhaseInx = 4;
 677   4                                      gc_KeyDet_Mask = 0;
 678   4                                      return;
 679   4                              }
 680   3      
 681   3                              while (L2_DSP_Read_DMem16(0x3F5E) == 0)
 682   3                              {
 683   4                                      if (L2_DSP_Read_DMem16(DSP_DecodeStatus)&0x0020)        // GIF error format
 684   4                                      {
 685   5      //                                      dbprintf("GIF error format!!\n");
 686   5                                              gs_System_State.c_Phase = TASK_PHASE_PLAYACT;
 687   5                                              gc_PhaseInx = 4;
 688   5                                              gc_KeyDet_Mask = 0;
 689   5                                              return;
 690   5                                      }
 691   4                              }
 692   3                              tw_width = L2_DSP_Read_DMem16(0x3F5D);
 693   3                              tw_height = L2_DSP_Read_DMem16(0x3F5E);
 694   3      //                      dbprintf("width = %x, height = %x\n", tw_width, tw_height);
 695   3                              //Jimi 090305
 696   3                              tw_x_start = (TFT_H_Size - tw_width) >> 1;
 697   3                              tw_y_start = (TFT_V_Size - tw_height) >> 1;
 698   3                              LCM_set_view(TFT_IconDispDir, tw_x_start, tw_y_start, tw_width, tw_height); // horizontal view in norma
             -l order
 699   3                      }
 700   2                      //Jimi 090305
 701   2                      else if(gc_Play_FileType == 1)
 702   2                      {
 703   3                              /* ===== Setup DSP parameter ===== */
 704   3                              L2_DSP_Write_DMem16(0x3F40, TFT_H_Size);                // Set width  // horizontal view in normal order
 705   3                              L2_DSP_Write_DMem16(0x3F41, TFT_V_Size);                // Set height
 706   3                              L2_DSP_Write_DMem16(0x3F48, 0x0000);                            // Set background color
 707   3                      }
 708   2      
 709   2                      gs_System_State.c_Phase = TASK_PHASE_PLAYACT;
 710   2              }
 711   1              gc_PhaseInx = 2;
 712   1      }
 713          
 714          void jpeg_stop()
 715          {
 716   1              U8 tc_Ret;
 717   1      
 718   1      //      dbprintf("jpeg_stop!\n");
 719   1              if (gs_System_State.c_Phase != TASK_PHASE_STOP)
 720   1              {                       
 721   2                      //jpeg stop
 722   2                      if (gc_Play_FileType == 2)
 723   2                      {
 724   3                              tc_Ret = GIF_StopCmd(gs_System_State.c_FileHandle);
 725   3                      }
 726   2                      else
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 13  

 727   2                      {
 728   3                              tc_Ret = Image_StopCmd(gs_System_State.c_FileHandle);
 729   3                      }
 730   2      
 731   2                      if (tc_Ret != DSP_SUCCESS)
 732   2                      {
 733   3      //                      dbprintf("JPEG stop error !!\n");
 734   3                      }
 735   2      
 736   2                      gs_System_State.c_Phase = TASK_PHASE_STOP;
 737   2              }
 738   1              gc_PhaseInx = 0;        //Jimi 090305
 739   1      
 740   1      }
 741          
 742          
 743          void jpeg_endfile()
 744          {
 745   1              //stop DSP 'n close file
 746   1              jpeg_stop();
 747   1      }
 748          
 749          
 750          void jpeg_next()
 751          {
 752   1      
 753   1      //      dbprintf("jpeg next!\n");
 754   1      
 755   1              if (gs_System_State.c_Phase == TASK_PHASE_STOP)
 756   1              {
 757   2                      if (gw_FileIndex[gs_System_State.c_FileHandle] == 0)
 758   2                      {
 759   3                              return;//if no this line,error will happen
 760   3                      }
 761   2      
 762   2                      gc_PhaseInx = 3;
 763   2              }
 764   1              else if (gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 765   1              {
 766   2                      gc_PhaseInx = 3;
 767   2                      gc_KeyDet_Mask = 1;//(JC)H0508 avoid key-press to change phase index    
 768   2              }
 769   1              /*else if (gs_System_State.c_Phase == TASK_PHASE_PAUSE)
 770   1              {
 771   1                      gc_PhaseInx = 0;
 772   1              }*/
 773   1      
 774   1              if (gs_System_State.c_Phase != TASK_PHASE_STOP)
 775   1              {
 776   2                      U8 tc_Ret;
 777   2                      if (gc_Play_FileType == 2)
 778   2                      {
 779   3                              tc_Ret = GIF_StopCmd(gs_System_State.c_FileHandle);
 780   3                      }
 781   2                      else
 782   2                      {
 783   3                              tc_Ret = Image_StopCmd(gs_System_State.c_FileHandle);
 784   3                      }
 785   2                      if (tc_Ret != DSP_SUCCESS)
 786   2                      {
 787   3      //                      dbprintf("JPEG stop error !!\n");
 788   3                      }
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 14  

 789   2                      
 790   2                      gs_System_State.c_Phase = TASK_PHASE_STOP;
 791   2              }
 792   1      
 793   1              DOS_Search_File(C_File_All|C_By_FDB, C_OtherFileType, C_CmpExtName|C_Next);
 794   1              gc_Play_FileType=gs_File_FCB[gs_System_State.c_FileHandle].c_FileType;           //Jimi 090305
 795   1      
 796   1              if((gc_AutoJpeg_Flag==1) && (gc_Play_FileType==2) && (gc_JpegVelocity==0))  //20090331
 797   1              {
 798   2                      gw_AutoJpeg_Timer=(U16)(gc_JpegVelocity+1)*36;  
 799   2              }       
 800   1      }
 801          
 802          void jpeg_prev()
 803          {
 804   1      //      dbprintf("jpeg prev!\n");
 805   1      
 806   1              if (gs_System_State.c_Phase == TASK_PHASE_STOP)
 807   1              {
 808   2                      if (gw_FileIndex[gs_System_State.c_FileHandle] == 0)
 809   2                              return;//if no this line,error will happen
 810   2                      gc_PhaseInx = 3;
 811   2              }
 812   1              else if (gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 813   1              {
 814   2                      gc_PhaseInx = 3;
 815   2                      gc_KeyDet_Mask = 1;//(JC)H0508 avoid key-press to change phase index            
 816   2              }
 817   1              /*else if (gs_System_State.c_Phase == TASK_PHASE_PAUSE)
 818   1              {
 819   1                      gc_PhaseInx = 0;
 820   1              }*/
 821   1              
 822   1              if (gs_System_State.c_Phase != TASK_PHASE_STOP)//(JC)H0505
 823   1              {
 824   2                      U8 tc_Ret;
 825   2                      if (gc_Play_FileType == 2)
 826   2                      {
 827   3                              tc_Ret = GIF_StopCmd(gs_System_State.c_FileHandle);
 828   3                      }
 829   2                      else
 830   2                      {
 831   3                              tc_Ret = Image_StopCmd(gs_System_State.c_FileHandle);
 832   3                      }
 833   2                      if (tc_Ret != DSP_SUCCESS)
 834   2                      {
 835   3      //                      dbprintf("JPEG stop error !!\n");
 836   3                      }
 837   2      
 838   2                      gs_System_State.c_Phase = TASK_PHASE_STOP;
 839   2              }
 840   1      
 841   1              DOS_Search_File(C_File_All|C_By_FDB, C_OtherFileType, C_CmpExtName|C_Prev);
 842   1              gc_Play_FileType=gs_File_FCB[gs_System_State.c_FileHandle].c_FileType;          //Jimi 090305
 843   1      }
 844          
 845          
 846          void jpeg_back2uplevel()
 847          {
 848   1              if((gs_System_State.c_Phase == TASK_PHASE_PLAYACT) || (gs_System_State.c_Phase == TASK_PHASE_PAUSE))
 849   1              {
 850   2                      jpeg_stop();    
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 15  

 851   2              }
 852   1              
 853   1      //      dbprintf("back 2 menu level\n");
 854   1              gc_Task_Next=C_Task_Menu;
 855   1              gw_init_needed |= SET_BIT8;
 856   1              gc_PhaseInx=0;
 857   1      }
 858          
 859          
 860          U8 jpeg_marker_parser(U32 *tpdw_File_Ptr, U8 tc_marker_Hbyte, U8 tc_marker_Lbyte)
 861          {
 862   1              bit tb_soi_found = 0;
 863   1              U8 tc_sector_cnt = 0;
 864   1              U16 tw_Buf_idx;
 865   1      
 866   1              do{
 867   2                      tw_Buf_idx = *tpdw_File_Ptr & 0x1FF;
 868   2                      if ((!tw_Buf_idx) && (*tpdw_File_Ptr>0))
 869   2                      {
 870   3                              DOS_Read_File(C_OtherFHandle);
 871   3                              tc_sector_cnt ++;
 872   3                      }
 873   2                      
 874   2                      if(gc_PlayRecordDataBuf[tw_Buf_idx++] == tc_marker_Hbyte)
 875   2                      {
 876   3                              bit tb_next_sector = 0;
 877   3                              //marker identifier found
 878   3      
 879   3                              if(tw_Buf_idx == 512)
 880   3                              {
 881   4                                      tw_Buf_idx = 0;
 882   4                                      DOS_Read_File(C_OtherFHandle);
 883   4                                      tb_next_sector = 1;
 884   4                                      tc_sector_cnt ++;
 885   4                              }
 886   3      
 887   3                              if(gc_PlayRecordDataBuf[tw_Buf_idx] == tc_marker_Lbyte)
 888   3                                      tb_soi_found = 1;
 889   3      
 890   3                              if(!tb_next_sector)
 891   3                              {               
 892   4                                      tw_Buf_idx++;
 893   4                                      (*tpdw_File_Ptr)++;
 894   4                              }                       
 895   3                      }
 896   2                      (*tpdw_File_Ptr)++;
 897   2      
 898   2                      if(tc_sector_cnt >=8)
 899   2                              return FAIL;
 900   2      
 901   2              }while(!tb_soi_found);          
 902   1      
 903   1              return SUCCESS;
 904   1      
 905   1      }
 906          
 907          
 908          void JpegMenu_Process()
 909          {
 910   1              bit     tc_Confirm=0;
 911   1              gc_refresh_type = REFRESH_ALL;
 912   1              if(gc_PhaseInx!=2)
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 16  

 913   1              {
 914   2              switch(gc_PhaseInx)
 915   2              {
 916   3                  case C_JpegMenu:
 917   3                                      gc_refresh_type = REFRESH_ALL;  
 918   3                                      tc_Confirm=1;
 919   3                  break;
 920   3      
 921   3                  case C_JpegNext:
 922   3                                      gc_refresh_type = REFRESH_NEXT;
 923   3                                      if(gc_LCMDispIndex==2)
 924   3                                      {
 925   4                                              gc_LCMDispIndex=0;
 926   4                                      }
 927   3                                      else
 928   3                                      {
 929   4                                              gc_LCMDispIndex++;
 930   4                                      }
 931   3                  break;
 932   3      
 933   3                  case C_JpegPrev:
 934   3                                      gc_refresh_type = REFRESH_PREV;
 935   3                                      if(gc_LCMDispIndex==0)
 936   3                                      {
 937   4                                              gc_LCMDispIndex=2;
 938   4                                      }
 939   3                                      else
 940   3                                      {
 941   4                                              gc_LCMDispIndex--;
 942   4                                      }
 943   3                  break;      
 944   3              }
 945   2      
 946   2                      if(tc_Confirm==1) //confirm selected item
 947   2                      {
 948   3                              if(gc_LCMDispIndex==0)  //jpeg Dir
 949   3                              {
 950   4                                      play_stop();
 951   4                                      gc_TaskMode_BkUp=C_Task_Jpeg;
 952   4                                      gc_Task_Next=C_Task_Dir;
 953   4                                      return;
 954   4                              }
 955   3                              else if(gc_LCMDispIndex==1)  //Select Jpeg Mode
 956   3                              {
 957   4                                      gc_DispPlayMenuAct=1;
 958   4                                      gc_TuneVolFreqStatus=32;
 959   4                                      return;
 960   4                              }
 961   3                              else if(gc_LCMDispIndex==2)  //Select Display velocity
 962   3                              {
 963   4                                      gc_DispPlayMenuAct=2;
 964   4                                      gc_TuneVolFreqStatus=33;
 965   4                                      return;
 966   4                              }
 967   3                      }
 968   2              }       
 969   1      }
 970          
 971          
 972          void JpegDispMode_Process()
 973          {
 974   1              bit     tc_Confirm=0;
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 17  

 975   1      
 976   1              if(gc_PhaseInx!=2)
 977   1              {
 978   2              switch(gc_PhaseInx)
 979   2              {
 980   3                  case C_JpegMenu:
 981   3                                      tc_Confirm=1;
 982   3                  break;
 983   3      
 984   3                  case C_JpegNext:
 985   3                  case C_JpegPrev:
 986   3                                      gc_refresh_type=REFRESH_NEXT;
 987   3                                      gc_LCMDispIndex=(gc_LCMDispIndex+1)&0x01;
 988   3                  break;      
 989   3              }
 990   2      
 991   2                      if(tc_Confirm==1) //confirm selected item
 992   2                      {
 993   3                              if(gc_LCMDispIndex==0)  //User
 994   3                              {
 995   4                                      gc_AutoJpeg_Flag=0;
 996   4                                      gc_TuneVolFreqStatus=0;
 997   4                                      gc_DispPlayMenuAct=0;
 998   4                              }
 999   3                              else if(gc_LCMDispIndex==1)  //Auto
1000   3                              {
1001   4                                      gc_AutoJpeg_Flag=1;
1002   4                                      gc_TuneVolFreqStatus=0;
1003   4                                      gc_DispPlayMenuAct=0;
1004   4                              }
1005   3                      }
1006   2              }               
1007   1      }
1008          
1009          
1010          void JpegDispVelocity_Process()
1011          {
1012   1              if(gc_PhaseInx!=2)
1013   1              {
1014   2              switch(gc_PhaseInx)
1015   2              {
1016   3                  case C_JpegMenu:
1017   3                                      gc_TuneVolFreqStatus=0;
1018   3                                      gc_DispPlayMenuAct=0;
1019   3                  break;
1020   3      
1021   3                  case C_JpegNext:
1022   3                                      if(gc_JpegVelocity<10)
1023   3                                      {
1024   4                                              gc_JpegVelocity++;
1025   4                                      }
1026   3                  break;
1027   3      
1028   3                  case C_JpegPrev:
1029   3                                      if(gc_JpegVelocity>0)
1030   3                                      {
1031   4                                              gc_JpegVelocity--;
1032   4                                      }
1033   3                  break;      
1034   3              }
1035   2              }       
1036   1      }
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 18  

1037          
1038          
1039          void JpegMenu_Disp()
1040          {
1041   1              if(gc_TuneVolFreqStatus==31)
1042   1              {
1043   2                      gc_JPGSetting=0;
1044   2                      IR_Service_Process_Menu_2();
1045   2      
1046   2                      if(gc_DispWallpaper!=32)
1047   2                      {
1048   3                              //TFT_PhotoMenu();//--sunzhk modif 100703
1049   3                              Menu_Disp_Item_Other(gc_TuneVolFreqStatus,gc_LCMDispIndex,gc_refresh_type);
1050   3                              gc_DispWallpaper=32;
1051   3                              gc_LCMDispIndex=0;
1052   3                              gc_LCMDispIndexBak=0xFF;
1053   3                              gc_PhaseInx=0;
1054   3                      }
1055   2      
1056   2                      JpegMenu_Process();
1057   2      
1058   2                      if(gc_LCMDispIndexBak!=gc_LCMDispIndex)
1059   2                      {
1060   3                              gc_LCMDispIndexBak=gc_LCMDispIndex;
1061   3                              //TFT_PhotoMenu();//--sunzhk modif 100703
1062   3                              Menu_Disp_Item_Other(gc_TuneVolFreqStatus,gc_LCMDispIndex,gc_refresh_type);;
1063   3                      }
1064   2              }
1065   1              else if(gc_TuneVolFreqStatus==32)
1066   1              {
1067   2                      IR_Service_Process_Menu_2();
1068   2                      if(gc_DispWallpaper!=33)
1069   2                      {
1070   3                              gc_DispWallpaper=33;
1071   3                              gc_LCMDispIndex=0;
1072   3                              gc_LCMDispIndexBak=0xFF;
1073   3                              gc_PhaseInx=0;
1074   3                      }
1075   2      
1076   2                      gc_JPGSetting=1;
1077   2                      JpegDispMode_Process();
1078   2      
1079   2                      if(gc_LCMDispIndexBak!=gc_LCMDispIndex)
1080   2                      {
1081   3                              gc_LCMDispIndexBak=gc_LCMDispIndex;
1082   3                              //TFT_PhotoMenu();//--sunzhk modif 100703
1083   3                              Menu_Disp_Item_Other(gc_TuneVolFreqStatus,gc_LCMDispIndex,gc_refresh_type);
1084   3                      }
1085   2              }
1086   1              else if(gc_TuneVolFreqStatus==33)
1087   1              {
1088   2                      IR_Service_Process_Menu_2();
1089   2                      if(gc_DispWallpaper!=34)
1090   2                      {
1091   3                              gc_JpegVelocityBak=0xFF;
1092   3                              gc_DispWallpaper=34;
1093   3                              gc_LCMDispIndex=0;
1094   3                              gc_PhaseInx=0;
1095   3                      }
1096   2      
1097   2                      JpegDispVelocity_Process();
1098   2      
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 19  

1099   2                      if(gc_JpegVelocityBak!=gc_JpegVelocity)
1100   2                      {
1101   3                              TFT_Velocity();
1102   3                              gc_JpegVelocityBak=gc_JpegVelocity;
1103   3                      }
1104   2              }
1105   1      
1106   1              if(gc_TuneVolFreqStatus==0)  //Tw play jpeg
1107   1              {
1108   2                      if(gc_AutoJpeg_Flag==1)
1109   2                      {
1110   3                              gw_AutoJpeg_Timer=(U16)gc_JpegVelocity*36;
1111   3                      }
1112   2                      gc_PhaseInx=C_JpegPause;        
1113   2              }
1114   1              else
1115   1              {
1116   2                      gc_PhaseInx=C_JpegIdle;
1117   2              }
1118   1      }
1119          
1120          
1121          void Play_SDFlash_DosInit_Jpeg()
1122          {
1123   1              gb_FindFlag = 0;
1124   1              gc_PhaseInx=0;
1125   1              gw_init_needed=0xFFFF;
1126   1              if (DOS_Initialize())
1127   1              {
1128   2              }
1129   1              else
1130   1              {
1131   2                      gc_ShowTimer=0;  //20090331
1132   2                      gc_DispWallpaper=1;
1133   2                      gc_TuneVolFreqStatus=0;
1134   2                      gb_FindFlag = 0;
1135   2                      gc_PhaseInx=0;
1136   2                      gw_init_needed=0xFFFF;
1137   2      
1138   2                      gc_TaskMode_BkUp=C_Task_Play;//(JC)I0304 for back to rite TASK from Dir-list
1139   2                      gc_Task_Next=C_Task_Play;
1140   2                      gc_MenuItemCount=0;
1141   2                      gs_System_State.c_FileHandle=0;
1142   2      //              DOS_DIRtable();  //20090216 chiayen add       
1143   2                      gs_File_FCB[0].dw_FDB_StartCluster = gdw_DOS_RootDirClus;           
1144   2                      DOS_Search_File(C_File_All|C_Cnt_FileNo, C_MusicFileType, C_CmpExtName|C_Next);//(JC)count music file no
             -. in root
1145   2                      gc_PhaseInx=0;
1146   2                      gb_TFT_refresh=1;
1147   2                      gc_DispWallpaper=0xFF;
1148   2              }
1149   1      }
1150          
1151          
1152          void Play_SourceDetect_Process_Jpeg()
1153          {
1154   1              gb_SD_Exist_pre=gb_SD_Exist;
1155   1              if(!SD_Detect)  //SD exist
1156   1          {
1157   2              gb_SD_Exist=1;
1158   2          }
1159   1              else
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 20  

1160   1              {
1161   2                      gb_SD_Exist=0;
1162   2                      gb_SDNoFileflag=0;
1163   2              }
1164   1      #if 1//(USB_HOST==1)
1165   1              gb_Host_Exist_pre=gb_Host_Exist;
1166   1              if(!Host_DetectDevice())
1167   1              {
1168   2                      gb_Host_Exist=1;        //host_exist            
1169   2              }
1170   1              else
1171   1              {
1172   2                      gb_Host_Exist=0;
1173   2                      gc_HostNoFileflag=0;
1174   2              }
1175   1      #endif
1176   1      
1177   1              if((gc_CurrentCard==0) && ((gb_Host_Exist_pre!=gb_Host_Exist)||(gb_SD_Exist_pre!=gb_SD_Exist)))
1178   1              {
1179   2                      if((gb_Host_Exist_pre!=gb_Host_Exist) && (gb_Host_Exist==1))
1180   2                      {
1181   3                              gc_CurrentCard=5;
1182   3                      }
1183   2                      else if((gb_SD_Exist_pre!=gb_SD_Exist) && (gb_SD_Exist==1))
1184   2                      {
1185   3                              gc_CurrentCard=2;       
1186   3                      }
1187   2                      else
1188   2                      {
1189   3                              gc_CurrentCard=0;       
1190   3                      }
1191   2              }
1192   1              else
1193   1              {
1194   2                      if(gc_CurrentCard==2)
1195   2                      {
1196   3                              if(gc_Dosinitfail==0)  //20090803 chiayen add
1197   3                              {
1198   4                                      if((gb_Host_Exist_pre!=gb_Host_Exist) && (gb_Host_Exist==1))
1199   4                                      {
1200   5                                              gc_CurrentCard=5;
1201   5                                      }
1202   4                                      else if(((gb_SD_Exist==0) || (gb_SDNoFileflag==1)) && (gb_Host_Exist==1))
1203   4                                      {
1204   5                                              gc_CurrentCard=5;
1205   5                                              if(gc_HostNoFileflag==1)
1206   5                                              {
1207   6                                                      gc_CurrentCard=0;       
1208   6                                              }
1209   5                                      }
1210   4                                      else if((gb_SD_Exist==0) || (gb_SDNoFileflag==1))
1211   4                                      {
1212   5                                              gc_CurrentCard=0;       
1213   5                                      }
1214   4                              }
1215   3                              else //20090803 chiayen add for SD Dos initial fail
1216   3                              {
1217   4                                      if((gb_Host_Exist==1) && (gc_HostNoFileflag==0))
1218   4                                      {
1219   5                                              gc_CurrentCard=5;
1220   5                                      }
1221   4                                      else
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 21  

1222   4                                      {
1223   5                                              gc_CurrentCard=0;
1224   5                                      }
1225   4                                      gc_Dosinitfail=0;                               
1226   4                              }
1227   3                      }
1228   2                      if(gc_CurrentCard==5)
1229   2                      {
1230   3                              if(gc_Dosinitfail==0)  //20090803 chiayen add
1231   3                              {
1232   4                                      if((gb_SD_Exist_pre!=gb_SD_Exist) && (gb_SD_Exist==1))
1233   4                                      {
1234   5                                              gc_CurrentCard=2;
1235   5                                      }
1236   4                                      else if(((gb_Host_Exist==0) || (gc_HostNoFileflag==1)) && (gb_SD_Exist==1))
1237   4                                      {
1238   5                                              gc_CurrentCard=2;
1239   5                                              if(gb_SDNoFileflag==1)
1240   5                                              {
1241   6                                                      gc_CurrentCard=0;       
1242   6                                              }
1243   5                                      }
1244   4                                      else if((gb_Host_Exist==0) || (gc_HostNoFileflag==1))
1245   4                                      {
1246   5                                              gc_CurrentCard=0;       
1247   5                                      }
1248   4                              }
1249   3                              else //host dos initial fail  //20090803 chiayen add
1250   3                              {
1251   4                                      if((gb_SD_Exist==1) && (gb_SDNoFileflag==0))
1252   4                                      {
1253   5                                              gc_CurrentCard=2;
1254   5                                      }
1255   4                                      else
1256   4                                      {
1257   5                                              gc_CurrentCard=0;
1258   5                                      }
1259   4                                      gc_Dosinitfail=0;
1260   4                              }
1261   3                      }
1262   2              }
1263   1      
1264   1          if(gc_CurrentCard_backup!=gc_CurrentCard)
1265   1          {
1266   2                      U8 tc_CurrentCard;
1267   2                      tc_CurrentCard=gc_CurrentCard;
1268   2                      gc_CurrentCard=gc_CurrentCard_backup;
1269   2                      jpeg_stop();
1270   2                      gc_MenuItemCount=0;
1271   2                      gc_CurrentCard=tc_CurrentCard;
1272   2                      gc_CurrentCard_backup=gc_CurrentCard;
1273   2      
1274   2                      set_clock_mode(CLOCK_MODE_MP3); //20090803 chiayen add for media change
1275   2      
1276   2                      if(gc_CurrentCard==2)
1277   2              {           
1278   3                  if(SD_Identification_Flow())
1279   3                  {
1280   4                      gc_CardExist |=0x02;
1281   4                  }
1282   3                  else if((gb_Host_Exist==1) && (gc_HostNoFileflag==0)) //20090730 chiayen modify
1283   3                  {
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 22  

1284   4                                      DEVICE_REG[0x00]= 0x01;  //20090730 chiayen add
1285   4                                      if(!Host_Initial())
1286   4                                      {
1287   5                                              gc_CurrentCard = CURRENT_MEDIA_HOST;
1288   5                                              gb_FindFlag = 0;
1289   5                      }
1290   4                          else
1291   4                          {
1292   5                                              gc_CurrentCard=0;
1293   5                                              gc_CardExist &=0xFD;
1294   5                                              gb_FindFlag = 0;
1295   5                                              InitFlash();                                
1296   5                          }
1297   4                      }
1298   3                              else 
1299   3                      {
1300   4                                      DEVICE_REG[0x00]= 0x01;  //20090730 chiayen add
1301   4                                      gc_CurrentCard=0;
1302   4                                      gc_CardExist &=0xFD;
1303   4                                      gb_FindFlag = 0;
1304   4                                      InitFlash();
1305   4                              }
1306   3                              Play_SDFlash_DosInit_Jpeg();
1307   3              }
1308   2                      #if 1//(USB_HOST==1)
1309   2                      else if(gc_CurrentCard==CURRENT_MEDIA_HOST)
1310   2                      {
1311   3                              DEVICE_REG[0x00]= 0x01;  //20090803 chiayen add                 
1312   3                              if(!Host_Initial())
1313   3                              {
1314   4                                      gc_CurrentCard = CURRENT_MEDIA_HOST;
1315   4                                      gb_FindFlag = 0;
1316   4                              }
1317   3                              else if((gb_SD_Exist==1) && (gb_SDNoFileflag==0)) //20090730 chiayen add
1318   3                              {
1319   4                          if(SD_Identification_Flow())
1320   4                          { 
1321   5                              gc_CardExist |=0x02;
1322   5                                              gc_CurrentCard=2;      
1323   5                                      }
1324   4                                      else
1325   4                                      {
1326   5                                              DEVICE_REG[0x00]= 0x01;
1327   5                                              gc_CurrentCard=0;
1328   5                                              gc_CardExist &=0xFD;
1329   5                                              gb_FindFlag = 0;
1330   5                                              InitFlash();
1331   5                                      }
1332   4                              }
1333   3                              else 
1334   3                      {
1335   4                                      DEVICE_REG[0x00]= 0x01;
1336   4                                      gc_CurrentCard=0;
1337   4                                      gb_FindFlag = 0;
1338   4                                      InitFlash();
1339   4                              }
1340   3                              Play_SDFlash_DosInit_Jpeg();
1341   3                      }
1342   2                      else if(gc_CurrentCard==0)
1343   2              {
1344   3                              DEVICE_REG[0x00]= 0x01;
1345   3                              gc_CardExist &=0xFD;
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 23  

1346   3                              InitFlash();
1347   3                              Play_SDFlash_DosInit_Jpeg();
1348   3                      }
1349   2                      #endif
1350   2      
1351   2                      #if 0
                              if(gc_CurrentCard==2)
                      {           
                          if(SD_Identification_Flow())
                          {
                              gc_CardExist |=0x02;
                                              Play_SDFlash_DosInit_Jpeg();      
                          }
                          else
                          {
                                              XBYTE[0xB400]= 0x01;
                                              gc_CurrentCard=0;
                                              gc_CardExist &=0xFD;
                                              gb_FindFlag = 0;
                                              InitFlash();
                                              Play_SDFlash_DosInit_Jpeg();                                        
                          }
                      }
                      else if(gc_CurrentCard==0)
                      {
                                      XBYTE[0xB400]= 0x01;
                                      gc_CardExist &=0xFD;
                                      InitFlash();
                                      Play_SDFlash_DosInit_Jpeg();
                      }
                              else if(gc_CurrentCard==CURRENT_MEDIA_HOST)
                              {
                                      set_clock_mode(CLOCK_MODE_MP3);
                                      if(!Host_Initial())
                                      {
                                              gc_CurrentCard = CURRENT_MEDIA_HOST;
                                              gb_FindFlag = 0;
                                      }
                                      else
                                      {
                                              XBYTE[0xB400]= 0x01;
                                              gc_CurrentCard=0;
                                              gb_FindFlag = 0;
                                              InitFlash();
                                              gc_CurrentCard=0;
                                      }
                                      Play_SDFlash_DosInit_Jpeg();
                              }
                              #endif
1395   2          }
1396   1      }
1397          
1398          
1399          void Jpeg_Task()
1400          {
1401   1              gc_TuneVolFreqStatus=0;  //20090331
1402   1              gc_DispPlayMenuAct=0;
1403   1              gw_AutoJpeg_Timer=(U16)gc_JpegVelocity*36+18;
1404   1               
1405   1              while (1)
1406   1              {
1407   2                      switch(gc_PhaseInx)
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 24  

1408   2                      {
1409   3                              case C_JpegIdle:
1410   3                                      set_clock_mode(CLOCK_MODE_MP3);         // added by maxliao
1411   3                                      jpeg_idle();
1412   3                              break;
1413   3      
1414   3                              case C_JpegInit:
1415   3                              //      #ifdef CS1783
1416   3                                      set_clock_mode(CLOCK_MODE_MP3L);        // added by maxliao
1417   3                              //      #else
1418   3                              //      set_clock_mode(CLOCK_MODE_MJPEG);       // added by maxliao
1419   3                              //      #endif
1420   3                                      jpeg_init();
1421   3                              break;                  
1422   3      
1423   3                              case C_JpegProc:
1424   3                                      jpeg_proc();
1425   3                              break;
1426   3                              
1427   3                              case C_JpegPause:
1428   3                                      if(gc_TuneVolFreqStatus<30)
1429   3                                      {
1430   4                                              jpeg_playpause();
1431   4                                      }
1432   3                              break;
1433   3      
1434   3                              case C_JpegStop:
1435   3                                      jpeg_stop();
1436   3                              break;
1437   3      
1438   3                              case C_JpegEndfile:
1439   3                                      jpeg_endfile(); 
1440   3                              break;
1441   3      
1442   3                              case C_JpegNext:
1443   3                                      if(gc_TuneVolFreqStatus<30)
1444   3                                      {
1445   4                                              jpeg_next();
1446   4                                      }                               
1447   3                              break;
1448   3      
1449   3                              case C_JpegPrev:
1450   3                                      if(gc_TuneVolFreqStatus<30)
1451   3                                      {
1452   4                                              jpeg_prev();
1453   4                                      }
1454   3                              break;
1455   3                              
1456   3                              case C_JpegUpLevel:
1457   3                                      jpeg_back2uplevel();
1458   3                              break;
1459   3      
1460   3                              case C_JpegMenu:  //20090331
1461   3                                      if(gc_DispPlayMenuAct==0)
1462   3                                      {
1463   4                                              gc_TuneVolFreqStatus=31;
1464   4                                      }                                                                                       
1465   3                              break;
1466   3                                      
1467   3                  case C_PowerOff:
1468   3                                      if(gs_System_State.c_Phase!=TASK_PHASE_STOP)
1469   3                                      {
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 25  

1470   4                                              jpeg_stop();    
1471   4                                      }
1472   3                                      gc_Task_Next=C_Task_PowerOff;                                           
1473   3                  break;
1474   3                                      
1475   3                              case C_MainMenu:
1476   3                                      jpeg_stop();
1477   3                                      gc_Task_Next=C_Task_Menu;
1478   3                              break;
1479   3                      }       
1480   2                      
1481   2                      if(gc_TuneVolFreqStatus>30)
1482   2                      {
1483   3                              if((gc_PhaseInx==C_JpegProc)&&(gc_Play_FileType<2))                     //sunzhk add 090612 
1484   3                              {
1485   4                                      U8 tc_Ret;
1486   4                                      if (gs_System_State.c_Phase != TASK_PHASE_STOP)
1487   4                                      {                       
1488   5                                              //jpeg stop
1489   5                                              if (gc_Play_FileType == 2)
1490   5                                              {
1491   6                                                      tc_Ret = GIF_StopCmd(gs_System_State.c_FileHandle);
1492   6                                              }
1493   5                                              else
1494   5                                              {
1495   6                                                      tc_Ret = Image_StopCmd(gs_System_State.c_FileHandle);
1496   6                                              }
1497   5                              
1498   5                                              if (tc_Ret != DSP_SUCCESS)
1499   5                                              {
1500   6      //                                              dbprintf("JPEG stop error !!\n");
1501   6                                                      XBYTE[0xB001]|=0x02;
1502   6                                                      XBYTE[0xB001]&=~0x02;
1503   6                                              }
1504   5                                              gs_System_State.c_Phase = TASK_PHASE_STOP;
1505   5                                      }
1506   4                              }
1507   3                              JpegMenu_Disp();
1508   3                      }
1509   2                      else
1510   2                      {
1511   3                              if((gc_PhaseInx==C_JpegIdle)&&(gc_Play_FileType<2))
1512   3                              {
1513   4                                      if(gc_AutoJpeg_Flag==1 && gw_AutoJpeg_Timer==0)
1514   4                                  {
1515   5                                              gw_AutoJpeg_Timer=(U16)gc_JpegVelocity*36;
1516   5                                              gc_PhaseInx=C_JpegNext; 
1517   5                                      }
1518   4                              }
1519   3      
1520   3                              if((gc_Play_FileType==2))
1521   3                              {
1522   4                                      if(gc_AutoJpeg_Flag==1 && gw_AutoJpeg_Timer==0)
1523   4                                  {
1524   5                                              gw_AutoJpeg_Timer=(U16)gc_JpegVelocity*36;
1525   5                                              gc_PhaseInx=C_JpegNext; 
1526   5                                      }                               
1527   4                              }
1528   3                      }       
1529   2                              
1530   2                      Polling_TaskEvents();
1531   2              IR_Service_Process();
C51 COMPILER V7.10   JPEG_PROCESS                                                          02/28/2011 10:31:03 PAGE 26  

1532   2                      Play_SourceDetect_Process_Jpeg();
1533   2                      if (gc_Task_Current != gc_Task_Next)
1534   2                      {
1535   3                              gc_Task_Current = gc_Task_Next;
1536   3                              break;  
1537   3                      }
1538   2              }
1539   1      }
1540          
1541          
1542          void IR_Service_Process_Menu_2(void)
1543          {
1544   1          if(gc_IRCmdStatus==1)
1545   1          {
1546   2              ir_service_menu();
1547   2          }
1548   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4238    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2      54
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       4
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
