C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE REMOTE
OBJECT MODULE PLACED IN .\obj\remote.obj
COMPILER INVOKED BY: F:\Keil C 7.10\chengxu\C51\BIN\C51.EXE IR\remote.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\
                    -libsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\remote.lst) OBJECT(.\obj\remote.obj)

line level    source

   1          #include "..\Header\SPDA2K.h"
   2          #include "..\header\PROTOTYP.h"
   3          #include "..\header\dos\fs_struct.h"
   4          #include "..\IR\remote.h"
   5          #include "..\IR\FM.h"
   6          #include "..\header\Memalloc.h"
   7          #include "..\header\variables.h"
   8          #include "..\LCM\TFT_display.h"         // TFT
   9          
  10          extern xdata System_Struct gs_System_State;
  11          extern DSP_GLOBAL gs_DSP_GLOBAL_RAM;
  12          
  13          extern void Music_EQ_Cmd(U8 tc_Type);
  14          extern void Music_SetVolumeCmd(void);
  15          extern void LCM_ShowSongNumber_1(void);
  16          extern U8 DOS_Search_DIR(U8 tc_Mode);  //20090121 chiayen add
  17          extern U8 LCD_disp_HZK_string(U8 Page,U8 *DataBuf,U8 tc_ISNOrUnicode, U8 nByte,U8 ColumnOffset,bit reverse
             -); //20090121 chiayen add
  18          
  19          extern U8 LCD_Disp_FileName(U8 *tpc_DataBuf, U8 tc_ANSI, U8 tc_nByte, U8 tc_scroll_flag);
  20          extern UBYTE DOS_GetDIRName(UBYTE tc_FileHandle, UBYTE tb_UicodeToISN, UBYTE * tpc_LongName);
  21          
  22          extern void UI_DispGetDirName(U8 tc_DIRtableIndex);
  23          
  24          void ir_init(void);
  25          void ir_service(void);
  26          void ir_commandservice(void);
  27          void SaveNumber(U8 number);
  28          void ClearIRBuffer(void);
  29          void Frequency_Disp(void);
  30          void Channel_Set_Init(void);
  31          void Change_EQ(void);
  32          void VOL_UP(void);
  33          void VOL_DOWN(void);
  34          void CHG_DN(void);
  35          void CHG_UP(void);
  36          void PickSong_Process(void);
  37          void NextorPre_Song(bit tb_state);
  38          void MediaChange(void);  //20090107 chiayen add
  39          void LCD_Disp_DirName(void); //20090121 chiayen add
  40          void ChannelSet_Process(void);//20090409 chiayen add
  41          
  42          extern U8       DOS_Search_DIR_Prev_test(U8 tc_Mode);  //20090216 chiayen add
  43          extern U8       DOS_Search_DIR_Next_test(U8 tc_Mode);
  44          
  45          extern U8 GetCurrentDirInfo();
  46          
  47          extern  data    U8      gc_ShowIRNumMain;
  48          extern  data    bit     gb_TFT_refresh;
  49          
  50          xdata U8 gb_NumCHSet=0;
  51          xdata U8 gb_NumSet=0;
  52          
  53          void ir_init(void)
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 2   

  54          {
  55   1              // set time out
  56   1              IR_REG[0x00] = LO_BYTE(TIME_OUT_MIN);
  57   1              IR_REG[0x01] = HI_BYTE(TIME_OUT_MIN);
  58   1              // start 1 max
  59   1              IR_REG[0x02] = LO_BYTE(START1_MAX);
  60   1              IR_REG[0x03] = HI_BYTE(START1_MAX);
  61   1              // start 1 min
  62   1              IR_REG[0x04] = LO_BYTE(START1_MIN);
  63   1              IR_REG[0x05] = HI_BYTE(START1_MIN);
  64   1              // start 0 max
  65   1              IR_REG[0x06] = LO_BYTE(START0_MAX);
  66   1              IR_REG[0x07] = HI_BYTE(START0_MAX);
  67   1              // start 0 min
  68   1              IR_REG[0x08] = LO_BYTE(START0_MIN);
  69   1              IR_REG[0x09] = HI_BYTE(START0_MIN);
  70   1      #if (IR_MODULATION==IR_MOD_PPM) || (IR_MODULATION==IR_MOD_PWM)
  71   1              // logic 1 max
  72   1              IR_REG[0x0a] = LO_BYTE(LOGIC1_MAX);
  73   1              IR_REG[0x0b] = HI_BYTE(LOGIC1_MAX);
  74   1              // logic 1 min
  75   1              IR_REG[0x0c] = LO_BYTE(LOGIC1_MIN);
  76   1              IR_REG[0x0d] = HI_BYTE(LOGIC1_MIN);
  77   1      #else
                      // bit time
                      IR_REG[0x0a] = LO_BYTE(BIT_TIME);
                      IR_REG[0x0b] = HI_BYTE(BIT_TIME);
                      // sample point
                      IR_REG[0x0c] = LO_BYTE(SAMPLE_POINT);
                      IR_REG[0x0d] = HI_BYTE(SAMPLE_POINT);
              #endif
  85   1              // logic 0 max
  86   1              IR_REG[0x0e] = LO_BYTE(LOGIC0_MAX);
  87   1              IR_REG[0x0f] = HI_BYTE(LOGIC0_MAX);
  88   1              // logic 0 min
  89   1              IR_REG[0x10] = LO_BYTE(LOGIC0_MIN);
  90   1              IR_REG[0x11] = HI_BYTE(LOGIC0_MIN);
  91   1              // set sampling period = 1 usec
  92   1              IR_REG[0x12] = LO_BYTE(T_SAMPLE);
  93   1              IR_REG[0x13] = HI_BYTE(T_SAMPLE);               
  94   1              // set polarity
  95   1      #if IR_MODULATION == IR_MOD_PPM
  96   1              IR_REG[0x17] = 0x01;
  97   1      #elif IR_MODULATION == IR_MOD_PWM
                      IR_REG[0x17] = 0x03;
              #elif IR_MODULATION == IR_MOD_BIPHASE
                      IR_REG[0x17] = 0x07;
              #elif IR_MODULATION == IR_MOD_BINARY
                      IR_REG[0x17] = 0x05;
              #else
                      while(1);
              #endif
 106   1      
 107   1              IR_REG[0x19] = 0x07; // clear all events
 108   1              IR_REG[0x18] = 0x07; // enable all IR interrupts
 109   1              IR_REG[0x17] |= 0x80; // IR reveiver HW enabled
 110   1              IR_REG[0x19] = 0x07; // clear all events
 111   1              EX0 = 1; EA = 1;
 112   1      }
 113          
 114          
 115          void ir_service(void)
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 3   

 116          {
 117   1              U16 tw_temp;    
 118   1      
 119   1              if(gc_IRCmdStatus!=0)
 120   1              {
 121   2                      tw_temp=(IR_REG[0x1b]<<8)+IR_REG[0x1a];
 122   2      
 123   2                       switch(tw_temp)
 124   2              {
 125   3                 case IR_6_Key:
 126   3                      gc_irkey = 1;
 127   3                      break;
 128   3                 case IR_7_Key:
 129   3                      gc_irkey = 2;
 130   3                      break;
 131   3                 case IR_18_Key:
 132   3                      gc_irkey = 3;
 133   3                      break;
 134   3                 case IR_20_Key:
 135   3                      gc_irkey = 4;
 136   3                      break;
 137   3                 case IR_21_Key:
 138   3                      gc_irkey = 5;
 139   3                      break;
 140   3                 case IR_21_1_Key:
 141   3                      gc_irkey = 7;
 142   3                      break;
 143   3                 default:
 144   3                      gc_irkey = 0;
 145   3                      break;
 146   3              }
 147   2                      if(gc_irkey!=0)
 148   2                      {
 149   3                              if((IR_REG[0x1c]+IR_REG[0x1d])==0xFF)
 150   3                              {
 151   4                                      if(gc_IRCmdStatus==1)
 152   4                                      {
 153   5                                              ir_commandservice();
 154   5                                              gc_IRCmdStatus=0;
 155   5                                      }
 156   4                                      if(gc_IRCmdStatus==2)
 157   4                                      {                                       
 158   5                                                      ir_commandservice();
 159   5                                                      gc_IRCmdStatus=0;
 160   5                                      }
 161   4                              }                                       
 162   3                      }
 163   2                      else
 164   2                      {
 165   3                              gc_IRCmdStatus=0;
 166   3                      }
 167   2                      gc_IRCmdStatus=0;
 168   2              }
 169   1              gc_irkey=0;
 170   1      }
 171          
 172          
 173          void ir_commandservice(void)
 174          {
 175   1              U8      tc_SearchDirTimeout;
 176   1                                                                        
 177   1      
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 4   

 178   1      ///======================IR=======IR========IR===========================
 179   1      ///======================IR=======IR========IR===========================
 180   1      ///======================IR=======IR========IR===========================
 181   1      ///======================IR=======IR========IR===========================
 182   1              if(gc_irkey==5) // 21-1key
 183   1              {
 184   2      //              dbprintf("IR Key=%bx\n",IR_REG[0x1c]);
 185   2      
 186   2                  switch(IR_REG[0x1c])
 187   2                  {
 188   3                              case 0x00:      //ON/OFF 
 189   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 190   3                                      {
 191   4                                              if(gs_System_State.c_Phase!=TASK_PHASE_STOP)
 192   4                                              {
 193   5                                                      if(gc_Task_Current == C_Task_Play)
 194   5                                                      {
 195   6                                                              play_stop();
 196   6                                                      }
 197   5                                                      else if(gc_Task_Current == C_Task_Jpeg)
 198   5                                                      {
 199   6                                                              jpeg_stop();
 200   6                                                      }
 201   5                                                      else if(gc_Task_Current == C_Task_Mjpeg)
 202   5                                                      {
 203   6                                                              mjpeg_stop();
 204   6                                                      }
 205   5                                              }
 206   4                              gc_Task_Next=C_Task_PowerOff;
 207   4                                              gc_PhaseInx=0xff; 
 208   4                                      }
 209   3      
 210   3                                      break;
 211   3                              case 0x1e:                                                              //just for suo lang.
 212   3                              case 0x01:      //Mode  //Menu   
 213   3                                      if(gc_Task_Current == C_Task_Play)
 214   3                      { 
 215   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <3))
 216   4                                              {       
 217   5                                      play_stop();
 218   5                                              gc_Task_Next=C_Task_Menu;
 219   5                                              }
 220   4                                      }
 221   3                                      else if(gc_Task_Current == C_Task_Jpeg)
 222   3                                      {
 223   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <31))
 224   4                                              {
 225   5                                                      jpeg_stop();
 226   5                                              gc_Task_Next=C_Task_Menu;
 227   5                                              }                               
 228   4                                              
 229   4                                      }
 230   3                                      else if(gc_Task_Current == C_Task_Mjpeg)
 231   3                                      {
 232   4                                              if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <21))
 233   4                                              {
 234   5                                                      mjpeg_stop();
 235   5                                              gc_Task_Next=C_Task_Menu;
 236   5                                              }
 237   4                                      }
 238   3                                      ClearIRBuffer();
 239   3                                      break;
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 5   

 240   3      
 241   3                              case 0x04:      //RPT   
 242   3       #if 0
                                              if(gc_IRCmdStatus==1)  //20090216 chiayen add
                                              {                                       
                                                      if(gw_FileTotalNumber[0]!=0)
                                                      {       
                                                              U32 dw_File_StartCluster_Backup=0;
                                                              U32 dw_FDB_StartCluster_Backup=0;
               
                                                              gb_DirPlay_Flag=1;
                                              
                                                              play_stop();
                                                              gw_DirOverallNumber = gw_DirTotalNumber;
                                                              GetCurrentDirInfo();
                                                              for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
                                                              {
                                                                      DOS_Search_DIR_Prev_test(0x23);
                      
                                                                      gb_FindFlag = 0;
              
                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
              
                                                                      dw_File_StartCluster_Backup=gs_DIR_FCB[0].dw_File_StartCluster;
                                                                      dw_FDB_StartCluster_Backup=gs_DIR_FCB[0].dw_FDB_StartCluster;
              
                                                                      gc_test=0;
                                                                      DOS_Search_File(0x10,0,0x10);
              
                                                                      if(gw_FileTotalNumber[0])
                                                                      {
                                                                              DOS_Search_File(C_File_OneDir|C_By_FDB, C_MusicFileType, C_CmpExtName|C_Next);
                                                                              gw_FileIndex[0]=1;
                                                                              break;
                                                                      }
                                                                      gs_DIR_FCB[0].dw_File_StartCluster=dw_File_StartCluster_Backup;
                                                                      gs_DIR_FCB[0].dw_FDB_StartCluster=dw_FDB_StartCluster_Backup;
                                                              }
              
                                                              gc_Dirchange_Timer=5;
                                                              gw_LogData_Timer=2;
                                                              gb_TFT_refresh=1;
                                                              if(gb_LrcFileName_Exist==1)
                                                              {
                                                                      gc_DispWallpaper=0;
                                                              }
                                                              gc_PhaseInx = 3;
                                                              gb_DirPlay_Flag=1;
                                                              gc_FolderPlay_Flag=1;
                                                      }
                                              }
                                               gc_folder_disp=1; //sunzhk add
              //                              dbprintf("curind=%x,totle=%x\n",gw_FileIndex[0],gw_FileTotalNumber[0]);
                                              //      DOS_Search_File(C_File_OneDir|C_Cnt_FileNo, C_MusicFileType, C_CmpExtName|C_Next);
              #else
 295   3                                      if(gc_IRCmdStatus==1)
 296   3                                      {
 297   4                                              if(gc_Task_Current == C_Task_Play)
 298   4                                              {
 299   5                                      gc_ShowTimer=72;
 300   5                                                      if(gc_DispPlayMenuAct==0)
 301   5                                                      {
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 6   

 302   6                                                              gc_TuneVolFreqStatus=3;
 303   6                                                      }
 304   5                                              }else if(gc_Task_Current == C_Task_Jpeg)
 305   4                                              {
 306   5                                                      if(gc_DispPlayMenuAct==0)
 307   5                                                      {
 308   6                                                              gc_TuneVolFreqStatus=31;
 309   6                                                      }                               
 310   5                                              }else if(gc_Task_Current == C_Task_Mjpeg)
 311   4                                              {
 312   5                                                      if(gs_System_State.c_Phase==TASK_PHASE_PLAYACT)
 313   5                                                      {
 314   6                                                              mjpeg_playpause();
 315   6                                                      }
 316   5                      
 317   5                                              gc_ShowTimer=72;
 318   5                                                      if((gc_DispPlayMenuAct==0) || (gc_DispPlayMenuAct==0x11))
 319   5                                                      {
 320   6                                                              gc_TuneVolFreqStatus=21;
 321   6                                                      }                                       
 322   5                                              }
 323   4                                      }
 324   3      #endif
 325   3                              
 326   3                                      break;
 327   3      
 328   3                      case 0x02:      // paly/pause
 329   3                                      if(gc_IRCmdStatus==1)
 330   3                                      {
 331   4                                              if(gb_NumSet==0)
 332   4                                              {
 333   5                                              if(gc_Task_Current == C_Task_Play)
 334   5                                              {
 335   6                                      gc_PhaseInx=3;
 336   6                                                      gc_ShowTimer=1;
 337   6                                                      
 338   6                                              }else if(gc_Task_Current == C_Task_Jpeg)
 339   5                                              {
 340   6                                                      gc_PhaseInx=3;
 341   6                                              }
 342   5                                              else if(gc_Task_Current == C_Task_Mjpeg)
 343   5                                              {
 344   6                                                      gc_PhaseInx=3;
 345   6                                              }
 346   5                                              ClearIRBuffer();
 347   5                                      }
 348   4                                              else if(gb_NumSet==1)
 349   4                              {
 350   5                                      gb_PickSongSet=1;
 351   5                                                      gw_IR_Timer=1;
 352   5                                                      gb_Frequency_Song=1;
 353   5                                    
 354   5                                      gb_NumSet=0;
 355   5                              }
 356   4                                      }
 357   3                                      break;
 358   3                      case 0x08:
 359   3      #if 0   // DIR <<
                                              if(gc_IRCmdStatus==1)  //20090216 chiayen add
                                              {
                                                      if(gw_FileTotalNumber[0]!=0)
                                                      {
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 7   

                                                              play_stop();
                                                              for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
                                                              {
                                                                      gs_DIR_FCB[0].dw_FDB_StartCluster = gs_File_FCB[0].dw_FDB_StartCluster;                                                 
                                                                      DOS_Search_DIR(0x23);
              
                                                                      gb_FindFlag = 0;                                                                                                        
                                                                      if(gc_test==0)
                                                                      {
                                                                              gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
                                                                      }
                                                                      else
                                                                      {
                                                                              gs_File_FCB[0].dw_FDB_StartCluster = gdw_DOS_RootDirClus;
                                                                              gc_test=0;
                                                                      }
                                                                      DOS_Search_File(0x10,0,0x10);
                                                                      if(gw_FileTotalNumber[0])
                                                                      {
                                                                              DOS_Search_File(C_File_All|C_By_Time, C_MusicFileType, C_CmpExtName|C_Next);
                                                                              gw_FileIndex[0]=1;
                                                                              break;
                                                                      }                                                                                                               
                                                              }
              
                                                              gc_Dirchange_Timer=5;
                                                              gb_TFT_refresh=1;
                                                              if(gb_LrcFileName_Exist==1)
                                                              {
                                                                      gc_DispWallpaper=0;
                                                              }
              
                                                              gb_FindFlag = 1;
                                                              gc_PhaseInx = 3;
                                                              gb_DirPlay_Flag=1;
                                                              gc_FolderPlay_Flag=1;  //20090216 chiayen add                           
                                                      }                               
                                              }
                                              gc_folder_disp=1; //sunzhk add
              #else
 404   3                                      if(gc_Task_Current == C_Task_Play)
 405   3                                      {
 406   4                                              if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 407   4                                              {
 408   5                                                      if((gc_IRCmdStatus==1)&&(gw_FileTotalNumber[0]!=0))
 409   5                                                      {
 410   6                                                              Change_EQ();
 411   6                                                      }
 412   5                                              }
 413   4                                      }
 414   3      
 415   3      #endif
 416   3              // EQ
 417   3                                      break;
 418   3                      case 0x09:      // volume --
 419   3                                      if((gc_Task_Current == C_Task_Play)||(gc_Task_Current == C_Task_Mjpeg))
 420   3                                      {
 421   4                                              VOL_DOWN();
 422   4                                      }
 423   3                                      break;
 424   3                      case 0x0a:      // volume ++
 425   3                                      if((gc_Task_Current == C_Task_Play)||(gc_Task_Current == C_Task_Mjpeg))
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 8   

 426   3                                      {
 427   4                                              VOL_UP();
 428   4                                      }
 429   3                                      break;
 430   3                      case 0x0d:      // prev 
 431   3                                      if(gc_TuneVolFreqStatus < 3)
 432   3                                      {
 433   4                                              if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 434   4                                              {
 435   5                                                      NextorPre_Song(1);
 436   5                                              }
 437   4                                      }
 438   3      
 439   3                                      break;
 440   3                      case 0x0e:      // next 
 441   3                                                      
 442   3                                      if(gc_TuneVolFreqStatus < 3)
 443   3                                      {
 444   4                                                      if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 445   4                                                      {
 446   5                                                              NextorPre_Song(0);
 447   5                                                      }
 448   4                                      }
 449   3                                      break;
 450   3                                      case 0x06:      // CH+
 451   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 452   3                                      {
 453   4                                              if(gb_NumSet==0)
 454   4                                              {
 455   5                                                      ClearIRBuffer();
 456   5                                                      CHG_UP();
 457   5                                              }
 458   4                                              else if(gb_NumSet==1)
 459   4                                              {
 460   5                                                      ChannelSet_Process();
 461   5                                                      gc_ShowIRNumMain=0;
 462   5                                                      gb_ChannelSet=1;
 463   5                                                      gb_NumSet=0;
 464   5                                                      ClearIRBuffer();
 465   5                                              }
 466   4                                      }
 467   3      
 468   3                                      break;
 469   3                              case 0x05:      // CH-
 470   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 471   3                                      {
 472   4                                              if(gb_NumSet==0)
 473   4                                              {
 474   5                                                      ClearIRBuffer();
 475   5                                                      CHG_DN();
 476   5                                              }
 477   4                                              else if(gb_NumSet==1)
 478   4                                              {
 479   5                                                      ChannelSet_Process();
 480   5                                                      gc_ShowIRNumMain=0;
 481   5                                                      gb_ChannelSet=1;
 482   5                                                      gb_NumSet=0;
 483   5                                                      ClearIRBuffer();
 484   5                                              }
 485   4                                      }
 486   3                                      
 487   3                                      break;
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 9   

 488   3                              case 0x1d:       //mute
 489   3                                      if(gc_IRCmdStatus==1) 
 490   3                                      {
 491   4                                              if(gc_VolumeMute==0)
 492   4                                              {
 493   5                                                      gc_Volumebackup=gs_DSP_GLOBAL_RAM.sw_Volume;
 494   5                                                      gs_DSP_GLOBAL_RAM.sw_Volume=0;
 495   5                                                      Music_SetVolumeCmd();
 496   5                                                      gc_VolumeMute=1;
 497   5                                                      gs_DSP_GLOBAL_RAM.sw_Volume=gc_Volumebackup;
 498   5                                              }
 499   4                                              else
 500   4                                              {
 501   5                                                      Music_SetVolumeCmd();
 502   5                                                      gc_VolumeMute=0;
 503   5                                              }
 504   4                                      }
 505   3                                      break;
 506   3                      /*      case 0x1e:        //u/sd
 507   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 508   3                                      {
 509   3                                              MediaChange();  //20090107 chiayen add
 510   3                                      }                               
 511   3                                      break;
 512   3                              case 0x0a:                              //CH_set
 513   3                                      if(gb_NumSet==1)
 514   3                                      {
 515   3                                              ChannelSet_Process();
 516   3                                              gb_ShowIRNumMain=0;
 517   3                                              gb_ChannelSet=1;
 518   3                                              gb_NumSet=0;
 519   3                                      }       
 520   3                                      else
 521   3                                      {
 522   3                                              ClearIRBuffer();
 523   3                                      }
 524   3                                      break;
 525   3      
 526   3                              case 0x08:                              //PkSong
 527   3                                      if(gb_NumSet==1)
 528   3                      {
 529   3                              gb_PickSongSet=1;
 530   3                                              gw_IR_Timer=1;
 531   3                                              gb_Frequency_Song=1;
 532   3                            
 533   3                              gb_NumSet=0;
 534   3                      }
 535   3                                      else
 536   3                                      {
 537   3                                              ClearIRBuffer();
 538   3                                      }
 539   3                                      
 540   3                                      break;*/
 541   3                              case 0x0c:      // 0
 542   3                                      SaveNumber(0);
 543   3                                      break;
 544   3                              case 0x10:      // 1
 545   3                                      SaveNumber(1);
 546   3                                      break;
 547   3                              case 0x11:      // 2
 548   3                                      SaveNumber(2);
 549   3                                      break;
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 10  

 550   3                              case 0x12:      // 3
 551   3                                      SaveNumber(3);
 552   3                                      break;
 553   3                              case 0x14:      // 4
 554   3                                      SaveNumber(4);
 555   3                                      break;
 556   3                              case 0x15:      // 5
 557   3                                      SaveNumber(5);
 558   3                                      break;
 559   3                              case 0x16:      // 6
 560   3                                      SaveNumber(6);
 561   3                                      break;
 562   3                              case 0x18:      // 7
 563   3                                      SaveNumber(7);
 564   3                                      break;
 565   3                              case 0x19:      // 8
 566   3                                      SaveNumber(8);
 567   3                                      break;
 568   3                              case 0x1A:      // 9
 569   3                                      SaveNumber(9);
 570   3                                      break;
 571   3                  }
 572   2              }
 573   1              if(gc_irkey==7) // 21-1key
 574   1              {
 575   2      //              dbprintf("IR Key=%bx\n",IR_REG[0x1c]);
 576   2      
 577   2                  switch(IR_REG[0x1c])
 578   2                  {
 579   3      
 580   3                              case 0x05:      // paly/pause
 581   3                                              if(gc_IRCmdStatus==1)
 582   3                                      {
 583   4                                              if(gb_NumSet==0)
 584   4                                              {
 585   5                                                      if(gc_Task_Current == C_Task_Play)
 586   5                                                      {
 587   6                                              gc_PhaseInx=3;
 588   6                                                              gc_ShowTimer=1;
 589   6                                                              
 590   6                                                      }else if(gc_Task_Current == C_Task_Jpeg)
 591   5                                                      {
 592   6                                                              gc_PhaseInx=3;
 593   6                                                      }
 594   5                                                      else if(gc_Task_Current == C_Task_Mjpeg)
 595   5                                                      {
 596   6                                                              gc_PhaseInx=3;
 597   6                                                      }
 598   5                                                              ClearIRBuffer();
 599   5                                              }
 600   4                                              else if(gb_NumSet==1)
 601   4                              {
 602   5                                      gb_PickSongSet=1;
 603   5                                                      gw_IR_Timer=1;
 604   5                                                      gb_Frequency_Song=1;
 605   5                                    
 606   5                                      gb_NumSet=0;
 607   5                              }
 608   4                                              else
 609   4                                              {
 610   5                                                      ClearIRBuffer();
 611   5                                              }
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 11  

 612   4                                      }
 613   3                                      break;
 614   3                      #if 0                                                                   //just for suo lang.
                                      case 0x46:      //Mode  //Menu   
                                              if(gc_Task_Current == C_Task_Play)
                              { 
                                                      if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <3))
                                                      {       
                                              play_stop();
                                                      gc_Task_Next=C_Task_Menu;
                                                      }
                                              }
                                              else if(gc_Task_Current == C_Task_Jpeg)
                                              {
                                                      if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <31))
                                                      {
                                                              jpeg_stop();
                                                      gc_Task_Next=C_Task_Menu;
                                                      }                               
                                                      
                                              }
                                              else if(gc_Task_Current == C_Task_Mjpeg)
                                              {
                                                      if((gc_IRCmdStatus==1) && (gc_TuneVolFreqStatus <21))
                                                      {
                                                              mjpeg_stop();
                                                      gc_Task_Next=C_Task_Menu;
                                                      }
                                              }
              
                                              break;
              #endif
 644   3      /*
 645   3                              case 0x19:      //100+
 646   3      #if 1
 647   3                                      if(gc_Task_Current == C_Task_Play)
 648   3                                      {
 649   3                                      if(gc_IRCmdStatus==1)  //20090216 chiayen add
 650   3                                      {                                       
 651   3                                              if(gw_FileTotalNumber[0]!=0)
 652   3                                              {       
 653   3                                                      U32 dw_File_StartCluster_Backup=0;
 654   3                                                      U32 dw_FDB_StartCluster_Backup=0;
 655   3       
 656   3                                                      gb_DirPlay_Flag=1;
 657   3                                      
 658   3                                                      play_stop();
 659   3                                                      gw_DirOverallNumber = gw_DirTotalNumber;
 660   3                                                      GetCurrentDirInfo();
 661   3                                                      for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
 662   3                                                      {
 663   3                                                              DOS_Search_DIR_Prev_test(0x23);
 664   3              
 665   3                                                              gb_FindFlag = 0;
 666   3      
 667   3                                                              gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
 668   3      
 669   3                                                              dw_File_StartCluster_Backup=gs_DIR_FCB[0].dw_File_StartCluster;
 670   3                                                              dw_FDB_StartCluster_Backup=gs_DIR_FCB[0].dw_FDB_StartCluster;
 671   3      
 672   3                                                              gc_test=0;
 673   3                                                              DOS_Search_File(0x10,0,0x10);
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 12  

 674   3      
 675   3                                                              if(gw_FileTotalNumber[0])
 676   3                                                              {
 677   3                                                                      DOS_Search_File(C_File_OneDir|C_By_FDB, C_MusicFileType, C_CmpExtName|C_Next);
 678   3                                                                      gw_FileIndex[0]=1;
 679   3                                                                      break;
 680   3                                                              }
 681   3                                                              gs_DIR_FCB[0].dw_File_StartCluster=dw_File_StartCluster_Backup;
 682   3                                                              gs_DIR_FCB[0].dw_FDB_StartCluster=dw_FDB_StartCluster_Backup;
 683   3                                                      }
 684   3      
 685   3                                                      gc_Dirchange_Timer=5;
 686   3                                                      gw_LogData_Timer=2;
 687   3                                                      gb_TFT_refresh=1;
 688   3                                                      if(gb_LrcFileName_Exist==1)
 689   3                                                      {
 690   3                                                              gc_DispWallpaper=0;
 691   3                                                      }
 692   3                                                      gc_PhaseInx = 3;
 693   3                                                      gb_DirPlay_Flag=1;
 694   3                                                      gc_FolderPlay_Flag=1;
 695   3                                              }
 696   3                                      }
 697   3                                       gc_folder_disp=1; //sunzhk add
 698   3                      
 699   3                                      }
 700   3      #else
 701   3                                      if(gc_IRCmdStatus==1)
 702   3                                      {
 703   3                                              if(gc_Task_Current == C_Task_Play)
 704   3                                              {
 705   3                                      gc_ShowTimer=72;
 706   3                                                      if(gc_DispPlayMenuAct==0)
 707   3                                                      {
 708   3                                                              gc_TuneVolFreqStatus=3;
 709   3                                                      }
 710   3                                              }else if(gc_Task_Current == C_Task_Jpeg)
 711   3                                              {
 712   3                                                      if(gc_DispPlayMenuAct==0)
 713   3                                                      {
 714   3                                                              gc_TuneVolFreqStatus=31;
 715   3                                                      }                               
 716   3                                              }else if(gc_Task_Current == C_Task_Mjpeg)
 717   3                                              {
 718   3                                                      if(gs_System_State.c_Phase==TASK_PHASE_PLAYACT)
 719   3                                                      {
 720   3                                                              mjpeg_playpause();
 721   3                                                      }
 722   3                      
 723   3                                              gc_ShowTimer=72;
 724   3                                                      if((gc_DispPlayMenuAct==0) || (gc_DispPlayMenuAct==0x11))
 725   3                                                      {
 726   3                                                              gc_TuneVolFreqStatus=21;
 727   3                                                      }                                       
 728   3                                              }
 729   3                                      }
 730   3      #endif
 731   3      
 732   3                                      break;
 733   3      
 734   3                      case 0x0d:                                      //0x200
 735   3                                      if(gc_Task_Current == C_Task_Play)
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 13  

 736   3                                      {
 737   3                                      if(gc_IRCmdStatus==1)  //20090216 chiayen add
 738   3              
 739   3                                      {
 740   3                                              if(gw_FileTotalNumber[0]!=0)
 741   3                                              {
 742   3                                                      play_stop();
 743   3                                                      for(tc_SearchDirTimeout=0;tc_SearchDirTimeout<=255;tc_SearchDirTimeout++)
 744   3                                                      {
 745   3                                                              gs_DIR_FCB[0].dw_FDB_StartCluster = gs_File_FCB[0].dw_FDB_StartCluster;                                                 
 746   3                                                              DOS_Search_DIR(0x23);
 747   3      
 748   3                                                              gb_FindFlag = 0;                                                                                                        
 749   3                                                              if(gc_test==0)
 750   3                                                              {
 751   3                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gs_DIR_FCB[0].dw_File_StartCluster;
 752   3                                                              }
 753   3                                                              else
 754   3                                                              {
 755   3                                                                      gs_File_FCB[0].dw_FDB_StartCluster = gdw_DOS_RootDirClus;
 756   3                                                                      gc_test=0;
 757   3                                                              }
 758   3                                                              DOS_Search_File(0x10,0,0x10);
 759   3                                                              if(gw_FileTotalNumber[0])
 760   3                                                              {
 761   3                                                                      DOS_Search_File(C_File_All|C_By_Time, C_MusicFileType, C_CmpExtName|C_Next);
 762   3                                                                      gw_FileIndex[0]=1;
 763   3                                                                      break;
 764   3                                                              }                                                                                                               
 765   3                                                      }
 766   3      
 767   3                                                      gc_Dirchange_Timer=5;
 768   3                                                      gb_TFT_refresh=1;
 769   3                                                      if(gb_LrcFileName_Exist==1)
 770   3                                                      {
 771   3                                                              gc_DispWallpaper=0;
 772   3                                                      }
 773   3      
 774   3                                                      gb_FindFlag = 1;
 775   3                                                      gc_PhaseInx = 3;
 776   3                                                      gb_DirPlay_Flag=1;
 777   3                                                      gc_FolderPlay_Flag=1;  //20090216 chiayen add                           
 778   3                                              }                               
 779   3                                      
 780   3                                      
 781   3                              }
 782   3                                              gc_folder_disp=1; //sunzhk add
 783   3                              }
 784   3                              break;
 785   3      */
 786   3                      case 0x1a:                              //eq
 787   3                                      if(gc_Task_Current == C_Task_Play)
 788   3                                      {
 789   4                                              if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 790   4                                              {
 791   5                                                      if((gc_IRCmdStatus==1)&&(gw_FileTotalNumber[0]!=0))
 792   5                                                      {
 793   6                                                              Change_EQ();
 794   6                                                      }
 795   5                                              }
 796   4                                      }
 797   3                                      break;
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 14  

 798   3                      case 0x09:      // volume --
 799   3                                      if(gs_System_State.c_Phase == TASK_PHASE_PLAYACT)
 800   3                                      {
 801   4                                              VOL_DOWN();
 802   4                                      }
 803   3                                      break;
 804   3                      case 0x01:      // volume ++
 805   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 806   3                                      {
 807   4                                              VOL_UP();
 808   4                                      }
 809   3                                      break;
 810   3                      case 0x04:      // prev 
 811   3                                      if(gc_TuneVolFreqStatus < 3)
 812   3                                      {
 813   4                                              if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 814   4                                              {
 815   5                                                      NextorPre_Song(1);
 816   5                                              }
 817   4                                      }
 818   3      
 819   3                                      break;
 820   3                      case 0x06:      // next 
 821   3                                                      
 822   3                                      if(gc_TuneVolFreqStatus < 3)
 823   3                                      {
 824   4                                                      if((gc_IRCmdStatus==1) && (gb_NumCHSet==0))
 825   4                                                      {
 826   5                                                              NextorPre_Song(0);
 827   5                                                      }
 828   4                                      }
 829   3                                      break;
 830   3                                      case 0x02:      // CH+
 831   3                                      if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 832   3                                      {
 833   4                                              if(gb_NumSet==0)
 834   4                                              {
 835   5                                                      ClearIRBuffer();
 836   5                                                      CHG_UP();
 837   5                                              }
 838   4                                              else if(gb_NumSet==1)
 839   4                                              {
 840   5                                                      ChannelSet_Process();
 841   5                                                      gc_ShowIRNumMain=0;
 842   5                                                      gb_ChannelSet=1;
 843   5                                                      gb_NumSet=0;
 844   5                                                      ClearIRBuffer();
 845   5                                              }
 846   4                                      }
 847   3      
 848   3                                      break;
 849   3                              case 0x00:      // CH-
 850   3                                              if((gc_Task_Current == C_Task_Play) ||(gc_Task_Current == C_Task_Mjpeg))
 851   3                                      {
 852   4                                              if(gb_NumSet==0)
 853   4                                              {
 854   5                                                      ClearIRBuffer();
 855   5                                                      CHG_DN();
 856   5                                              }
 857   4                                              else if(gb_NumSet==1)
 858   4                                              {
 859   5                                                      ChannelSet_Process();
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 15  

 860   5                                                      gc_ShowIRNumMain=0;
 861   5                                                      gb_ChannelSet=1;
 862   5                                                      gb_NumSet=0;
 863   5                                                      ClearIRBuffer();
 864   5                                              }
 865   4                                      }
 866   3                                      
 867   3                                      break;
 868   3                      /*      case 0x1d:       //mute
 869   3                                      if(gc_IRCmdStatus==1) 
 870   3                                      {
 871   3                                              if(gc_VolumeMute==0)
 872   3                                              {
 873   3                                                      gc_Volumebackup=gs_DSP_GLOBAL_RAM.sw_Volume;
 874   3                                                      gs_DSP_GLOBAL_RAM.sw_Volume=0;
 875   3                                                      Music_SetVolumeCmd();
 876   3                                                      gc_VolumeMute=1;
 877   3                                                      gs_DSP_GLOBAL_RAM.sw_Volume=gc_Volumebackup;
 878   3                                              }
 879   3                                              else
 880   3                                              {
 881   3                                                      Music_SetVolumeCmd();
 882   3                                                      gc_VolumeMute=0;
 883   3                                              }
 884   3                                      }
 885   3                                      break;*/
 886   3                              case 0x18:        //u/sd
 887   3                                      if(gc_IRCmdStatus==1)  //for IRSourceChange
 888   3                                      {
 889   4                                              MediaChange();  //20090107 chiayen add
 890   4                                      }                               
 891   3                                      break;
 892   3                              case 0x0a:                              //CH_set
 893   3                                      if(gc_IRCmdStatus==1)
 894   3                                      {
 895   4                                              if(gb_NumSet==1)
 896   4                                              {
 897   5                                                      ChannelSet_Process();
 898   5                                                      gc_ShowIRNumMain=0;
 899   5                                                      gb_ChannelSet=1;
 900   5                                                      gb_NumSet=0;
 901   5                                              ClearIRBuffer();
 902   5                                              }       
 903   4                                              else
 904   4                                              {
 905   5                                                      ClearIRBuffer();
 906   5                                              }
 907   4                                              break;
 908   4                                      }
 909   3                                      break;
 910   3                              case 0x08:                              //PkSong
 911   3                              if(gc_IRCmdStatus==1)
 912   3                              {
 913   4                                      if(gb_NumSet==1)
 914   4                      {
 915   5                              gb_PickSongSet=1;
 916   5                                              gw_IR_Timer=1;
 917   5                                              gb_Frequency_Song=1;
 918   5                              gb_NumSet=0;
 919   5                      }
 920   4                                      else
 921   4                                      {
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 16  

 922   5                                              ClearIRBuffer();
 923   5                                      }
 924   4                               }      
 925   3                                      break;
 926   3                              case 0x19:      //     IR 0
 927   3                              case 0x1e:      // 0
 928   3                                      SaveNumber(0);
 929   3                                      break;
 930   3                              case 0x0c:      // 1
 931   3                                      SaveNumber(1);
 932   3                                      break;
 933   3                              case 0x0d:      // 2
 934   3                                      SaveNumber(2);
 935   3                                      break;
 936   3                              case 0x0e:      // 3
 937   3                                      SaveNumber(3);
 938   3                                      break;
 939   3                              case 0x10:      // 4
 940   3                                      SaveNumber(4);
 941   3                                      break;
 942   3                              case 0x11:      // 5
 943   3                                      SaveNumber(5);
 944   3                                      break;
 945   3                              case 0x12:      // 6
 946   3                                      SaveNumber(6);
 947   3                                      break;
 948   3                              case 0x14:      // 7
 949   3                                      SaveNumber(7);
 950   3                                      break;
 951   3                              case 0x15:      // 8
 952   3                                      SaveNumber(8);
 953   3                                      break;
 954   3                              case 0x16:      // 9
 955   3                                      SaveNumber(9);
 956   3                                      break;
 957   3                  }
 958   2              }
 959   1      }
*** WARNING C280 IN LINE 175 OF IR\REMOTE.C: 'tc_SearchDirTimeout': unreferenced local variable
 960          
 961          void SaveNumber(U8 number)
 962          {
 963   1              if(gc_Task_Current != C_Task_Play)
 964   1              {return;}
 965   1          if(gc_IRCmdStatus==1)
 966   1          {
 967   2              gw_IR_Timer=120;
 968   2      
 969   2                                      
 970   2                      gc_NUMBER[3]=gc_NUMBER[2];
 971   2                      gc_NUMBER[2]=gc_NUMBER[1];
 972   2                      gc_NUMBER[1]=gc_NUMBER[0];
 973   2                      gc_NUMBER[0]=number;
 974   2                      gb_ShowIRNum=1;
 975   2                      gc_ShowIRNumMain=0;     
 976   2                              if(gb_ShowIRNum==1)                                             //
 977   2                              {
 978   3                                      gc_ShowTimer=0;
 979   3                                      gc_TuneVolFreqStatus=0;
 980   3                              
 981   3                                      if(gc_ShowIRNumMain==0)
 982   3                                      {
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 17  

 983   4                                              gc_ShowIRNumMain=1;
 984   4                                              gb_TFT_refresh=1;
 985   4                                              gc_DispWallpaper=0;
 986   4                                              TFT_IRNumMain();
 987   4                                      }
 988   3                              
 989   3                                      TFT_IRNum();
 990   3                              }
 991   2              gb_NumSet=1;
 992   2              gc_PhaseInx=1;
 993   2              
 994   2          }
 995   1      }
 996          void ClearIRBuffer(void)
 997          {
 998   1              gb_ChannelSet=0;
 999   1              gb_PickSong=0;
1000   1              gc_NUMBER[0]=0xFF;
1001   1              gc_NUMBER[1]=0xFF;
1002   1              gc_NUMBER[2]=0xFF;
1003   1              gc_NUMBER[3]=0xFF;
1004   1              gb_ShowIRNum=0;
1005   1              gb_NumSet=0;
1006   1      }
1007          
1008          
1009          void Change_EQ(void)
1010          {
1011   1      //      gb_Err=0;
1012   1              ClearIRBuffer();
1013   1              gw_LogData_Timer=60; //chiayen0812
1014   1              gw_IR_Setting_Timer=120;
1015   1              gb_IR_Setting=1;
1016   1              gs_DSP_GLOBAL_RAM.sc_EQ_Type++;
1017   1              if(gs_DSP_GLOBAL_RAM.sc_EQ_Type>5)
1018   1              {
1019   2                      gs_DSP_GLOBAL_RAM.sc_EQ_Type=0; 
1020   2              }
1021   1              Music_EQ_Cmd(gs_DSP_GLOBAL_RAM.sc_EQ_Type);
1022   1              gc_ShowTimer=/*120*/72;
1023   1              gb_Frequency_Song=1;    // 0=Show Frequency    1=Show Song Number/EQ
1024   1              gb_SelectEQ=1;                  // 0=Show Song Number  1=Show EQ
1025   1      }
1026          
1027          
1028          void VOL_UP(void)
1029          {
1030   1              if(gw_irkey_count!=0)
1031   1              {               
1032   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1033   2              }
1034   1      //      gb_Err=0;       
1035   1              ClearIRBuffer();
1036   1              gw_IR_Setting_Timer=120;
1037   1              gb_IR_Setting=1;
1038   1              if(gc_Task_Current == C_Task_Play)
1039   1              {
1040   2                      gc_PhaseInx=C_PlayVolUp;
1041   2              }else if(gc_Task_Current == C_Task_Mjpeg)
1042   1              {
1043   2                      gc_PhaseInx=C_MjpegVolUp;
1044   2              }
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 18  

1045   1      }
1046          
1047          void CHG_UP(void)
1048          {
1049   1              if(gw_irkey_count!=0)
1050   1              {               
1051   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1052   2              }
1053   1      //      gb_Err=0;       
1054   1              ClearIRBuffer();
1055   1              gw_IR_Setting_Timer=120;
1056   1              gb_IR_Setting=1;
1057   1              if(gc_Task_Current == C_Task_Play)
1058   1              {
1059   2                      gc_PhaseInx=C_PlayChgUp;
1060   2              }
1061   1              else if(gc_Task_Current == C_Task_Mjpeg)
1062   1              {
1063   2                      gc_PhaseInx=C_MjpegChgUp;
1064   2              }
1065   1      }
1066          
1067          void CHG_DN(void)
1068          {
1069   1              if(gw_irkey_count!=0)
1070   1              {               
1071   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1072   2              }
1073   1      //      gb_Err=0;       
1074   1              ClearIRBuffer();
1075   1              gw_IR_Setting_Timer=120;
1076   1              gb_IR_Setting=1;
1077   1              if(gc_Task_Current == C_Task_Play)
1078   1              {
1079   2                      gc_PhaseInx=C_PlayChgDn;
1080   2              }
1081   1              else if(gc_Task_Current == C_Task_Mjpeg)
1082   1              {
1083   2                      gc_PhaseInx=C_MjpegChgDn;
1084   2              }
1085   1      }
1086          
1087          void VOL_DOWN(void)
1088          {
1089   1              if(gw_irkey_count!=0)
1090   1              {
1091   2      //              LCM_ClearScreen();  //20090309 chiayen mark
1092   2              }
1093   1      //      gb_Err=0;                       
1094   1              ClearIRBuffer();
1095   1              gw_IR_Setting_Timer=120;
1096   1              gb_IR_Setting=1;
1097   1              if(gc_Task_Current == C_Task_Play)
1098   1              {
1099   2                      gc_PhaseInx=C_PlayVolDn;//home
1100   2              }
1101   1              else if(gc_Task_Current == C_Task_Mjpeg)
1102   1              {
1103   2                      gc_PhaseInx=C_MjpegVolDn;//home
1104   2              }
1105   1      }
1106          
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 19  

1107          
1108          void NextorPre_Song(bit tb_state)
1109          {
1110   1              gc_TuneVolFreqStatus=0;
1111   1              if(gb_LrcFileName_Exist==1)
1112   1              {
1113   2                      gb_TFT_refresh=1;
1114   2                      gc_DispWallpaper=0;
1115   2              }
1116   1      
1117   1              if((gc_RepPlayMode==C_RandomPlay && (gc_IRdetMask==1)) || (gb_FlashNoFileflag))
1118   1              {
1119   2                      return;
1120   2              }
1121   1      
1122   1              if(gc_RepPlayMode==C_RandomPlay)
1123   1              {
1124   2                      gc_IRdetMask=1;
1125   2                      ClearIRBuffer();
1126   2                      play_next();
1127   2                      gc_IRdetMask=0;
1128   2              }
1129   1              else
1130   1              {
1131   2                      if(tb_state==0)
1132   2                      {
1133   3                              if(gc_Task_Current == C_Task_Play)
1134   3                              {
1135   4                                      play_next();            
1136   4                              }else if(gc_Task_Current == C_Task_Jpeg)
1137   3                              {
1138   4                                      jpeg_next();
1139   4                              }else if(gc_Task_Current == C_Task_Mjpeg)
1140   3                              {
1141   4                                      mjpeg_next();
1142   4                              }
1143   3                      }
1144   2                      else
1145   2                      {               
1146   3                              if(gc_Task_Current == C_Task_Play)
1147   3                              {
1148   4                                      play_prev();    
1149   4                              }else if(gc_Task_Current == C_Task_Jpeg)
1150   3                              {
1151   4                                      jpeg_prev();
1152   4                              }else if(gc_Task_Current == C_Task_Mjpeg)
1153   3                              {
1154   4                                      mjpeg_prev();
1155   4                              }
1156   3                      }
1157   2                      ClearIRBuffer();
1158   2              }
1159   1      }
1160          
1161          
1162          void PickSong_Process(void)
1163          {
1164   1              data    U16     tw_SongNumber=0;
1165   1      
1166   1              gb_PickSongSet=0;
1167   1              gw_DispSongNum=0xFFFF;
1168   1      
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 20  

1169   1              if(gc_NUMBER[0]!=0xFF)
1170   1              {
1171   2                      tw_SongNumber=gc_NUMBER[0];
1172   2                      if(gc_NUMBER[1]!=0xFF)
1173   2                      {
1174   3                              tw_SongNumber+=gc_NUMBER[1]*10;
1175   3                              if(gc_NUMBER[2]!=0xFF)
1176   3                              {
1177   4                                      tw_SongNumber+=gc_NUMBER[2]*100;
1178   4                                      if(gc_NUMBER[3]!=0xFF)
1179   4                                      {
1180   5                                              tw_SongNumber+=gc_NUMBER[3]*1000;
1181   5                                      }
1182   4                              }
1183   3                      }
1184   2              }
1185   1      
1186   1              ClearIRBuffer();
1187   1              gb_NumSet=0;
1188   1              gc_ShowTimer=72;        
1189   1              gw_IR_Timer=0;
1190   1      
1191   1      
1192   1              if((tw_SongNumber<=gw_FileTotalNumber[0])&&(tw_SongNumber!=0))
1193   1              {
1194   2                      if(tw_SongNumber==gw_FileIndex[0])
1195   2                      {
1196   3                              gw_FileSkipNumber=1;
1197   3                      }
1198   2                      else if(tw_SongNumber>gw_FileIndex[0])
1199   2                      {
1200   3                              gw_FileSkipNumber=tw_SongNumber-gw_FileIndex[0];
1201   3                              play_next();
1202   3                      }
1203   2                      else
1204   2                      {
1205   3                              gw_FileSkipNumber=(gw_FileTotalNumber[0]-gw_FileIndex[0])+tw_SongNumber;
1206   3                              play_next();
1207   3                      }
1208   2                      gb_Frequency_Song=1;
1209   2              }
1210   1              else
1211   1              {
1212   2                      if(tw_SongNumber==0)
1213   2                      {
1214   3                              gb_Frequency_Song=1;
1215   3                      }
1216   2                      else
1217   2                      {
1218   3                              TFT_ShowError();
1219   3                              gb_Frequency_Song=0;
1220   3                              gc_ShowIRNumMain=0;
1221   3                              gc_ShowTimer=72;
1222   3                              return;
1223   3                      }
1224   2              }
1225   1      
1226   1              if ((gw_SongNumber!=gw_FileIndex[0])&&(gc_CurrentCard==5)&&(gw_FileTotalNumber[0]!=0))
1227   1              {
1228   2                      gw_SongNumber=gw_FileIndex[0];
1229   2              }
1230   1      
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 21  

1231   1              if ((gw_SongNumberSD!=gw_FileIndex[0])&&((gc_CurrentCard==3)||(gc_CurrentCard==2))&&(gw_FileTotalNumber[0
             -]!=0))
1232   1              {
1233   2                      gw_SongNumberSD=gw_FileIndex[0];
1234   2              }
1235   1      }
1236          
1237          void ChannelSet_Process(void)
1238          {
1239   1              U16     tw_frequency;
1240   1      
1241   1              
1242   1              tw_frequency=gc_NUMBER[2]*100+gc_NUMBER[1]*10+gc_NUMBER[0];
1243   1              if(gc_NUMBER[3]!=0xff)
1244   1              {                                               
1245   2                      tw_frequency=tw_frequency+gc_NUMBER[3]*1000;
1246   2              }
1247   1      
1248   1              if((tw_frequency>=875)&&(tw_frequency<=1080))
1249   1              {
1250   2                      gw_FM_frequency=tw_frequency;
1251   2                      FM_drive();
1252   2                      gc_ShowTimer=5;
1253   2                      gw_DisplayFreq=0xFFFF;
1254   2                      gw_IR_Timer=0;
1255   2                      gb_NumSet=0;
1256   2                      gc_NUMBER[0]=0xFF;
1257   2                      gc_NUMBER[1]=0xFF;
1258   2                      gc_NUMBER[2]=0xFF;
1259   2                      gc_NUMBER[3]=0xFF;
1260   2              }
1261   1              else
1262   1              {
1263   2                      TFT_ShowError();
1264   2                      gc_ShowTimer=72;
1265   2      
1266   2                      gw_IR_Timer=0;
1267   2                      gb_NumSet=0;
1268   2                      gc_NUMBER[0]=0xFF;
1269   2                      gc_NUMBER[1]=0xFF;
1270   2                      gc_NUMBER[2]=0xFF;
1271   2                      gc_NUMBER[3]=0xFF;
1272   2                      return;
1273   2              }
1274   1      //      TFT_Main_VOL_FM_ADJ();
1275   1      //      TFT_ShowFMFreqAdj();
1276   1              gw_LogData_Timer=10;
1277   1      }
1278          #if 1
1279          void MediaChange(void)  //20090107 chiayen add
1280          {
1281   1              if((gb_SD_Exist==1) && (gb_Host_Exist==1))
1282   1              {
1283   2                      if(gc_CurrentCard==0)
1284   2                      {
1285   3                              gc_CurrentCard=2;       
1286   3                      }
1287   2                      else if(gc_CurrentCard==2)
1288   2                      {
1289   3                              gc_CurrentCard=5;
1290   3                      }
1291   2                      else
C51 COMPILER V7.10   REMOTE                                                                02/28/2011 10:30:41 PAGE 22  

1292   2                      {
1293   3                              gc_CurrentCard=0;
1294   3                      }       
1295   2              }
1296   1              else if((gb_SD_Exist==1) && (gb_Host_Exist==0))
1297   1              {
1298   2                      if(gc_CurrentCard==0)
1299   2                      {
1300   3                              gc_CurrentCard=2;       
1301   3                      }
1302   2                      else if(gc_CurrentCard==2)
1303   2                      {
1304   3                              gc_CurrentCard=0;
1305   3                      }
1306   2              }
1307   1              else if((gb_SD_Exist==0) && (gb_Host_Exist==1))
1308   1              {
1309   2                      if(gc_CurrentCard==0)
1310   2                      {
1311   3                              gc_CurrentCard=5;       
1312   3                      }
1313   2                      else if(gc_CurrentCard==5)
1314   2                      {
1315   3                              gc_CurrentCard=0;
1316   3                      }
1317   2              }
1318   1      }
1319          #endif
1320          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2376    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
