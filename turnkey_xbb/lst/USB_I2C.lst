C51 COMPILER V7.10   USB_I2C                                                               02/28/2011 10:30:10 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE USB_I2C
OBJECT MODULE PLACED IN .\obj\USB_I2C.obj
COMPILER INVOKED BY: F:\Keil C 7.10\chengxu\C51\BIN\C51.EXE ..\libsource\USB\USB_I2C.c LARGE OPTIMIZE(9,SIZE) BROWSE NOA
                    -REGS INCDIR(..\libsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\USB_I2C.lst) OBJECT(.\obj\USB_I2C.
                    -obj)

line level    source

   1          #include <string.h>
   2          #include <intrins.h>
   3          #include "SPDA2K.h"
   4          
   5          void  USB_I2C(void)
   6          {
   7   1              XBYTE[0xB00E] = 0x00 ;                                          // disable I2C interrupt
   8   1              XBYTE[0xB00A] = 0x15 ;                                          
   9   1              XBYTE[0xB00D] = 0x0F ;                                          
  10   1              XBYTE[0xB00B] = 0x01 ;                                          
  11   1               
  12   1              XBYTE[0xB00A] = 0x10 ;                                          
  13   1              XBYTE[0xB00D] = 0x20 ;                                          
  14   1              XBYTE[0xB00B] = 0x01 ; 
  15   1              USB_I2C_ID = 0x02;
  16   1              USB_I2C_Addr = 0x0D;                                                    
  17   1          USB_I2C_Wdata = 0xA0; 
  18   1          I2C_M_Tx(USB_I2C_ID,USB_I2C_Addr,USB_I2C_Wdata);
  19   1          I2C_M_Rx(USB_I2C_ID,USB_I2C_Addr);  
  20   1      }
  21          
  22          void I2C_M_Tx(U8 ID,U8 Addr,U8 Wdata ) 
  23          {
  24   1              XBYTE[0xB00A] = 0x11 ;                                          
  25   1              XBYTE[0xB00D] = 0xD0 ;                                          
  26   1              XBYTE[0xB00B] = 0x01 ;
  27   1              
  28   1              XBYTE[0xB00A] = 0x13 ;                                          
  29   1              XBYTE[0xB00D] = ID ;                                            
  30   1              XBYTE[0xB00B] = 0x01 ;
  31   1              
  32   1              XBYTE[0xB00A] = 0x11 ;                                          
  33   1              XBYTE[0xB00D] = 0xF0 ;                                          
  34   1              XBYTE[0xB00B] = 0x01 ; 
  35   1              I2C_Wait_Intpend();
  36   1              
  37   1              XBYTE[0xB00A] = 0x13 ;                                          
  38   1              XBYTE[0xB00D] = Addr ;                                          
  39   1              XBYTE[0xB00B] = 0x01 ;
  40   1              I2C_Clr_Int();
  41   1              I2C_Wait_Intpend();
  42   1              
  43   1              XBYTE[0xB00A] = 0x13 ;                                          
  44   1              XBYTE[0xB00D] = Wdata ;                                                 
  45   1              XBYTE[0xB00B] = 0x01 ;
  46   1              I2C_Clr_Int();
  47   1              I2C_Wait_Intpend(); 
  48   1              
  49   1              XBYTE[0xB00A] = 0x11 ;                                          
  50   1              XBYTE[0xB00D] = 0xD0 ;                                          
  51   1              XBYTE[0xB00B] = 0x01 ;
  52   1      }
  53          
C51 COMPILER V7.10   USB_I2C                                                               02/28/2011 10:30:10 PAGE 2   

  54          
  55          void I2C_Clr_Int(void )
  56          {
  57   1              XBYTE[0xB00A] = 0x10 ;                                          
  58   1              XBYTE[0xB00D] = 0x20 ;                                          
  59   1              XBYTE[0xB00B] = 0x01 ;
  60   1      }
  61          
  62          
  63          void I2C_Wait_Intpend(void )
  64          {
  65   1              while(!(XBYTE[0xB00F]&0x01));
  66   1      }
  67          
  68          
  69          void I2C_M_Rx(U8 ID,U8 Addr) 
  70          {
  71   1              XBYTE[0xB00A] = 0x11 ;                                          
  72   1              XBYTE[0xB00D] = 0xD0 ;                                          
  73   1              XBYTE[0xB00B] = 0x01 ;
  74   1              
  75   1              XBYTE[0xB00A] = 0x13 ;                                          
  76   1              XBYTE[0xB00D] = ID ;                                            
  77   1              XBYTE[0xB00B] = 0x01 ;
  78   1              
  79   1              XBYTE[0xB00A] = 0x11 ;                                          
  80   1              XBYTE[0xB00D] = 0xF0 ;                                          
  81   1              XBYTE[0xB00B] = 0x01 ; 
  82   1              I2C_Wait_Intpend();
  83   1              
  84   1              XBYTE[0xB00A] = 0x13 ;                                          
  85   1              XBYTE[0xB00D] = Addr ;                                          
  86   1              XBYTE[0xB00B] = 0x01 ;
  87   1              I2C_Clr_Int();
  88   1              I2C_Wait_Intpend();
  89   1              
  90   1              XBYTE[0xB00A] = 0x11 ;                                          
  91   1              XBYTE[0xB00D] = 0xD0 ;                                          
  92   1              XBYTE[0xB00B] = 0x01 ;
  93   1              
  94   1              XBYTE[0xB00A] = 0x11 ;                                          
  95   1              XBYTE[0xB00D] = 0x90 ;                                          
  96   1              XBYTE[0xB00B] = 0x01 ;
  97   1              
  98   1              XBYTE[0xB00A] = 0x13 ;                                          
  99   1              XBYTE[0xB00D] = ID ;                                            
 100   1              XBYTE[0xB00B] = 0x01 ;
 101   1              
 102   1              XBYTE[0xB00A] = 0x11 ;                                          
 103   1              XBYTE[0xB00D] = 0xB0 ;                                          
 104   1              XBYTE[0xB00B] = 0x01 ;
 105   1              I2C_Wait_Intpend();
 106   1              I2C_Clr_Int();
 107   1              I2C_Wait_Intpend();
 108   1              
 109   1              XBYTE[0xB00A] = 0x11 ;                                          
 110   1              XBYTE[0xB00D] = 0xD0 ;                                          
 111   1              XBYTE[0xB00B] = 0x01 ;
 112   1              
 113   1              XBYTE[0xB00A] = 0x13 ;
 114   1              XBYTE[0xB00B] = 0x10 ;
 115   1              USB_I2C_Rdata  =XBYTE[0xB00C];  
C51 COMPILER V7.10   USB_I2C                                                               02/28/2011 10:30:10 PAGE 3   

 116   1      }
 117          
 118          
 119          void USB_On(void)
 120          {
 121   1              /*------------ Speed Up USB CLK -----------*/  
 122   1              set_clock_mode(CLOCK_MODE_USB);                      
 123   1              USB_Mode();
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    302    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
