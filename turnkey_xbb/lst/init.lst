C51 COMPILER V7.10   INIT                                                                  02/28/2011 10:30:21 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE INIT
OBJECT MODULE PLACED IN .\obj\init.obj
COMPILER INVOKED BY: F:\Keil C 7.10\chengxu\C51\BIN\C51.EXE MAIN\init.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\
                    -libsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\init.lst) OBJECT(.\obj\init.obj)

line level    source

   1          #include "SPDA2K.h"
   2          #include "..\header\variables.h"
   3          
   4          extern void init_const_timer(void);
   5          
   6          void init_system(void)
   7          {
   8   1              /**************************************************************************
   9   1               * Set CKCON
  10   1               **************************************************************************/
  11   1              // CKCON
  12   1              //              T0_PRE  = 0             not prescaling timer 0
  13   1              //              MD_SRW  = 0
  14   1              //              MDR2    = 0             //timer2 * 3
  15   1              //              MDR1    = 0             //timer1 * 3
  16   1              //              MDR0    = 0             //timer0 * 3
  17   1              //              MDW2    = 0
  18   1              //              MDW1    = 1
  19   1              //              MDW0    = 0
  20   1              CKCON    = 0x10;//(JC)H0229
  21   1      
  22   1              // Initial Global Register
  23   1              /**************************************************************************
  24   1               * Reset hardware macros.
  25   1               **************************************************************************/
  26   1              XBYTE[0xB002] = 0x07;   // 0000 0111 reset USB device
  27   1              XBYTE[0xB002] = 0x0B;   // 0000 1011 reset FM(flash memory) & memory card, include DSP memory mode, DMA, FM
             - regs
  28   1              XBYTE[0xB002] = 0x13;   // 0001 0011 reset IR controller
  29   1              XBYTE[0xB002] = 0x83;   // 1000 0011 reset DSP memory controller
  30   1              XBYTE[0xB002] = 0x03;   // 0000 0011 reset finish (keep reset DSP and HOST)
  31   1      
  32   1              XBYTE[0xB010] = 0x00;   // Disable DSP & DSP memory controller clock
  33   1              XBYTE[0xB011] = 0x46;   // Enable DMA, FM, RTC clock.  Disable USB, Host clock.
  34   1      
  35   1              /**************************************************************************
  36   1               * Initialize timer and UART
  37   1               **************************************************************************/
  38   1              // timer
  39   1              // TMOD                                 Page 83
  40   1              //              GATE_T1 = 0
  41   1              //              C/Tj_T1 = 0             interval timer
  42   1              //              M1_T1   = 1             mode 2: 8-bit auto-reload mode
  43   1              //              M0_T1   = 0
  44   1              //              GATE_T0 = 0
  45   1              //              C/Tj_T0 = 0             interval timer
  46   1              //              M1_T0   = 0             mode 1: 16-bit timer mode
  47   1              //              M0_T0   = 1
  48   1              TMOD = 0x21;
  49   1              // TCON                                 Page 84
  50   1              //              TF1     = 0             Timer 1 overflow flag.
  51   1              //              TR1     = 0             Timer 1 run-control bit.
  52   1              //              TF0     = 0             Timer 0 overflow flag.
  53   1              //              TR0     = 0             Timer 0 run-control bit.
C51 COMPILER V7.10   INIT                                                                  02/28/2011 10:30:21 PAGE 2   

  54   1              //              IE1     = 0             External interrupt 1 edge flag.
  55   1              //              IT1     = 1     External interrupt 1 type flag. 1 = edge, 0 = level.
  56   1              //              IE0     = 0             External interrupt 0 edge flag.
  57   1              //              IT0     = 1     External interrupt 0 type flag. 1 = edge, 0 = level.
  58   1              TCON = 0x05;
  59   1              // TIMER1 MODE2
  60   1              // BAUD = 
  61   1              //      SMOD
  62   1              //     2                        F            CKCON[4]
  63   1              //   -----   X  ------------- X 3 
  64   1              //     32                12X(256-TH1)
  65   1              TH1 = 243;      // UART baud rate = 14400bps at CPU 12MHz
  66   1              
  67   1              // UART
  68   1              // SCON                                 Page 101
  69   1              //              SM0     = 1             9-bit UART, variable baud rate set by timer 1.
  70   1              //              SM1     = 1
  71   1              //              SM2     = 0
  72   1              //              REN     = 0             Receiver enabler.
  73   1              //              TB8     = 1             Transmit bit 8. 9th bit transmitted in modes 2 and 3.
  74   1              //              RB8     = 0             Receive bit 8. 9th bit received.
  75   1              //              TI      = 0             Transmit interrupt flag.
  76   1              //              RI      = 0             Receive interrupt flag.
  77   1              SCON = 0xC8;
  78   1              
  79   1              //PCON[7]
  80   1              //      SMOD    = 0     double the UART Baud rate
  81   1              PCON = 0x80;    
  82   1              
  83   1              TR1     = 1;            // TR1:  timer 1 run
  84   1              TI      = 1;            // TI:   set TI to send first char of UART
  85   1      
  86   1              /**************************************************************************
  87   1               * Set clock to MP3 mode.  TBD : Should be changed to a lower clock rate.
  88   1               **************************************************************************/
  89   1      //      set_clock_mode(CLOCK_MODE_XTL);
  90   1              /**************************************************************************
  91   1               * Set GPIO directions.  GPIO usage may vary between different turnkeys.
  92   1               **************************************************************************/
  93   1              P1 = 0xff;      // P1 output high to turn off transistor and to avoid input grounded.
  94   1              CPU_REG[0x02] = 0x00;
  95   1              P3 = 0xff;      // P3 output high to turn off transistor and to avoid input grounded.
  96   1              CPU_REG[0x03] = 0x02;   // set P3.1 UART Tx pin output enabled.
  97   1      
  98   1              /**************************************************************************
  99   1               * Set constant timer and RTC(if necessary).
 100   1               * TBD : RTC status needs a nonvolatile record.
 101   1               **************************************************************************/
 102   1              init_const_timer();     // initialize constant timer.
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     67    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
