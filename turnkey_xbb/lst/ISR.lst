C51 COMPILER V7.10   ISR                                                                   02/28/2011 10:30:15 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE ISR
OBJECT MODULE PLACED IN .\obj\ISR.obj
COMPILER INVOKED BY: F:\Keil C 7.10\chengxu\C51\BIN\C51.EXE MAIN\ISR.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\l
                    -ibsource\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\ISR.lst) OBJECT(.\obj\ISR.obj)

line level    source

   1          #include "SPDA2K.h"
   2          #include "..\header\variables.h"
   3            
   4          extern  data    bit     gb_HostConnect;  
   5          //extern        data    U8      gc_PKSongCHSetMode;
   6          extern  xdata   U8      gc_ShowMenuTimer;
   7          
   8          extern xdata U8 gb_NumCHSet;
   9          
  10          extern void System_HostDetect();
  11          
  12          //=======================================================================
  13          /*****************************************************************************
  14          * NAME:         void _HostISR(void)
  15          * DESCRIPTION:
  16          *
  17          *****************************************************************************/
  18          void HostISR(void) interrupt 0 using 1 
  19          {
  20   1              U8      tc_USB_flag;
  21   1              EX0 = 0;
  22   1              
  23   1              if(IR_REG[0x19]!=0)  //for IR
  24   1              {
  25   2                      if(IR_REG[0x19]==1)
  26   2                      {
  27   3                              gc_IRCmdStatus=1;
  28   3                              gc_ircount=0;
  29   3                      }
  30   2                      if(IR_REG[0x19]==2)
  31   2                      {
  32   3                              gc_ircount++;
  33   3                              if(gc_ircount>20)
  34   3                              {
  35   4                                      gc_IRCmdStatus=2;
  36   4                                      gc_ircount=0;
  37   4                              }
  38   3                      }
  39   2                      IR_REG[0x19] = 7;
  40   2              }
  41   1              else if(gbt_USB_Detected)  
  42   1              {
  43   2                      USB_REG[0xD0] = 0x00;
  44   2                      USB_REG[0xA0] = 0x00;
  45   2                      if(USB_REG[0xC3]==0x10){        
  46   3                      gc_USB_ADDR = USB_REG[0xF2];
  47   3                  } 
  48   2                  if ((USB_REG[0xC2] & 0x02)) { // End Point 2 in (Bulk Out)
  49   3                      
  50   3                      USB_REG[0xC2]   &= 0xFD;   
  51   3              
  52   3                              gbt_USB_CMD_IN     = 1;
  53   3                      }
  54   2                      else
C51 COMPILER V7.10   ISR                                                                   02/28/2011 10:30:15 PAGE 2   

  55   2                      {
  56   3                              tc_USB_flag=USB_REG[0xC0];
  57   3                              if(tc_USB_flag&0x08)    // RESET
  58   3                              {
  59   4                                  gbt_USBRST_int_flag = 1;                
  60   4                              }   
  61   3                              else if(tc_USB_flag&0x01)       // SETUP
  62   3                              {
  63   4                                      gb_USB_ISR_Detected=1;
  64   4                                  gbt_EP0SETUP_int_flag   = 1;                    
  65   4                              }
  66   3                              else if(tc_USB_flag&0x02)       // OUT
  67   3                              { 
  68   4                                  gbt_EP0TX_int_flag      = 1;
  69   4                              }
  70   3                              else if(tc_USB_flag&0x04)       // IN
  71   3                              {
  72   4                                 gbt_EP0RX_int_flag      = 1;
  73   4                              }
  74   3                              else if(tc_USB_flag&0x10)       // SUSPEND
  75   3                              { 
  76   4                                 gbt_SUSPEND_int_flag = 1;
  77   4                              }
  78   3                              else if(tc_USB_flag&0x20)
  79   3                              { 
  80   4                                 gbt_USB_CONFIG_Chg_int_flag = 1;
  81   4                              }
  82   3                              else if(tc_USB_flag&0x40)       // WAKEUP
  83   3                              { 
  84   4                                 
  85   4                              }
  86   3                              else if(tc_USB_flag&0x80)       // RESUME
  87   3                              { 
  88   4                                 gbt_RESUME_int_flag = 1;
  89   4                              }
  90   3                              else
  91   3                              {
  92   4                                
  93   4                              }
  94   3                              
  95   3                              Control_Transfer_Process();
  96   3                      USB_REG[0xC0] = 0x00;
  97   3              
  98   3                      if(gc_CX_Status_flag&CX_STL     )
  99   3                              {
 100   4                              USB_REG[0xE8] =0x03;
 101   4                              gc_CX_Status_flag =0;
 102   4                      }
 103   3                      else
 104   3                              {
 105   4                              USB_REG[0xE8] =0x00;
 106   4                      }
 107   3                      
 108   3                      USB_REG[0xA0] = 0x03;
 109   3                      }
 110   2                      USB_REG[0xD0] |= 0xFF;  //20081211 chiayen modify
 111   2                      USB_REG[0xc3]  = 0x00;  
 112   2                      USB_REG[0xD3]  = 0x10;
 113   2              }
 114   1              EX0 = 1;                // enable INT 0
 115   1      }
 116          
C51 COMPILER V7.10   ISR                                                                   02/28/2011 10:30:15 PAGE 3   

 117          /*****************************************************************************
 118          * NAME:         void Timer0(void)
 119          * DESCRIPTION:
 120          *
 121          *****************************************************************************/
 122          void Timer0() interrupt 1 using 2
 123          {
 124   1          TR0 = 0;
 125   1              TH0 = gc_T0IntervalMSB;
 126   1              TL0 = gc_T0IntervalLSB;
 127   1          TR0 = 1;
 128   1      
 129   1              gw_Random_Timer++;
 130   1      
 131   1              if(gbt_USB_Detected)
 132   1              {
 133   2      //              return;
 134   2              }
 135   1      
 136   1              gc_XTimeBase = (gc_XTimeBase >= 3)? 0:(gc_XTimeBase+1);//(JC)Timebase x 4;Timebase=~7.5ms
 137   1              switch(gc_XTimeBase)
 138   1              {
 139   2                      case 0:
 140   2      
 141   2                      break;
 142   2                      case 1:
 143   2                              if(gbLKeyTimer_Timeout==0)
 144   2                              {
 145   3                                      gbLKeyTimer_Timeout=1;  
 146   3                              }                       
 147   2                      break;
 148   2                      
 149   2                      case 2:
 150   2                              if(gbGetKey_Timeout==0)
 151   2                              {
 152   3                                      gbGetKey_Timeout=1;     
 153   3                              }               
 154   2      
 155   2                              if(gw_LogData_Timer!=0)
 156   2                              {
 157   3                                      gw_LogData_Timer--;
 158   3                                      if(gw_LogData_Timer==0)
 159   3                                      {
 160   4                                              gc_LogDataFlag=1;
 161   4                                      }
 162   3                              }
 163   2      
 164   2                              if(gc_ShowTimer!=0)
 165   2                              {
 166   3                                      gc_ShowTimer--;
 167   3                                      if(gc_ShowTimer==0)
 168   3                                      {
 169   4                                              gc_TuneVolFreqStatus=0;
 170   4                                              gb_Frequency_Song=0;
 171   4                                              gb_SelectEQ=0;
 172   4      //                                      gb_Err=0;
 173   4                                      }
 174   3                              }
 175   2      
 176   2                              if(gc_ShowMenuTimer!=0)
 177   2                              {
 178   3                                      gc_ShowMenuTimer--;
C51 COMPILER V7.10   ISR                                                                   02/28/2011 10:30:15 PAGE 4   

 179   3                              }
 180   2      
 181   2                              if(gw_DisplayBitrateTime!=0)
 182   2                              {
 183   3                                      gw_DisplayBitrateTime--;
 184   3                              }
 185   2      
 186   2                              if(gw_IR_Setting_Timer!=0)
 187   2                              {
 188   3                                      gw_IR_Setting_Timer--;
 189   3                                      if(gw_IR_Setting_Timer==0)
 190   3                                      {
 191   4                                              gb_IR_Setting=0;
 192   4                                      }
 193   3                              }
 194   2                      
 195   2                              if(gw_AutoJpeg_Timer!=0)  //20090331
 196   2                              {
 197   3                                      gw_AutoJpeg_Timer--;
 198   3                              }
 199   2                      
 200   2                              if(gw_ChangeFrequencyTimer!=0)
 201   2                              {
 202   3                                      gw_ChangeFrequencyTimer--;
 203   3                              }
 204   2                      
 205   2                              if(gw_LCMScrollTimer!=0)
 206   2                              {
 207   3                                      gw_LCMScrollTimer--;
 208   3                              }
 209   2      
 210   2                              if(gc_Vrefinit_Timer!=0)
 211   2                              {
 212   3                                      gc_Vrefinit_Timer--;
 213   3                              }
 214   2      
 215   2                              if(gc_PlayMenu_Timeout!=0)  //20090107 chiayen add
 216   2                              {
 217   3                                      gc_PlayMenu_Timeout--;
 218   3                              }
 219   2      
 220   2                              if(gc_Dirchange_Timer!=0)  //20090107 chiayen add
 221   2                              {
 222   3                                      gc_Dirchange_Timer--;
 223   3                              }
 224   2      
 225   2                              if(gw_IR_Timer!=0)
 226   2                              {
 227   3                                      gw_IR_Timer--;
 228   3                                      if(gw_IR_Timer==0)
 229   3                                      {               
 230   4                                              gb_PickSongSet=1;
 231   4                                              gc_ShowTimer=72;
 232   4                                      }               
 233   3                              }
 234   2                      break;
 235   2      
 236   2                      case 3:
 237   2      
 238   2                      break;
 239   2      
 240   2                      default:
C51 COMPILER V7.10   ISR                                                                   02/28/2011 10:30:15 PAGE 5   

 241   2              break;
 242   2              }//switch
 243   1              //System_HostDetect();
 244   1              {
 245   2                      U8 i;
 246   2                      if(gb_HostConnect == 1)
 247   2                      {       
 248   3                              for(i=0;i<10;i++)
 249   3                              {
 250   4                                      if(XBYTE[0xB615]!=0x00)
 251   4                                      {
 252   5                                              return;
 253   5                                      }
 254   4                              }
 255   3                              gb_HostConnect = 0;
 256   3                      }
 257   2                      return;
 258   2              }
 259   1      }
 260          
 261          
 262          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    496    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
