C51 COMPILER V9.00   USBCOMM                                                               07/09/2012 21:16:55 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE USBCOMM
OBJECT MODULE PLACED IN .\obj\usbComm.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE USB\usbComm.C LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\libsource\hea
                    -der) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\usbComm.lst) OBJECT(.\obj\usbComm.obj)

line level    source

   1          #include "..\header\SPDA2K.h"
   2          #include "..\header\variables.h"
   3          
   4          void PowerOn_Init_USB(void) 
   5          {
   6   1              /*------------- Power On USB Init --------------*/
   7   1              XBYTE[0xB019] = 0x00;                        // USB Device mode
   8   1              XBYTE[0xB011]|= 0x10;                        // Enable USB CLK 
   9   1              //   Enale  each clocks and Reset USB Phy       //
  10   1              //   FM + DMA + DM                              //
  11   1              //----------------------------------------------//
  12   1              XBYTE[0xB016]=0x04;                       // power on default is 0x04
  13   1              XBYTE[0xB0E9]&=0xFE;                       // Enable usb pll clk 
  14   1              USER_Delay(5);                              // 使用Delay 方式不用polling方式
  15   1              XBYTE[0xB01D]=0x00;                        // 090510 Jay USB SRAM USE USB Phy clk
  16   1              XBYTE[0xB002]|=0x04;                       // bit 3   turn on USB_SW_RESET
  17   1              XBYTE[0xB002]&=0xFB;                       // bit 3   turn off USB_SW_RESET
  18   1      }
  19          
  20          
  21          void USBInitialize(void) 
  22          {
  23   1              XBYTE[0xB017]=0x00;   //USB_READY_DISABLE;
  24   1              XBYTE[0xB5A0]=0x00;             
  25   1              XBYTE[0xB5A1]=0x00;             
  26   1              XBYTE[0xB5A2]=0x00;
  27   1              XBYTE[0xB530]=0x0F;     
  28   1              //Enable all module clk.
  29   1              XBYTE[0xB0F0]=0xFF;
  30   1              XBYTE[0xB0F1]=0xFF;
  31   1              XBYTE[0xB0F2]=0x00;
  32   1              
  33   1              XBYTE[0xB5D3]=0xFF;             //Enable SetFeature INT.
  34   1              XBYTE[0xB5D2]=0x02;             //Enable Bulk Out       
  35   1              XBYTE[0xB5C0]=0x00;
  36   1              XBYTE[0xB5D0]=0xFF;  
  37   1              XBYTE[0xB5D3]=0x10;
  38   1              //081023 Jay add for DMA register reset
  39   1              XBYTE[0xB340]=0x00;             // re-store default 
  40   1              XBYTE[0xB341]=0x00;
  41   1              XBYTE[0xB390]=0x00;
  42   1              gb_XferNormalResponseData_ModeSense=NormalResponseData;
  43   1              gc_CX_Status_flag=0;
  44   1              gb_USBRST_int_flag=0;
  45   1              gb_USB_CMD_IN=0;
  46   1              gc_USB_ADDR=1;
  47   1              gb_USB_Connect_Flag=0;
  48   1              gb_USER_Remove_Flag=0;
  49   1              gb_MediaChanged=0;
  50   1              gb_Start_Stop_Flag=0; 
  51   1              gc_USBStage=CBWStage;
  52   1      }
  53          

C51 COMPILER V9.00   USBCOMM                                                               07/09/2012 21:16:55 PAGE 2   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    145    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
