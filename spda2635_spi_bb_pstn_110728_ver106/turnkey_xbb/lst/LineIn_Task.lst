C51 COMPILER V9.00   LINEIN_TASK                                                           07/09/2012 21:16:55 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LINEIN_TASK
OBJECT MODULE PLACED IN .\obj\LineIn_Task.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LineIn\LineIn_Task.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\libsou
                    -rce\header) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\LineIn_Task.lst) OBJECT(.\obj\LineIn_Task.obj)

line level    source

   1          #include "..\Header\SPDA2K.h"
   2          #include "..\DSP\dspuser.h"
   3          #include "..\header\variables.h"
   4          
   5          
   6          void Linein_VolAdj_2()
   7          {
   8   1              xdata   U8      tc_TmpData;
   9   1              
  10   1              if(gb_ADJ==0)
  11   1              {
  12   2                      if(gs_DSP_GLOBAL_RAM.sc_Volume==0)
  13   2                      {
  14   3                              XBYTE[0xB0C6]=0;   //(Jimi 091030)Line in gain L maximum
  15   3                              XBYTE[0xB0C7]=0;   //(Jimi 091030)Line in gain R maximum
  16   3                      }
  17   2      
  18   2                      if(gs_DSP_GLOBAL_RAM.sc_Volume<42)
  19   2                      {
  20   3                              gs_DSP_GLOBAL_RAM.sc_Volume+=2;
  21   3                      }
  22   2      
  23   2                      tc_TmpData=31-(gs_DSP_GLOBAL_RAM.sc_Volume/2);
  24   2                      XBYTE[0xB0C4]=tc_TmpData;  //(Jimi 091030)Headphone gain Lch
  25   2                      XBYTE[0xB0C5]=tc_TmpData;  //(Jimi 091030)Headphone gain Rch
  26   2                      LCM_ShowVOL();
  27   2              }
  28   1              else
  29   1              {
  30   2                      if(gs_DSP_GLOBAL_RAM.sc_Volume>1)
  31   2                      {
  32   3                              gs_DSP_GLOBAL_RAM.sc_Volume-=2;
  33   3                      }
  34   2      
  35   2                      tc_TmpData=31-(gs_DSP_GLOBAL_RAM.sc_Volume/2);
  36   2                      XBYTE[0xB0C4]=tc_TmpData;  //(Jimi 091030)Headphone gain Lch
  37   2                      XBYTE[0xB0C5]=tc_TmpData;  //(Jimi 091030)Headphone gain Rch
  38   2                      if(gs_DSP_GLOBAL_RAM.sc_Volume==0)
  39   2                      {
  40   3                              XBYTE[0xB0C6]=31;
  41   3                              XBYTE[0xB0C7]=31;
  42   3                      }
  43   2                      LCM_ShowVOL();
  44   2              }
  45   1      }
  46          
  47          void Linein_Out_2(void)
  48          {
  49   1              DSP_Write_MMR16(0x3FC1,(DSP_Read_MMR16(0x3FC1)|0x0010));
  50   1          XBYTE[0xB0C2]=0;       //disable ADC LRch(bit[1:0]), Mic bias(bit[2]) and Mic boost(bit[5:4])
  51   1          XBYTE[0xB0C1]&=0xFC;   //set audio driver post-mux as DAC output
  52   1          XBYTE[0xB0C1]|=0x30;   //power down ADC input pre-mux
  53   1          XBYTE[0xB0ED]|=0x02;   //Audio DA zero cross reset bypass on
  54   1          XBYTE[0xB0C4]=0;       //LCH speaker volume(i.e LCH OP Gain)
C51 COMPILER V9.00   LINEIN_TASK                                                           07/09/2012 21:16:55 PAGE 2   

  55   1          XBYTE[0xB0C5]=0;       //RCH speaker volume(i.e RCH OP Gain)
  56   1      }
  57          
  58          void Linein_Set_2(void)
  59          {
  60   1          data        U8 tc_TmpData;
  61   1          
  62   1              XBYTE[0xB010]|=0x01;
  63   1              
  64   1              XBYTE[0xB0C4]=0x1F;          //(Jimi 091030)mute headphone Lch
  65   1              XBYTE[0xB0C5]=0x1F;          //(Jimi 091030)mute headphone Rch
  66   1              XBYTE[0xB0C2]|=0x03;         //(Jimi 091030)ADC enable
  67   1              DSP_Write_MMR16(0x3FC0,(DSP_Read_MMR16(0x3FC0)|0x0200));    //audio ADC clock enable
  68   1              
  69   1              XBYTE[0xB0C1]&=0xCC;       //(Jimi 091030)
  70   1              XBYTE[0xB0C1]|=0x11;       //(Jimi 091030)set pre-mux and post-mux as line-in
  71   1              XBYTE[0xB0ED]|=0x01;       //(Jimi 091030)disable ADC zero cross detect
  72   1              
  73   1              if(gb_linein_mute==0)
  74   1              {
  75   2                      tc_TmpData=31-(gs_DSP_GLOBAL_RAM.sc_Volume/2);
  76   2                      XBYTE[0xB0C4]=tc_TmpData;  //(Jimi 091030)Headphone gain Lch
  77   2                      XBYTE[0xB0C5]=tc_TmpData;  //(Jimi 091030)Headphone gain Rch
  78   2                      XBYTE[0xB0C6]=0;   //(Jimi 091030)Line in gain Lch maximum
  79   2                      XBYTE[0xB0C7]=0;   //(Jimi 091030)Line in gain Rch maximum
  80   2              }
  81   1              else
  82   1              {
  83   2                      XBYTE[0xB0C6]=31;    //(Jimi 091030)Line in gain Lch mute
  84   2                      XBYTE[0xB0C7]=31;    //(Jimi 091030)Line in gain Rch mute
  85   2              }
  86   1      }
  87          
  88          void AccessKeyEvent_LineIn()
  89          {
  90   1      //      data    U8      tc_temp;
  91   1      //      xdata   U8      i;
  92   1      
  93   1              switch(gc_KeyEvent)
  94   1              {
  95   2                      case 0x02:      // Play
  96   2                              if(gb_FM_Mute==1)
  97   2                              {
  98   3                                      gb_FM_Mute=0;
  99   3                                      gb_linein_mute=1;
 100   3                                      Linein_Set();
 101   3                              }else
 102   2                              {
 103   3                                      gb_FM_Mute=1;
 104   3                                      gb_linein_mute=0;
 105   3                                      Linein_Set();
 106   3                              }
 107   2                      break;
 108   2      
 109   2                      case 0x03:      // Next
 110   2                              gb_ADJ=0;
 111   2                              if(gb_SetVol)
 112   2                              {
 113   3                                      Linein_VolAdj_2();      // Volume Adjust
 114   3                              }                       
 115   2                      break;
 116   2      
C51 COMPILER V9.00   LINEIN_TASK                                                           07/09/2012 21:16:55 PAGE 3   

 117   2                      case 0x04:      // Prev
 118   2                              gb_ADJ=1;
 119   2                              if(gb_SetVol)
 120   2                              {
 121   3                                      Linein_VolAdj_2();      // Volume Adjust
 122   3                              }               
 123   2                      break;
 124   2      
 125   2                      case 0x05:      // V
 126   2                              if(gb_SetVol==0)
 127   2                              {
 128   3                                      gb_SetVol=1;
 129   3                                      gc_MenuTimer=6;
 130   3                                      LCM_Clear_L2_L5();
 131   3                                      LCM_ShowVOL();
 132   3                                      ClearIRNumberVariable();
 133   3                              }                       
 134   2                      break;
 135   2      
 136   2                      case 0x06:      // M                    
 137   2                      break;
 138   2      
 139   2                      case 0x12:      // L-Play               
 140   2                      break;
 141   2      
 142   2                      case 0x13:      // L-Next
 143   2                              if(gb_SetVol==1)
 144   2                              {
 145   3                                      gb_ADJ=0;       // Volume Adjust
 146   3                                      Linein_VolAdj_2();
 147   3                                      gc_LongKeyCount=30;
 148   3                              }               
 149   2                      break;
 150   2      
 151   2                      case 0x14:      // L-Prev
 152   2                              if(gb_SetVol==1)
 153   2                              {
 154   3                                      gb_ADJ=1;       // Volume Adjust
 155   3                                      Linein_VolAdj_2();
 156   3                                      gc_LongKeyCount=30;
 157   3                              }
 158   2                      break;
 159   2      
 160   2                      case 0x15:      // L-V          
 161   2                      break;
 162   2      
 163   2                      case 0x16:      // L-M          
 164   2                      break;
 165   2              }
 166   1      }
 167          
 168          void LineIn_Task(void)
 169          {  
 170   1              set_clock_mode(CLOCK_MODE_MP3);
 171   1      //      Music_WakeUp(DSP_CLK_CTRL | SRAM2T_CTRL);
 172   1              MP3_Download();
 173   1      
 174   1              Linein_Set_2();
 175   1              LCM_Show_LineIn();
 176   1              while(1)
 177   1              {
 178   2                      Key_Detect();
C51 COMPILER V9.00   LINEIN_TASK                                                           07/09/2012 21:16:55 PAGE 4   

 179   2                      if(gc_KeyEvent!=0)
 180   2                      {
 181   3                              gc_MenuTimer=6;
 182   3                              AccessKeyEvent_LineIn();
 183   3                              gc_KeyEvent=0;
 184   3                      }
 185   2                      
 186   2                      if((gc_MenuTimer==0)&&(gb_SetVol))
 187   2                      {
 188   3                              gb_SetVol=0;
 189   3                              // Show LCM icon
 190   3                              LCM_Show_LineIn();
 191   3                      }
 192   2      
 193   2                      if(XBYTE[0xb409]&0x04)//LineIn out 
 194   2                      {
 195   3                      dbprintf("linein out\n");
 196   3                              gc_Task_Current=C_Task_MusicPlay;       
 197   3                      }
 198   2                      if(gc_Task_Current != C_Task_LineIn)
 199   2                      {                       
 200   3                              Linein_Out_2();
 201   3                  break;      
 202   3                      }
 203   2              }
 204   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    422    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
