C51 COMPILER V9.00   PLAY_WAV                                                              07/09/2012 21:16:55 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PLAY_WAV
OBJECT MODULE PLACED IN .\obj\Play_wav.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE WAV\Play_wav.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INCDIR(..\libsource\he
                    -ader) DEFINE(K_ICTYPE=0x03) DEBUG OBJECTEXTEND PRINT(.\lst\Play_wav.lst) OBJECT(.\obj\Play_wav.obj)

line level    source

   1          #include "..\header\SPDA2K.h"
   2          #include "..\DSP\DSPPHYSIC.H"
   3          #include "..\DSP\dspuser.h"
   4          #include "..\header\variables.h"
   5          
   6          
   7          void WAV_Play(void)
   8          {
   9   1              data    U8      tc_temp;
  10   1      
  11   1              XBYTE[0xB046]&=~0x04;
  12   1              XBYTE[0xB0C1]=0xB3;
  13   1              XBYTE[0xB0C2]=0x00;     // disable ADC, MIC bias voltage and boost amplifier 18dB(0x3)
  14   1              gc_CurrentCard=gc_LastCard;
  15   1              gc_Play_FileType=2;
  16   1              gs_System_State.c_Phase=TASK_PHASE_STOP;
  17   1              gw_CurrentSec=0;
  18   1              gw_FileIndex[0]=0;
  19   1              gw_FileTotalNumber[0]=0;
  20   1              gb_SetVol=0;
  21   1              gb_LrcFileName_Exist=0;
  22   1              RefreshAllDisplay();
  23   1              // Select Media
  24   1              MediaSelect();  //gb_ChangeMedia=1->Success
  25   1              if(gc_CurrentCard!=2&&gc_CurrentCard!=5)
  26   1              {
  27   2                      // No Media
  28   2                      gc_Task_Current=C_Task_Idle;
  29   2                      return;
  30   2              }
  31   1      
  32   1              while(1)
  33   1              {
  34   2                      if(gb_ChangeMedia==1)
  35   2                      {
  36   3                              gb_ChangeMedia=0;
  37   3                              gs_System_State.c_Phase=TASK_PHASE_STOP;
  38   3                              if(MediaInitial()==0)
  39   3                              {
  40   4                                      if(SearchFolder_VOICE()==0)     // Search Folder_VOICE OK
  41   4                                      {
  42   5                                              if(gw_FileTotalNumber[1]!=0)
  43   5                                              {
  44   6                                                      gs_System_State.c_Phase=TASK_PHASE_PLAYACT;
  45   6                                                      DOS_Search_File(C_File_OneDir|C_By_Name,C_RecordFileType,C_CmpExtName|C_Next);
  46   6                                                      gb_PlayNewWave=1;
  47   6                                              }
  48   5                                              else
  49   5                                              {
  50   6                                                      // No Wave file
  51   6                                                      gc_Task_Current=C_Task_Idle;
  52   6                                                      return;
  53   6                                              }
  54   5                                      }
C51 COMPILER V9.00   PLAY_WAV                                                              07/09/2012 21:16:55 PAGE 2   

  55   4                                      else
  56   4                                      {
  57   5                                              // No VOICE folder--Add VOICE folder
  58   5                                              gc_Task_Current=C_Task_Idle;
  59   5                                              return;
  60   5                                      }
  61   4                              }
  62   3                      }
  63   2      
  64   2                      if(gb_PlayNewWave==1)
  65   2                      {
  66   3                              gb_PlayNewWave=0;
  67   3                              WAV_Play_Init();
  68   3                              gs_DSP_GLOBAL_RAM.s_DSP_RAM.sc_RepeatMode=REPEAT_AB_NULL;
  69   3                      }
  70   2      
  71   2                      // Access Key
  72   2                      Key_Detect();
  73   2                      if(gc_KeyEvent!=0)
  74   2                      {
  75   3                              gc_MenuTimer=6;
  76   3                              AccessKeyEvent_WAV();
  77   3                              gc_KeyEvent=0;
  78   3                      }
  79   2                              
  80   2                      if(gb_AlarmTrigger==1)
  81   2                      {
  82   3                              if(CheckAlarmSetting()==0)      // Match Alarm Clock Setting
  83   3                              {
  84   4                                      gc_Task_Last=C_Task_PlayWAV;
  85   4                                      gc_Task_Current=C_Task_AlarmON;
  86   4                              }
  87   3                      }
  88   2      
  89   2                      if(gc_Task_Current!=C_Task_PlayWAV)
  90   2                      {
  91   3                              IMA_ADPCM_Play_StopCmd();
  92   3                              return;
  93   3                      }
  94   2      
  95   2                      if(gb_OrderRecordTrigger==1)
  96   2                      {
  97   3                              gc_Task_Current=C_Task_FM;
  98   3                              IMA_ADPCM_Play_StopCmd();
  99   3                              return;
 100   3                      }
 101   2      
 102   2                      // Leave Menu/Vol setting, Refresh All display
 103   2                      if((gc_MenuTimer==0)&&(gc_WAVMenuItem!=0||gb_SetVol))
 104   2                      {
 105   3                              gb_SetVol=0;
 106   3                              gc_WAVMenuItem=0;
 107   3                              RefreshAllDisplay();
 108   3                              LCM_Disp_FileName(&gc_FileLongName[5],gc_FileLongName[2],gc_FileLongName[4],1);
 109   3                              USER_LogFile_ReadWrite(1);
 110   3                      }
 111   2      
 112   2                      if(gb_ShowBatt==1&&gc_WAVMenuItem==0)
 113   2                      {
 114   3                              gb_ShowBatt=0;
 115   3                              LCM_ShowBattIcon();
 116   3                      }
C51 COMPILER V9.00   PLAY_WAV                                                              07/09/2012 21:16:55 PAGE 3   

 117   2      
 118   2                      if(gs_DSP_GLOBAL_RAM.s_DSP_RAM.sc_RepeatMode!=REPEAT_AB_NULL)
 119   2                      {
 120   3                              if(gc_ShowRepeatTimer==0)
 121   3                              {
 122   4                                      gc_ShowRepeatTimer=10;
 123   4                                      LCM_ShowRepeatIcon();
 124   4                              }
 125   3                      }
 126   2      
 127   2                      switch(gs_System_State.c_Phase)
 128   2                      {
 129   3                              case TASK_PHASE_PLAYACT:
 130   3                                      // Fill WAV data to DSP
 131   3                                      if((gs_DSP_GLOBAL_RAM.s_DSP_RAM.sc_RepeatMode!=REPEAT_AB)||(gs_File_FCB[1].dw_File_DataPoint<=gs_DSP_G
             -LOBAL_RAM.sdw_File_BDataPoint))
 132   3                                      {
 133   4                                              if(IMA_ADPCM_Play_DataIn()==DSP_DATAIN_COMMAND_ERROR)
 134   4                                              {
 135   5                                                      if(IMA_ADPCM_EOF_Proc()==1)
 136   5                                                      {
 137   6                                                              gs_DSP_GLOBAL_RAM.s_DSP_RAM.sc_RepeatMode=REPEAT_AB_NULL;
 138   6                                                              IMA_ADPCM_Play_StopCmd();
 139   6                                                              DOS_Search_File(C_File_OneDir|C_By_Name,C_RecordFileType,C_CmpExtName|C_Next);
 140   6                                                              gb_PlayNewWave=1;
 141   6                                                      }
 142   5                                              }
 143   4                                      }
 144   3                                      else
 145   3                                      {
 146   4                                              IMA_ADPCM_Repeat_DataIn();
 147   4                                      }
 148   3                                      // LCM Display
 149   3                                      if(gc_WAVMenuItem==0)
 150   3                                      {
 151   4                                              // ภWระ
 152   4                                              if(gc_PinPuTimer==0)
 153   4                                              {
 154   5                                                      LCM_ShowPinPu();
 155   5                                                      if((gc_ShowTimer==0)&&(gc_IR_Timer==0)&&(gb_SetVol==0))
 156   5                                                      {
 157   6                                                              // Play-Time
 158   6                                                              gw_Disp_CurrentSec=IMA_ADPCM_Play_ReadTime();
 159   6                                                              LCM_ShowPlayTime(gw_Disp_CurrentSec);
 160   6                                                      }
 161   5                                              }
 162   4                                      }
 163   3                              break;
 164   3      
 165   3                              case TASK_PHASE_PAUSE:
 166   3                              break;
 167   3      
 168   3                              case TASK_PHASE_STOP:
 169   3                              break;
 170   3                      }
 171   2      
 172   2                      tc_temp=gc_CurrentCard;
 173   2                      WAV_SourceDetect_Process();
 174   2                      if(gc_CurrentCard==9)
 175   2                      {
 176   3                              gc_Task_Current=C_Task_Idle;
 177   3                              return;
C51 COMPILER V9.00   PLAY_WAV                                                              07/09/2012 21:16:55 PAGE 4   

 178   3                      }
 179   2              }
 180   1      }
 181          
 182          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    393    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
